#! /usr/bin/env bqn

# Tests for the markdown parser
# Uses the test cases at https://spec.commonmark.org/0.29/spec.json
# since Github doesn't seem to have published theirs
markdown â† â€¢Import "../md.bqn"

tests â† Â¯2 â†“Ë˜ 8âŠ¸(Ã·ËœâŸœâ‰ âˆ¾âŠ£)âŠ¸â¥Š 2â†“â€¢file.Lines"spec.json"
tests â†© ((âŠ‘2+âŠâŸœ':')Â¨âˆ˜âŠ ((-','=Â¯1âŠ‘âŠ¢)â†“â†“)Â¨â‰1 âŠ¢) tests
testSection â† (1â†“Â¯1â†“âŠ¢)Â¨ 5âŠË˜tests
UnEscape â† {
  EscapeChar â† { ("\""tn"âŠğ•©) âŠ "\"""âˆ¾@+9â€¿10 }
  esc â† Â» <` ğ•©='\'
  (Â¬Â«esc) / EscapeCharâŒ¾(escâŠ¸/) ğ•©
}
RunTest â† {
  inâ€¿exp â† UnEscapeâˆ˜(1â†“Â¯1â†“âŠ¢)Â¨2â†‘ğ•©
  out â† 0 Markdown (@+10) ((âŠ¢-ËœÂ¬Ã—+`)âˆ˜=âŠ”âŠ¢) in
  âŸ¨expâ‰¡out,in,exp,out,2âŠ‘ğ•©âŸ©
}

{0=â‰ â€¢args ?
  â€¢Out "Pass test sections as arguments; shows array of non-matching entries"
  â€¢Out "Available sections: "âˆ¾2â†“1âŒ½âˆ¾""", """âŠ¸âˆ¾Â¨ â·testSection
;
  ignore â† (2 âŠË˜ tests) âˆŠ âŸ¨"47","85"âŸ©
  res â† 1 â†“Ë˜ (Â¬âŠË˜)âŠ¸/ RunTestË˜ tests /Ëœ ignore < testSection âˆŠ â€¢args
  â€¢Show res
}
