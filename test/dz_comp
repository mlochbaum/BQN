#! /usr/bin/env dbqn

ncâ€¿rt â† "-nocomp"â€¿"-rt" âˆŠ â€¢args
files â† "simple"â€¿"syntax"â€¿"prim"âŸ(0=â‰ ) ('-'â‰ âŠ‘)Â¨âŠ¸/ â€¢args
"Can't test runtime without the compiler!" ! Â¬ncâˆ§rt

âŸ¨DRun,DCompileâŸ© â† â€¢Import "../dc.bqn"

GetRT â† {ğ•¤:
  âŸ¨ref,glyphsâŸ© â† â€¢Import "../src/pr.bqn"
  PrimInd â† {âŠ‘rtâŠ<ğ•©}
  Decompose â† ((â‰ glyphs)>PrimInd)â—¶âŸ¨â€¢Decompose,0âŠ¸â‰âŸ©
  provide â† âŸ¨
    â€¢Type           # Type
    Decompose       # Decompose
    glyphsâŠ‘ËœPrimInd # Glyph
    âŠ‘âŸ¨âŸ©â¥Š0âŠ¸â¥Š         # GetFill
    â‹†â¼              # Log
    â‰ Â¨âŠ”             # GroupLen
    âˆ¾âŠ”âˆ˜âŠ¢            # GroupOrd
    !,+,-,Ã—,Ã·,â‹†,âŒŠ,=,â‰¤,â‰¢,â¥Š,âŠ‘,â†•,âŒœ,`,âŠ˜
  âŸ©
  rt â† â€¢COMP provideâŠ¸(âŠ£Â»Â«)âŒ¾(1âŠ¸âŠ‘) DCompile ref
}

Native â† {âğ•©}
exec â† (rtÂ¬nc)â—¶âŸ¨NativeË™, DRunË™, {ğ•©âŠ¸DRun}âˆ˜GetRTâŸ© @

Cases â† (0<â‰ )â—¶0â€¿('#'â‰ âŠ‘)Â¨âŠ¸/ Â· â€¢FLines "cases/"âˆ¾âˆ¾âŸœ".bqn"
c â† âˆ¾ CasesÂ¨ files
M â† {eâ€¿b:
  Err â† {(@+10)âˆ¾Ëœ""""âˆ¾bâˆ¾""": expected "âˆ¾eâˆ¾" but received "âˆ¾â•ğ•©}
  (Native e) â‰¢â—¶""â€¿Err Exec b
}
r â† (M '%'âŠ¸= (âˆ¨Â´âŠ£)â—¶âŸ¨"1"â‰â—‹<âŠ¢,(+`-2âŠ¸Ã—)âŠ¸âŠ”âŸ© âŠ¢)Â¨ c
â€¢Out ("All "âˆ¾(â•â‰ c)âˆ¾" passed!")âŸ(0=â‰ ) âˆ¾r
