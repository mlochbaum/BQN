#! /usr/bin/env dbqn

ncâ€¿rtâ€¿ref â† "-nocomp"â€¿"-rt"â€¿"-ref" âˆŠ â€¢args
files â† "simple"â€¿"syntax"â€¿"prim"âŸ(0=â‰ ) ('-'â‰ âŠ‘)Â¨âŠ¸/ â€¢args
"Can't test runtime without the compiler!" ! Â¬ncâˆ§rtâˆ¨ref

Native â† â€¢BQN
exec â† {
  nc ? Native ;
  # Otherwise compiled
  âŸ¨DRunâŸ© â† â€¢Import "dc.bqn"
  r â† {
    ref ? â€¢Import "ref.bqn"  ;            # Reference implementations
    rt  ? â€¢Import "dzrt.bqn" ;            # Self-hosted
    â€¢BQNâˆ˜â¥ŠÂ¨ âˆ¾ â€¢Import "../src/glyphs.bqn" # Native runtime
  }
  râŠ¸DRun
}

Cases â† (0<â‰ )â—¶0â€¿('#'â‰ âŠ‘)Â¨âŠ¸/ Â· â€¢FLines "cases/"âˆ¾âˆ¾âŸœ".bqn"
c â† âˆ¾ CasesÂ¨ files
Trim â† ((âˆ¨`âˆ§âˆ¨`âŒ¾âŒ½)' 'âŠ¸â‰ )âŠ¸/
M â† {eâ€¿b:
  Msg â† {âˆ¾âŸ¨
    """",b,""": expected "
    "to fail"âŸ("!"âŠ¸â‰¡)e
    " but "
    0âŠ¸â‰¡â—¶âŸ¨"received "âˆ¾2â€¢FmtâŠ‘,"evaluation failed"âŸ©ğ•©
    â¥Š@+10
  âŸ©}
  ("!"âŠ¸â‰¡â—¶âŸ¨<Native,0Ë™âŸ© e) â‰¢â—¶""â€¿Msg <âˆ˜ExecâŠ0 b
}
r â† (M '%'âŠ¸= (âˆ¨Â´âŠ£)â—¶âŸ¨"1"â‹ˆâŠ¢, TrimÂ¨(+`-2âŠ¸Ã—)âŠ¸âŠ”âŸ© âŠ¢)Â¨ c
â€¢Out ("All "âˆ¾(â€¢Reprâ‰ c)âˆ¾" passed!")âŸ(0=â‰ ) Â¯1â†“âˆ¾r
