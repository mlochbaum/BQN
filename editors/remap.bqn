#! /usr/bin/env bqn

help â† 1â†“"
Remap a BQN keyboard file from qwerty. Options:
  -h, --help: Print this message and exit
  -k: Output keyboard layout
  -i: Input file(s) in editors/
  -o: Output file(s); uses stdout if not given"

o â† "-h"â€¿"--help"â€¿"-k"â€¿"-i"â€¿"-o"
oo â† (â‰ o) = oi â† o âŠ arâ†â€¢args
â€¢Exitâˆ˜â€¢Outâˆ˜helpâŸ(âˆ¨Â´2âŠ¸>) oi
keyâ€¿inpâ€¿out â† 2â†“oâ‰ âŠ¸â†‘ ar âŠ”Ëœ (Â¬-ËœâŠ¢Ã— oiâŠËœ â†•âˆ˜â‰ âŒˆ`âˆ˜Ã—Â¬)oo

A â† {ğ•©?@; â€¢Out ğ•¨ â‹„ â€¢Exit 1}
"Can only specify one keyboard layout at a time!" A 1â‰¥â‰ key
"No inputs!" A 0<â‰ inp
"Requires one output file for each input, or one input and no output to use stdout" A inp=âŸœ(âŠ¢+0âŠ¸=)â—‹â‰ out

Map â† {ğ•©âŠËœğ•¨âŠâŠ¢}
_sl_ â† {ğ”½_ğ•£_âŸ¨a,bâŸ©: ğ”½âˆ˜((aâ†“bâ†“âŠ¢)Â¨)âŠ¸((aâŠ¸â†‘âˆ¾âŠ£âˆ¾bâŠ¸â†‘)Â¨)}

# Key layouts
qwerty â†   "`1234567890-=~!@#$%^&*()_+qwertyuiop[]QWERTYUIOP{}asdfghjkl;'ASDFGHJKL:""|zxcvbnm,./ZXCVBNM<>? "
keys â† âŸ¨
  "dvorak"â€¿"`1234567890[]~!@#$%^&*(){}',.pyfgcrl/=""<>PYFGCRL?+aoeuidhtns-AOEUIDHTNS_|;qjkxbmwvz:QJKXBMWVZ "
 "colemak"â€¿"`1234567890-=~!@#$%^&*()_+qwfpgjluy;[]QWFPGJLUY:{}arstdhneio'ARSTDHNEIO""|zxcvbkm,./ZXCVBKM<>? "
 "workman"â€¿"`1234567890-=~!@#$%^&*()_+qdrwbjfup;[]QDRWBJFUP:{}ashtgyneoi'ASHTGYNEOI""|zxmcvkl,./ZXMCVKL<>? "
âŸ©

# 2-modifier: source keymap as ğ•— and target as ğ•˜, file contents ğ•©
files â† âŸ¨
  "inputrc"â€¿{
    m â† ğ•— Mapâ—‹('"'âŠ¸=â—¶âŸ¨â¥Š,"\"âŠ¸âˆ¾âŸ©Â¨) ğ•˜
    {
      câ€¿d â† Â¯6â€¿Â¯2
      ((=Â´câ€¿dâŠ¸âŠ)Â¨ğ•©) (câŒ¾(dâŠ¸âŠ‘)â†•âˆ˜â‰ )âŠ¸âŠâˆ˜âŠ¢âŸâŠ£Â¨ M _sl_ 3â€¿Â¯5 ğ•©
    }âŒ¾(9âŠ¸â†“)
  }
  "XCompose"â€¿{
    xc â† MapÂ´ câ€¿l â† (âŠ‘Â¨â‹ˆ1â†“Â¨âŠ¢) (Â¯1+`<âŸœ'a'âˆ¨'z'âŠ¸<)âŠ¸âŠ” "`grave-minus=equal~asciitilde!exclam@at#numbersign$dollar%percent^circumflex&ampersand*asterisk(parenleft)parenright_underscore+plus[bracketleft]bracketright{braceleft}braceright:colon;semicolon""quotedbl,comma.period/slash<less>greater?question space'apostrophe"
    (ğ•— Mapâ—‹{â¥ŠÂ¨XCâŒ¾((ğ•©âˆŠc)âŠ¸/)ğ•©} ğ•˜) _sl_ 25â€¿Â¯7âŒ¾(4âŠ¸â†“)
  }
âŸ©

_lookup_ â† {
  optâ€¿res â† <Ë˜â‰>ğ•—
  err â† âˆ¾"Invalid "â€¿ğ•˜â€¿"; options:"âˆ¾" "âŠ¸âˆ¾Â¨opt
  res âŠËœ Â·(err A Â·âˆ§Â´(â‰ opt)âŠ¸>)âŠ¸âŠ¢ optâŠ¸âŠ
}
k    â† âŠ‘ keys  _lookup_ "key layout (-k)"  1â†‘keyâˆ¾âŸ¨"dvorak"âŸ©
conv â†   files _lookup_ "keymap file (-i)" inp
write â† âˆ¾âŸœâŸ¨â€¢OutÂ¨âŸ©âŸ(0=â‰ ) {(â€¢wdpathâ€¢file.Atğ•©)âŠ¸â€¢file.Lines}Â¨out
{ğ•Šwâ€¿câ€¿i: W qwerty _c_ k â€¢file.Lines i}Ë˜ â‰>writeâ€¿convâ€¿inp
