â—¶ â† {ğ•¨((ğ•¨ğ”½ğ•©)âŠ‘ğ•˜){ğ”½}ğ•©}     # LIMITED to number left operand result
âŠ˜ â† {ğ•¨((1{ğ”½}ğ•¨)-0)â—¶ğ”½â€¿ğ”¾ ğ•©}
âŠ¢ â† {ğ•©}
âŠ£ â† {ğ•©}âŠ˜{ğ•¨}
Ëœ â† {ğ•©ğ”½ğ•¨âŠ£ğ•©}
âˆ˜ â† {ğ”½ğ•¨ğ”¾ğ•©}
â—‹ â† {(ğ”¾ğ•¨)ğ”½ğ”¾ğ•©}
âŠ¸ â† {(ğ”½ğ•¨âŠ£ğ•©)ğ”¾ğ•©}
âŸœ â† {(ğ•¨âŠ£ğ•©)ğ”½ğ”¾ğ•©}
âŸ â† {ğ•¨((ğ•¨ğ”¾ğ•©)âŠ‘âŠ¢â€¿ğ•—){ğ”½}ğ•©}   # LIMITED to boolean right operand result

# LIMITED to numeric arguments for scalar cases
< â† {âŸ¨âŸ©â¥ŠâŸ¨ğ•©âŸ©} âŠ˜ (1-â‰¤Ëœ)
> â†            (1-â‰¤)
â‰¢ â†© IsArrayâ—¶âŸ¨âŸ©â€¿â‰¢  # LIMITED to monadic case
â‰  â† (0<=)â—¶âŸ¨1â‹„0âŠ‘â‰¢âŸ©

_foldâ†{
  ! 1==ğ•©
  lâ†â‰ vâ†ğ•© â‹„ Fâ†ğ”½
  râ†ğ•¨ (0<l)â—¶{ğ•©â‹„Identity f}â€¿{lâ†©l-1â‹„lâŠ‘ğ•©}âŠ˜âŠ£ ğ•©
  {râ†©(ğ•©âŠ‘v)F r}âŒœ(l-1)âŠ¸-âŒœâ†•l
  r
}
Â´ â† _fold


#âŒœ
# LAYER 2: Pervasion

ToArray â† <âŸ(1-IsArray)
Intâ†IsArrayâ—¶âŸ¨âŒŠâŠ¸=,0âŸ©
Natâ†IsArrayâ—¶âŸ¨0âŠ¸â‰¤Ã—âŒŠâŠ¸=,0âŸ©

âˆ¾ â† {kâ†â‰ ğ•¨â‹„kâŠ¸â‰¤â—¶âŸ¨âŠ‘âŸœğ•¨â‹„-âŸœkâŠ‘ğ•©ËœâŸ©âŒœâ†•k+â‰ ğ•©}  # LIMITED to two vector arguments

_eachdâ†{
  _dâ†{ # Equal ranks
    pâ†â‰¢ğ•¨
    ! 1(âŠ‘âŸœp=âŠ‘âŸœ(â‰¢ğ•©))âŠ¸Ã—Â´â†•=ğ•¨
    pâ¥Š (âŠ‘âŸœ(â¥Šğ•¨)ğ”½âŠ‘âŸœ(â¥Šğ•©))âŒœâ†•1Ã—Â´p
  }
  _eâ†{ # ğ•¨ has smaller or equal rank
    pâ†â‰¢ğ•¨ â‹„ kâ†=ğ•¨ â‹„ qâ†â‰¢ğ•©
    ! 1(âŠ‘âŸœp=âŠ‘âŸœq)âŠ¸Ã—Â´â†•k
    lâ†1(qâŠ‘ËœkâŠ¸+)âŠ¸Ã—Â´â†•(=ğ•©)-k
    aâ†â¥Šğ•¨ â‹„ bâ†â¥Šğ•©
    qâ¥Šâ¥Š(â‰ a) (âŠ‘âŸœağ”½lâŠ¸Ã—âŠ¸+âŠ‘bËœ)âŒœâ—‹â†• l
  }
  =â—‹=â—¶âŸ¨>â—‹=â—¶âŸ¨ğ”½_eâ‹„ğ”½Ëœ_eËœâŸ©â‹„ğ”½_dâŸ©
}

_pervâ†{ # Pervasion
  Râ†ğ”½{ğ•¨ğ”½_pervğ•©}
  +â—‹IsArrayâ—¶âŸ¨ğ”½â‹„RâŒœâŠ˜(>â—‹IsArrayâ—¶{ğ•¨{ğ•—Rğ•©}âŒœğ•©}â€¿{ğ•©{ğ•©Rğ•—}âŒœğ•¨})â‹„R _eachdâŸ©
}

âŒœ â†© {ğ”½âŒœâ—‹ToArray}
Â¨ â†© {(ğ”½âŒœ)âŠ˜(ğ”½_eachdâ—‹ToArray)}

matchâ†{(0âŠ‘ğ•¨)â—¶(1âŠ‘ğ•¨)â€¿ğ•©}Â´âŸ¨
  âŸ¨=â—‹IsArray, 0âŸ©
  âŸ¨IsArrayâˆ˜âŠ¢, =âŸ©
  âŸ¨=â—‹=      , 0âŸ©
  âŸ¨1Ã—Â´=Â¨â—‹â‰¢  , 0âŸ©
  {1Ã—Â´â¥Šğ•¨MatchÂ¨ğ•©}
âŸ©

Cmp0 â† â‰¤Ëœ-â‰¤
Cmp1 â† (0<1Ã—Â´â‰¢âˆ˜âŠ¢)â—¶âŸ¨1, IsArrayâˆ˜âŠ¢â—¶(1-2Ã—â‰¤)â€¿{ğ•¨Cmp1ğ•©}âŸœ(0âŠ‘â¥Š)âŸ©
Cmp â† +â—‹IsArrayâ—¶âŸ¨
  Cmp0
  IsArrayâˆ˜âŠ£â—¶âŸ¨Cmp1,-Cmp1ËœâŸ©
  {
    lcâ†ğ•¨CmpLenâ—‹â‰¢ğ•©
    cc â† (âŠ‘âŸœ(â¥Šğ•¨))âŠ¸CmpâŸœ(âŠ‘âŸœ(â¥Šğ•©)) _getCellCmpÂ´ lc
    CcËœ0
  }
âŸ©
_gradeâ†{
  ! 1â‰¤=ğ•©
  mâ†1Ã—Â´1 Cell ğ•©
  ccâ†m ğ”½â—‹(âŠ‘âŸœ(â¥Šğ•©)) _getCellCmp 0
  GTâ†Cc>0Ëœ
  lâ†â‰ ğ•©
  Bâ†lâŠ¸â‰¤â—¶âŠ¢â€¿l
  (â†•l){
    iâ†-dâ†ğ•¨ â‹„ jâ†eiâ†ejâ†0
    eâ†3 â‹„ Gâ†GTâ—‹(âŠ‘âŸœ(mâŠ¸Ã—Â¨âŸ(1-m=1)ğ•©)) â‹„ câ†âŸ¨G,0,1,2âŸ©
    sâ†(8â‰¤d)âŠ‘âŸ¨+,{(ğ•©-1){ğ•©â‹„eâ†©2â‹„jâ†©iâ‹„iâ†©ğ•©}âŸ(1-G)âŸ(1-e)ğ•©}âŸ©
    Nâ†{iâ†©d+ğ•¨â‹„ejâ†©B d+eiâ†©B jâ†©d+ğ•©â‹„eâ†©lâ‰¤jâ‹„S eiâ‹„i R j}
    Râ†{ğ•¨eâ—¶cğ•©}â—¶{e+â†©2Ã—ei=iâ†©1+ğ•¨â‹„ğ•¨}â€¿{e+â†©ej=jâ†©1+ğ•©â‹„ğ•©}â€¿N
    {(i R j)âŠ‘ğ•©}âŸœğ•©Â¨ğ•©
  }Â´(2â‹†ni-1+âŠ¢)Â¨â†•niâ†-âŒŠ-2 Log l+l=0
}

Indicesâ†{
  ! 1==ğ•©
  lâ†â‰ ğ•©
  {
    ! 1Ã—Â´NatÂ¨ğ•©
    kâ†l-1
    N â† ((âŠ¢+-Ã—0=ğ•©âŠ‘ËœâŠ¢)`kâŠ¸-âŒœâ†•l)âŠ‘Ëœk-âŠ¢  # Next nonzero
    E â† âŠ‘âŸœ(+`ğ•©)
    eiâ†E iâ†N 0
    {{eiâ†©E iâ†©Nğ•©+1â‹„i}âŸ(ğ•©=ei)i}Â¨â†•E k
  }âŸ(0<l)ğ•©
}

_under_â†{
  iâ†â†•lâ†1Ã—Â´sâ†â‰¢ğ•©
  vâ†â¥Šğ•¨ğ”½â—‹ğ”¾ğ•©
  gâ†Cmp0 _grade giâ†â¥Šğ”¾sâ¥Ši
  Pâ†(â‰ g)âŠ¸â‰¤â—¶âŸ¨(âŠ‘âŸœg)âŠ‘giËœ,lâŸ©
  eâ†P jâ†0
  sâ¥Š{e=ğ•©}â—¶âŸ¨âŠ‘âŸœ(â¥Šğ•©),{ğ•©â‹„râ†(jâŠ‘g)âŠ‘vâ‹„eâ†©P jâ†©1+jâ‹„r}âŸ©Â¨i
}
âŒ¾ â† _under_

+ â†© + _perv
- â†© - _perv
Ã— â†© (0âŠ¸(<->) âŠ˜ Ã—) _perv
Ã· â†© Ã· _perv
â‹† â†© â‹† _perv
âˆš â† â‹†âŸœ(Ã·2)   âŠ˜ (â‹†âŸœÃ·Ëœ)
| â† (Ã—âŸœÃ—     âŠ˜ {ğ•©-ğ•¨Ã—âŒŠğ•©Ã·ğ•¨}) _perv
âŒŠ â†© (âŒŠ       âŠ˜ {(ğ•¨>ğ•©)âŠ‘ğ•¨â€¿ğ•©}) _perv
âŒˆ â† (-âˆ˜âŒŠâˆ˜-   âŠ˜ {(ğ•¨<ğ•©)âŠ‘ğ•¨â€¿ğ•©}) _perv
Â¬ â† 1+-
âˆ§ â†            Ã—
âˆ¨ â†            (+-Ã—)
< â†© {âŸ¨âŸ©â¥ŠâŸ¨ğ•©âŸ©} âŠ˜ ((1-â‰¤Ëœ) _perv)
> â†©             (1-â‰¤) _perv
â‰  â†© â‰         âŠ˜ ((1-=) _perv)
= â†© =        âŠ˜ (= _perv)
â‰¥ â† !âˆ˜0      âŠ˜ (â‰¤Ëœ_perv)
â‰¤ â†© !âˆ˜0      âŠ˜ (â‰¤ _perv)
identity â† (0âŠ‘âŸ¨!âˆ˜0âŸ©) {(0âŠ‘ğ•¨){ğ•—=ğ•©}â—¶ğ•©â€¿(1âŠ‘ğ•¨)}Â´ âŸ¨+â€¿0,-â€¿0,Ã—â€¿1,Ã·â€¿1,â‹†â€¿1,âˆšâ€¿1,âˆ§â€¿1,âˆ¨â€¿0,|â€¿0,âŒŠâ€¿âˆ,âŒˆâ€¿Â¯âˆ,<â€¿0,â‰¤â€¿1,=â€¿1,â‰¥â€¿1,>â€¿0,â‰ â€¿0âŸ©

SelSubâ†{
  ! IsArray ğ•¨
  ! 1Ã—Â´â¥ŠIntÂ¨ ğ•¨
  lâ†â‰ ğ•©
  ! 1Ã—Â´â¥Š ((-l)âŠ¸â‰¤Ã—lâŠ¸>)Â¨ ğ•¨
  ((âŠ¢+lÃ—0>âŠ¢)Â¨ğ•¨)(1==ğ•©)â—¶{
    câ†1Ã—Â´sâ†1 Cell ğ•©
    ğ•¨((â¥Šğ•©)âŠ‘ËœcâŠ¸Ã—âŠ¸+)âŒœsâ¥Šâ†•c
  }â€¿{
    âŠ‘âŸœğ•©Â¨ğ•¨
  }ğ•©
}


#âŒœ
# LAYER 3: Remove other limits
# Now all implementations are full except âˆ¾ and âŠ‘; â†• is monadic only

Deshapeâ†IsArrayâ—¶{âŸ¨ğ•©âŸ©}â€¿â¥Š
Reshapeâ†{
  ! 1â‰¥=ğ•¨
  ğ•¨â†©Deshape ğ•¨
  ! âˆ§Â´NatÂ¨ğ•¨
  lâ†Ã—Â´ğ•¨
  nâ†Ã—Â´â‰¢ğ•©
  ğ•¨â¥Š{
    ğ•©(0<n)â—¶âŸ¨TypeâŠ¸(âŠ£âŒœ)â‹„â¥ŠâŠ¸{âŠ‘âŸœğ•¨Â¨n|ğ•©}âŸ©â†•l
  }âŸ(lâ‰ n)ğ•©
}âŸœToArray
â¥Š â†© Deshape        âŠ˜ Reshape

Rangeâ†{
  Iâ†{!Natğ•©â‹„â†•ğ•©}
  Mâ†{!1==ğ•©â‹„(<âŸ¨âŸ©)â¥ŠâŠ¸âˆ¾âŒœÂ´IÂ¨ğ•©}
  IsArrayâ—¶Iâ€¿M ğ•©
}

Depthâ†IsArrayâ—¶0â€¿{1+0âŒˆÂ´DepthÂ¨â¥Šğ•©}

â‰¡ â† Depth          âŠ˜ Match
â‰¢ â†© â‰¢              âŠ˜ (Â¬Match)


#âŒœ
# LAYER 4: Operators


DropVâ† {âŠ‘âŸœğ•©Â¨ğ•¨+â†•ğ•¨-Ëœâ‰ ğ•©}
Cell â† DropVâŸœâ‰¢
Pair â† {âŸ¨ğ•©âŸ©} âŠ˜ {âŸ¨ğ•¨,ğ•©âŸ©}

Mergeâ†{
  câ†â‰¢0âŠ‘â¥Šğ•©
  ! âˆ§Â´â¥Š(câ‰¡â‰¢)Â¨ğ•©
  ğ•©âŠ‘âŸœâ¥ŠËœâŒœcâ¥Šâ†•Ã—Â´c
}âŸ(0<â‰ âˆ˜â¥Š)
> â†© Merge          âŠ˜ >
â‰ â† >âˆ˜Pair
_ranks â† {âŸ¨2âŸ©âŠ˜âŸ¨1,0âŸ©((âŠ£-1+|)ËœâŸœâ‰ âŠ‘Â¨<âˆ˜âŠ¢)â¥Šâˆ˜ğ”½}
_depthOp_â†{
  negâ†0>nâ†ğ•¨ğ”¾_ranksğ•© â‹„ Fâ†ğ”½
  _dâ†{
    Râ†(ğ•—+neg)_d
    ğ•¨(Ã—âŸœ2âŠ¸+Â´2â¥Š(negâˆ§ğ•—â‰¥0)âˆ¨(0âŒˆğ•—)â‰¥Pairâ—‹â‰¡)â—¶(âŸ¨RÂ¨â‹„RâŸœğ•©Â¨âˆ˜âŠ£â‹„(ğ•¨RâŠ¢)Â¨âˆ˜âŠ¢â‹„FâŸ©)ğ•©
  }
  ğ•¨ n _d ğ•©
}
âš‡ â† _depthOp_
_rankOp_â†{
  kâ†ğ•¨(Pairâ—‹= (0â‰¤âŠ¢)â—¶âŸ¨âŒŠâŸœ-,0âŒˆ-âŸ©Â¨ ğ”¾_ranks)ğ•©
  Encâ†{
    fâ†âŠ‘âŸœ(â‰¢ğ•©)Â¨â†•ğ•¨
    câ†Ã—Â´sâ†ğ•¨Cellğ•©
    fâ¥ŠâŠ‘âŸœ(â¥Šğ•©)Â¨âˆ˜((sâ¥Šâ†•c)+cÃ—âŠ¢)Â¨â†•Ã—Â´f
  }
  Encâ†©(>âŸœ0+â‰¥âŸœ=)â—¶âŸ¨<âŠ¢,Enc,<Â¨âŠ¢âŸ©
  > ((0âŠ‘k)Encğ•¨) ğ”½Â¨ ((1-Ëœâ‰ )âŠ¸âŠ‘k)Encğ•©
}
â‰ â† _rankOp_
Ë˜ â† {ğ”½â‰Â¯1}
_insertâ†{
  ! 1â‰¤=ğ•©
  ğ•¨ ğ”½Â´ <Ë˜ğ•©
}
Ë â† _insert


#âŒœ
# LAYER 5: Structural functions

_onAxes_â†{
  Fâ†ğ”½
  (ğ”¾<â‰¡)âˆ˜âŠ£â—¶{ # One axis
    ! 1â‰¤=ğ•©
    ğ•¨Fğ•©
  }â€¿{ # Multiple axes
    ! 1â‰¥=ğ•¨
    ! ğ•¨â‰¤â—‹â‰ â‰¢ğ•©
    Râ†{(0âŠ‘â¥Šğ•¨)F(1 DropV ğ•¨)âŠ¸RË˜ğ•©}âŸ{0<â‰ ğ•¨}
    ğ•¨Rğ•©
  }
}

Selectâ†ToArrayâŠ¸(SelSub _onAxes_ 1)
âŠ â† 0âŠ¸Select       âŠ˜ Select

JoinToâ†âˆ¨â—‹(1â‰ =)â—¶âˆ¾â€¿{
  sâ†ğ•¨Pairâ—‹â‰¢ğ•©
  aâ†1âŒˆÂ´kâ†â‰ Â¨s
  ! âˆ§Â´1â‰¥a-k
  câ†(kÂ¬a)+âŸœ(â†•a-1)âŠ¸âŠÂ¨s
  ! â‰¡Â´c
  lâ†+Â´(a=k)âŠ£â—¶1â€¿(0âŠ‘âŠ¢)Â¨s
  (âŸ¨lâŸ©âˆ¾0âŠ‘c)â¥Šğ•¨âˆ¾â—‹â¥Šğ•©
}

Takeâ†{
  Tâ†{
    ! Int ğ•¨
    lâ†â‰ ğ•© â‹„ nâ†ğ•¨<0 â‹„ eâ†lâŒŠrâ†|ğ•¨ â‹„ sâ†âŸ¨râŸ©
    i â† ğ•©{sâˆ¾â†©câ†1 Cell ğ•¨â‹„ğ•©(Ã—+âŒœâ†•âˆ˜âŠ¢)Ã—Â´c}âŸ(1â‰ =ğ•©) (l-e)+âŸn â†•e
    s â¥Š ğ•©{(â¥Šğ•©)nâ—¶âŸ¨âˆ¾,âˆ¾ËœâŸ©(r-e)â¥ŠTypeğ•—}âŸ(l<r) âŠ‘âŸœ(â¥Šğ•©)Â¨i
  }
  ğ•¨ T _onAxes_ 0 (âŸ¨1âŸ©â¥ŠËœ0âŒˆğ•¨-â—‹â‰ âŠ¢)âŠ¸âˆ¾âˆ˜â‰¢âŠ¸â¥Šğ•©
}
Prefixes â† {!1â‰¤=ğ•© â‹„ (â†•1+â‰ ğ•©)TakeÂ¨<ğ•©}
â†‘ â† Prefixes       âŠ˜ Take
Dropâ†{
  sâ†(â‰ ğ•¨)(âŠ£â†‘âŠ¢âˆ¾Ëœ1â¥ŠËœ0âŒˆ-âŸœâ‰ )â‰¢ğ•©
  ((sÃ—Â¯1â‹†ğ•¨>0)+(-s)âŒˆsâŒŠğ•¨)â†‘ğ•©
}
Suffixes â† {!1â‰¤=ğ•© â‹„ (â†•1+â‰ ğ•©)DropÂ¨<ğ•©}
â†“ â† Suffixes       âŠ˜ Drop

Windowsâ†{
  ! IsArray ğ•©
  ! 1â‰¥=ğ•¨
  ! ğ•¨â‰¤â—‹â‰ â‰¢ğ•©
  ! âˆ§Â´NatÂ¨â¥Šğ•¨
  sâ†(â‰ ğ•¨)â†‘â‰¢ğ•©
  ! âˆ§Â´ğ•¨â‰¤1+s
  ğ•¨{(âˆ¾âŸœ(ğ•¨â‰ âŠ¸â†“â‰¢ğ•©)âˆ˜â‰¢â¥Š>)<Â¨âŠ¸âŠâŸœğ•©Â¨s(Â¬+âŒœâ—‹RangeâŠ¢)â¥Šğ•¨}âŸ(0<â‰ ğ•¨)ğ•©
}

Reverse â† {!1â‰¤=ğ•© â‹„ (-â†•âŠ¸Â¬â‰ ğ•©)âŠğ•©}
Rotate â† {!Intğ•¨ â‹„ lâ†â‰ ğ•©â‹„(l|ğ•¨+â†•l)âŠğ•©} _onAxes_ 0

Rep â† IndicesâŠ¸âŠ
Replicate â† {0<=ğ•¨}â—¶(â¥ŠËœâŸœâ‰ RepâŠ¢)â€¿{!ğ•¨=â—‹â‰ ğ•©â‹„ğ•¨Repğ•©} _onAxes_ (1-0=â‰ )

â†• â†© Range          âŠ˜ Windows
âŒ½ â† Reverse        âŠ˜ Rotate
/ â† Indices        âŠ˜ Replicate


#âŒœ
# LAYER 6: Everything else

Joinâ†(1â‰ =)â—¶âŸ¨âˆ¨Â´1â‰ =Â¨,1âŸ©â—¶{
  # List of lists
  iâ†jâ†Â¯1â‹„eâ†âŸ¨âŸ©â‹„aâ†ğ•©
  {{eâ†©aâŠ‘Ëœiâ†©ğ•©â‹„jâ†©Â¯1}âŸ(iâŠ¸â‰ )ğ•©â‹„(jâ†©j+1)âŠ‘e}Â¨/â‰ Â¨ğ•©
}â€¿{
  # Multidimensional
  Câ†(<âŸ¨âŸ©)â¥ŠâŠ¸âˆ¾âŒœÂ´âŠ¢  # Cartesian array product
  ! IsArray ğ•©
  sâ†â‰¢Â¨ğ•©
  dâ†â‰ 0âŠ‘â¥Šs
  ! âˆ§Â´â¥Šd=â‰ Â¨s
  ! dâ‰¥=ğ•©
  lâ†(â‰¢ğ•©){(ğ•©âŠ‘âŸœâ‰¢a Pick1Ëœ(j=ğ•©)âŠ¸Ã—)Â¨â†•ğ•¨}Â¨jâ†â†•râ†=aâ†ğ•©
  ! (râ†‘Â¨s)â‰¡C l
  iâ†C{pâ†+Â´Â¨â†‘ğ•©â‹„(â†•0âŠ‘âŒ½p)-ğ•©/Â¯1â†“p}Â¨l
  >i<Â¨âŠ¸âŠÂ¨l/ğ•©
}âŸ(0<â‰ âˆ˜â¥Š)

Groupâ†{
  ! IsArray ğ•©
  Chkâ†{!1==ğ•©â‹„!âˆ§Â´IntÂ¨ğ•©â‹„!âˆ§Â´Â¯1â‰¤ğ•©â‹„â‰ ğ•©}
  lâ†(1<â‰¡)â—¶Chkâ€¿{!1==ğ•©â‹„ChkÂ¨ğ•©}ğ•¨
  ! lâ‰¤â—‹â‰ â‰¢ğ•©
  ! âˆ§Â´l=lâ‰ âŠ¸â†‘â‰¢ğ•©
  (ğ•¨âŠ¸=/ğ•©Ëœ)Â¨â†•1+Â¯1âŒˆÂ´âš‡1ğ•¨
}

âˆ¾ â†© Join           âŠ˜ JoinTo
âŠ” â† GroupâŸœ(â†•â‰ âš‡1)   âŠ˜ Group

Pick1â†{
  ! 1==ğ•¨
  ! ğ•¨=â—‹â‰ sâ†â‰¢ğ•©
  ! âˆ§Â´IntÂ¨ğ•¨
  ! âˆ§Â´ğ•¨(â‰¥âŸœ-âˆ§<)s
  ğ•¨â†©ğ•¨+sÃ—ğ•¨<0
  (â¥Šğ•©)âŠ‘Ëœ0(âŠ‘âŸœğ•¨+âŠ‘âŸœsÃ—âŠ¢)Â´-â†•âŠ¸Â¬â‰ ğ•¨
}
Pickdâ†(âˆ¨Â´âˆ˜â¥ŠIsArrayÂ¨âˆ˜âŠ£)â—¶Pick1â€¿{PickdâŸœğ•©Â¨ğ•¨}
Pickâ†IsArrayâ—¶â¥Šâ€¿âŠ¢âŠ¸Pickd

# Searching
IndexOfâ†{
  câ†1-Ëœ=ğ•¨
  ! 0â‰¤c
  ğ•¨ (0<â‰ ğ•¨)â—¶âŸ¨0â‰câˆ˜âŠ¢,(+Ëâˆ§`)â‰¢âŒœâ—‹((0<c)â—¶âŸ¨âŠ¢,<â‰câŸ©)âŸ© ğ•©
}
UniqueMaskâ†{
  ! 1â‰¤=ğ•©
  uâ†0â†‘ğ•©
  {(â‰ u)>0âŠ‘â¥Šu IndexOf ğ•©}â—¶{uâ†©uâˆ¾ğ•©â‹„1}â€¿0Ë˜ğ•©
}
Findâ†{
  râ†=ğ•¨
  ! râ‰¤=ğ•©
  ğ•¨ â‰¡â‰r (â‰¢ğ•¨) â†•â‰r ğ•©
}

âŠ â† !âˆ˜0            âŠ˜ IndexOf
âˆŠ â† UniqueMask     âŠ˜ (âŠËœ<â‰ âˆ˜âŠ¢)
â· â† âˆŠâŠ¸/            âŠ˜ Find

ReorderAxesâ†{
  ğ•©â†©<âŸ(0=â‰¡)ğ•©
  ! 1â‰¥=ğ•¨
  ğ•¨â†©â¥Šğ•¨
  ! ğ•¨â‰¤â—‹â‰ â‰¢ğ•©
  ! âˆ§Â´NatÂ¨â¥Šğ•¨
  râ†(=ğ•©)-+Â´Â¬âˆŠğ•¨
  ! âˆ§Â´ğ•¨<r
  ğ•¨â†©ğ•¨âˆ¾ğ•¨(Â¬âˆ˜âˆŠËœ/âŠ¢)â†•r
  (ğ•¨âŠ¸âŠPickğ•©Ëœ)Â¨â†•âŒŠÂ´Â¨ğ•¨âŠ”â‰¢ğ•©
}
Transposeâ†(=-1Ëœ)âŠ¸ReorderAxesâŸ(0<=)
â‰ â† Transpose      âŠ˜ ReorderAxes

# Sorting
CmpLen â† {
  eâ†ğ•¨-Ëœâ—‹(âˆ¨Â´0âŠ¸=)ğ•©
  ğ•¨(e=0)â—¶âŸ¨0,eâŸ©â€¿{
    câ†Ã—ğ•¨-â—‹â‰ ğ•©
    râ†ğ•¨âŒŠâ—‹â‰ ğ•©
    lâ†ğ•¨{
      iâ†+Â´âˆ§`ğ•¨=ğ•©
      mâ†Ã—Â´âŠ‘âŸœğ•¨Â¨â†•i
      {câ†©Ã—-Â´ğ•©â‹„mâ†©mÃ—âŒŠÂ´ğ•©}âˆ˜(âŠ‘Â¨âŸœğ•¨â€¿ğ•©)âŸ(râŠ¸>)i
      m
    }â—‹(((-1+â†•r)+â‰ )âŠ¸{âŠ‘âŸœğ•©Â¨ğ•¨})ğ•©
    âŸ¨l,câŸ©
  }ğ•©
}
_getCellCmp â† {
  Ciâ†ğ”½â‹„lâ†ğ•¨â‹„câ†ğ•©
  Ccâ†{
    aâ†ğ•¨â‹„bâ†ğ•©
    Sâ†(lâŠ¸=)â—¶{Sâˆ˜(1+ğ•©)âŸ(0âŠ¸=)a Ciâ—‹(ğ•©âŠ¸+)b}â€¿c
    S 0
  }
  (1â‰ l)âŠ‘(ğ•©âŸ(0âŠ¸=)ğ”½)â€¿Cc
}

_binSearch â† {
  B â† ğ”½
  {
    Râ†{ğ•¨{aâ†B mâ†ğ•©+hâ†âŒŠğ•¨Ã·2â‹„(h+aÃ—2|ğ•¨)R aâŠ‘ğ•©â€¿m}âŸ(>âŸœ1)ğ•©}
    1+(ğ•©+1)R Â¯1
  }âŸ(0âŠ¸<)
}
_binsâ†{
  câ†1-Ëœ=ğ•¨
  ! 0â‰¤c
  ! câ‰¤=ğ•©
  lwâ†Ã—Â´swâ†1 Cell ğ•¨
  cwâ†lw ğ”½â—‹(âŠ‘âŸœ(â¥Šğ•¨)) _getCellCmp 0
  ! 0âŠ¸<â—¶âŸ¨1,âˆ§Â´0â‰¤ËœÂ·cwÂ¨âŸœ(lwâŠ¸+)lwÃ—â†•âˆ˜-âŸœ1âŸ©â‰ ğ•¨
  cxâ†c-Ëœ=ğ•©
  sxâ†cx Cell ğ•© â‹„ lcâ†sw CmpLen sx
  cc â† (âŠ‘âŸœ(â¥Šğ•¨))âŠ¸ğ”½âŸœ(âŠ‘âŸœ(â¥Šğ•©)) _getCellCmpÂ´ lc
  Bâ†(Ã—Â´sw)âŠ¸Ã—âŠ¸Ccâ‰¤0Ëœ
  (â‰ ğ•¨) {BâŸœğ•© _binSearch ğ•¨}Â¨ (Ã—Â´sx) Ã— â¥ŠâŸœ(â†•Ã—Â´)âŠ‘âŸœ(â‰¢ğ•©)Â¨â†•cx
}

â‹ â†   Cmp _grade   âŠ˜ (  Cmp _bins)
â’ â† -âˆ˜Cmp _grade   âŠ˜ (-âˆ˜Cmp _bins)
âˆ§ â†© â‹âŠ¸âŠ            âŠ˜ âˆ§
âˆ¨ â†© â’âŠ¸âŠ            âŠ˜ âˆ¨

OccurrenceCount â† âŠËœ(âŠ¢-âŠ)â‹âˆ˜â‹
ProgressiveIndexOf â† {ğ•¨âŠâ—‹(â‰Ë˜âŸœOccurrenceCountğ•¨âŠ¸âŠ)ğ•©}
âŠ’ â† OccurrenceCountâŠ˜ ProgressiveIndexOf

âŠ‘ â†© (0âŠ‘â¥Š)          âŠ˜ Pick
â—¶ â†© {ğ•¨((ğ•¨ğ”½ğ•©)âŠ‘ğ•˜){ğ”½}ğ•©}  # Same definition, new Pick

inverse â† {(âŠ‘(0âŠğ•©)âŠ<) âŠ‘ ((1âŠğ•©)âˆ¾âŸ¨!âˆ˜0âŸ©)Ëœ} â‰ (2âˆ¾Ëœ2Ã·Ëœâ‰ )âŠ¸â¥Š âŸ¨
  +, +âŠ˜(-Ëœ)
  -, -
  Ã—, âŠ¢âŠ˜(Ã·Ëœ)
  Ã·, Ã·
  â‹†, Log _perv
  âˆš, â‹†âŸœ2âŠ˜(â‹†Ëœ)
  âˆ§, âŠ¢âŠ˜(Ã·Ëœ)
  âˆ¨, âŠ¢âŠ˜(-ËœÃ·1-âŠ¢)
  <, {!IsArrayğ•©â‹„!0==ğ•©â‹„âŠ‘ğ•©}âŠ˜(!âˆ˜0)
  /, {!(â‹â‰¡â†•âˆ˜â‰ )ğ•©â‹„â‰ Â¨âŠ”ğ•©}âŠ˜(!âˆ˜0)
âŸ©
â¼ â† {Inverse ğ•—}

_repeat_â†{
  nâ†ğ•¨ğ”¾ğ•©
  lâ†uâ†0
  {!Intğ•©â‹„lâ†©lâŒŠğ•©â‹„uâ†©uâŒˆğ•©}âš‡0 n
  aâ†ğ•©â‹„_pâ†{ğ”½âˆ˜âŠ£`(1+ğ•©)â¥Š<a}
  posâ†(ğ•¨ğ”½ âŠ¢)_p u
  negâ†(ğ•¨ğ”½â¼âŠ¢)_p-l
  (|âŠ‘<âŸœ0âŠ‘posâ€¿negËœ)âš‡0 n
}
âŸ â†© _repeat_
