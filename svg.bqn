# Utilities for creating SVG diagrams as strings

# Snag the code highlighter from md.bqn
Highlight â† {
  AddT â† (â†‘âˆ¾"t"âˆ¾â†“)Â¨ËœâŸœ(1â€¿2â¥ŠËœâ‰¢)âŸ(ğ•¨âŠ£1)  # span to tspan
  (1Â¨ <âŠ¸âˆ¾ Â·AddTâŒ¾âŠ‘GetHighlights)âŠ¸Modify ğ•©
}

# Create a node from a tag name and interior text.
Enc â† {
  DeNest â† {(3âŒŠâ‰¡)â—¶âŸ¨!âˆ˜0,â‹ˆ,âŠ¢,âˆ¾ğ•ŠÂ¨âŸ© â¥Šğ•©}
  open â† âˆ¾âŸ¨"<",ğ•¨,">"âŸ©
  closeâ† âˆ¾âŸ¨"</", (âˆ§`ğ•¨â‰ ' ')/ğ•¨, ">"âŸ©
  l â† 1 < dâ†â‰¡ğ•©
  âˆ¾ open ({"  "âŠ¸âˆ¾Â¨(âˆ¾DeNestÂ¨)âŸ(3â‰¤d)â¥Šğ•©}âŸl ğ•©){ğ•¨â€¿ğ•—â€¿ğ•©}â—‹(â¥Šâˆ˜<âŸl) close
}
Void â† {âˆ¾âŸ¨"<",ğ•©,"/>"âŸ©}

FmtNums â† {
  ! âˆ§Â´ (Â¯âˆâŠ¸< âˆ§ <âŸœâˆ) ğ•©
  kâ†3â‹†Ëœbâ†10
  mâ€¿pâ†"-."-'0'
  sâ†ğ•©<0â‹„aâ†|ğ•©â‹„vâ†âŒŠ0.5+kÃ—a
  âŠ”âŸœ('0'âŠ¸+)Â´<âˆ˜âˆ¾Ë˜â‰âˆ¾âŸ¨
    â‰â‹ˆâŸœ(mÂ¨)/s
    â†•âˆ˜â‰ âŠ¸{fâ†bâ‰¤ğ•©â‹„(âˆ¨Â´f)â—¶âŸ¨â‰,ğ•ŠâŸœ(âŒŠÃ·âŸœb)â—‹(fâŠ¸/)Â´âˆ¾bâŠ¸|âŒ¾(âŠ‘âŒ½)âŸ©ğ•¨â€¿ğ•©}âŒŠvÃ·k
    pÂ¨âŒ¾(âŠ‘âŒ½)âˆ˜âŠâŠ¸âˆ¾âŸ(0<â‰ )â†•âˆ˜â‰ âŠ¸{fâ†Ã—ğ•©â†©k|ğ•©â‹„ğ•¨(âˆ¨Â´f)â—¶âŸ¨â†•0â€¿2,(â‹ˆâŸœ(âŒŠÃ·âŸœk)âˆ¾ğ•Š)âŸœ(bâŠ¸Ã—)â—‹(fâŠ¸/)âŸ©ğ•©}v
  âŸ©
}
FmtNum â† (2âŒŠâ‰¡)â—¶(âŠ‘FmtNumsâˆ˜â¥Š)â€¿(FmtNumsâŒ¾â¥Š)â€¿{ğ•©â‹„!0}
Fmt â† (2âŒŠâ‰¡)â—¶FmtNumâ€¿(1â†“Â·âˆ¾' 'âˆ¾Â¨FmtNum)â€¿{ğ•©â‹„!0}

At1 â† " " âˆ¾ {âˆ¾âŸ¨ğ•¨,"='",ğ•©,"'"âŸ©}Â´
Attr â† âˆ¾âŸœ(âˆ¾ <âˆ˜At1â‰1)
At â† {
  _s â† {((+`Ã—Â¬)âŠ¸-ğ•—âŠ¸=)âŠ¸âŠ”}
  ğ•¨ >âŠ˜(âˆ¾âŸœ(âˆ¾At1Â¨)) '='_sÂ¨ '|'_s ğ•©
}
Pos â† âŸ¨"x","y"âŸ© â‰Ë˜ FmtNum
Elt â† Voidâˆ˜Attr

SVG â† {
  ("svg" Attr âŸ¨"viewBox",Fmt ğ•¨âŸ©) Enc ğ•©
}
