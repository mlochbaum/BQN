#!/usr/bin/env bqn

# Process BQN runtime
rtt â† ('0'-ËœâŠ‘)âŸ= âŠ‘ â€¢argsâˆ¾2   # Runtime type: 0, 1, or all
rtn â† 2âŠ¸â‰¤â—¶â¥Šâ€¿â†• rtt # File numbers included

glyphs â† â€¢Import "glyphs.bqn"

# Provided values, to be passed in through the constants array
aliasâ€¿def â† (âŠ‘Â¨ â‹ˆ 1âŠ¸â†“Â¨) âŸ¨"&Type","âˆ©Fill","â£Log",
                         "$GroupLen","%GroupOrd","â_fillBy_"âŸ©
keep â† "!+-Ã—Ã·â‹†âŒŠ=â‰¤â‰¢â¥ŠâŠ‘â†•âŒœ`âŠ˜âŠ"
chrext â† glyphs âˆ¾Â¨ ((+Â´Â·âˆ§`'_'=0â€¿Â¯1âŠ¸âŠ)Â¨def) âŠ” alias
Typ â† chrextâŠ¸((+`â‰ Â¨)âˆ˜âŠ£â‹âˆ¾âŠ¸âŠ)

in0â€¿out0 â† âŸ¨"âˆ©â+-Ã—âŒŠ=â‰¤â‰¢â¥ŠâŠ‘â†•âŒœâŠ˜", "âŒŠâŒˆ|<>â‰ â‰¥âŠ¢âŠ£âˆ¾â‹ˆâ†‘â†“âŠË™ËœÂ¨Â´âˆ˜â—‹âŠ¸âŸœâ—¶âŸ"âŸ©
in2 â† aliasâˆ¾keep
out2 â† âˆ¾glyphs
inâ€¿out â† rtt âŠ‘ âŸ¨in0,out0âŸ©â€¿âŸ¨â·in2âˆ¾out0,out2âŸ©â€¿âŸ¨in2,out2âŸ©

inputs â‡ âŸ¨out0, (â‹Typ)âŠ¸âŠin2âŸ©
need â‡ TypâŠ¸âŠ” in

GetRepls â† { câ€¿nâ†ğ•© â‹„ âŸ¨c,câŠ£âŒ¾((câˆŠâ¥ŠÂ¨in)âŠ¸/)nâŸ©âˆ¾Â¨âŸ¨def,â¥ŠÂ¨aliasâŸ© }

âŸ¨E_procâŸ© â† glyphsâ€¿GetRepls â€¢Import "pp.bqn"

rslt â† "âŸ¨"âˆ¾"âŸ©"Â«âˆ¾","âŠ¸âˆ¾Â¨out  # Output all primitives
raw â† (â€¢FChars "r"âˆ¾'0'âŠ¸+âˆ¾".bqn"Ë™)Â¨ rtn
{ğ•¤â‹„ rawâˆ¾Ëœâ†©âŸ¨"glyphsâ†"""âˆ¾outâˆ¾"%"""âŸ© â‹„ rsltâˆ¾Ëœâ†©"{PrimIndâ†©âŠ‘ğ•©âŠ<â‹„ğ•©â€¿SetPrimsâ€¿SetInv}"}âŸâŠ¢ âˆ¨Â´1=rtn
raw âˆ¾â†© âŸ¨rsltâŸ©
src â‡ E_proc âˆ¾âˆ¾âŸœ(@+10)Â¨ raw
