#!/usr/bin/env dbqn

# Process BQN runtime

# All primitives
chrsâ†â€¢Import "glyphs.bqn"
glyphs â† âˆ¾chrs

# Provided values, to be passed in through the constants array
aliasâ€¿def â† (âŠ‘Â¨ â‰â—‹< 1âŠ¸â†“Â¨) âŸ¨"?Type","âˆ©Fill","â£Log",
                           "$GroupLen","%GroupOrd","â_fillBy_"âŸ©
keep â† "!+-Ã—Ã·â‹†âŒŠ=â‰¤â‰¢â¥ŠâŠ‘â†•âŒœ`âŠ˜âŠ"

type â† ((+Â´Â·âˆ§`'_'=0â€¿Â¯1âŠ¸âŠ)Â¨def) âˆ¾ chrs((+`â‰ Â¨)âˆ˜âŠ£â‹âˆ¾âŠ¸âŠ)keep
need â‡ type âŠ” aliasâˆ¾keep

GetRepls â† {
  câ€¿n â† ğ•©
  ki â† (âŠ‘Â¨c)âŠkeep
  âŸ¨c,câŠ£âŒ¾(kiâŠ¸âŠ)nâŸ©âˆ¾Â¨âŸ¨def,â¥ŠÂ¨aliasâŸ©
}

âŸ¨E_procâŸ© â† chrsâ€¿GetRepls â€¢Import "pp.bqn"

gd â† "glyphsâ†"""âˆ¾glyphsâˆ¾"%"""
rslt â† "âŸ¨"âˆ¾"âŸ©"Â«âˆ¾","âŠ¸âˆ¾Â¨glyphs  # Output all primitives
rr â† â€¢FLinesÂ¨ "r0.bqn"â€¿"r1.bqn"
raw â† âˆ¾âŸ¨âŸ¨gdâŸ©,âˆ¾rr,âŸ¨"{PrimIndâ†©âŠ‘ğ•©âŠ<â‹„ğ•©â€¿SetPrims}"âˆ¾rsltâŸ©âŸ©
src â‡ âˆ¾âˆ¾âŸœ(@+10)Â¨ E_procÂ¨ raw
