#!/usr/bin/env dbqn

# Process BQN runtime

# All primitives
chrsâ†âŸ¨
  "+-Ã—Ã·â‹†âˆšâŒŠâŒˆ|Â¬âˆ§âˆ¨<>â‰ =â‰¤â‰¥â‰¡â‰¢âŠ£âŠ¢â¥Šâˆ¾â‰â†‘â†“â†•Â«Â»âŒ½â‰/â‹â’âŠâŠ‘âŠâŠ’âˆŠâ·âŠ”!"
  "Ë™ËœË˜Â¨âŒœâ¼Â´Ë`"
  "âˆ˜â—‹âŠ¸âŸœâŒ¾âŠ˜â—¶â‰âš‡âŸ"
âŸ©
glyphs â‡ âˆ¾chrs

# Provided values, to be passed in through the constants array
def â† âŸ¨"Type","Decompose","Glyph","Fill","Log","GroupLen","GroupOrd","_fillBy_"âŸ©
keep â† "!+-Ã—Ã·â‹†âŒŠ=â‰¤â‰¢â¥ŠâŠ‘â†•âŒœ`âŠ˜"
len â‡ def+â—‹â‰ keep

GetRepls â† {
  câ€¿n â† ğ•©
  ki â† (âŠ‘Â¨c)âŠkeep
  dt â† âŠ”âŸœâŠ’ (+Â´Â·âˆ§`'_'=0â€¿Â¯1âŠ¸âŠ)Â¨ def
  ns â† Â» neâ†+`â‰ Â¨chrs
  kt â† âˆ¾ (ns+â‰ Â¨dt) + âŠ”âŸœâŠ’neâ‹ki
  âŸ¨c,(ktâŠc)âŒ¾(kiâŠ¸âŠ)nâŸ©âˆ¾Â¨âŸ¨def,(âˆ¾ns+dt)âŠcâŸ©
}

âŸ¨E_procâŸ© â† chrsâ€¿GetRepls â€¢Import "pp.bqn"

rslt â† "âŸ¨"âˆ¾"âŸ©"Â«âˆ¾","âŠ¸âˆ¾Â¨glyphs  # Output all primitives
ref â‡ âˆ¾âˆ¾âŸœ(@+10)Â¨ E_procÂ¨ (â€¢FLines "r.bqn")âˆ¾<rslt
