#!/usr/bin/env dbqn

# Process BQN runtime

# All primitives
chrsâ†â€¢Import "glyphs.bqn"
glyphs â‡ âˆ¾chrs

# Provided values, to be passed in through the constants array
def â† âŸ¨"Type","Fill","Log","GroupLen","GroupOrd","_fillBy_"âŸ©
keep â† "!+-Ã—Ã·â‹†âŒŠ=â‰¤â‰¢â¥ŠâŠ‘â†•âŒœ`âŠ˜âŠ"
len â‡ def+â—‹â‰ keep

GetRepls â† {
  câ€¿n â† ğ•©
  ki â† (âŠ‘Â¨c)âŠkeep
  dt â† âŠ”âŸœâŠ’ (+Â´Â·âˆ§`'_'=0â€¿Â¯1âŠ¸âŠ)Â¨ def
  ns â† Â» neâ†+`â‰ Â¨chrs
  kt â† âˆ¾ (ns+â‰ Â¨dt) + âŠ”âŸœâŠ’neâ‹ki
  âŸ¨c,(ktâŠc)âŒ¾(kiâŠ¸âŠ)nâŸ©âˆ¾Â¨âŸ¨def,(âˆ¾ns+dt)âŠcâŸ©
}

âŸ¨E_procâŸ© â† chrsâ€¿GetRepls â€¢Import "pp.bqn"

gd â† "glyphsâ†"""âˆ¾glyphsâˆ¾"%"""
rslt â† "âŸ¨"âˆ¾"âŸ©"Â«âˆ¾","âŠ¸âˆ¾Â¨glyphs  # Output all primitives
src â† âˆ¾âŸ¨âŸ¨gdâŸ©,â€¢FLines"r.bqn",âŸ¨"{PrimIndâ†©âŠ‘ğ•©âŠ<â‹„ğ•©â€¿SetPrims}"âˆ¾rsltâŸ©âŸ©
ref â‡ âˆ¾âˆ¾âŸœ(@+10)Â¨ E_procÂ¨ src
