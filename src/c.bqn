#! ./dzref

tabâ†'	'â‹„nlâ†'
'
dig â† "0123456789"
alph â† "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
alow â† "abcdefghijklmnopqrstuvwxyz"
charGroupsâ†âŸ¨
  chFâ†"+-Ã—Ã·â‹†âˆšâŒŠâŒˆ|Â¬âˆ§âˆ¨<>â‰ =â‰¤â‰¥â‰¡â‰¢âŠ£âŠ¢â¥Šâˆ¾â‰â†‘â†“â†•âŒ½â‰/â‹â’âŠâŠ‘âŠâŠ’âˆŠâ·âŠ”!" # Function
  "ËœË˜Â¨âŒœâ¼Â´Ë`"            # Modifier
  "âˆ˜â—‹âŠ¸âŸœâŒ¾âŠ˜â—¶â‰âš‡âŸ"          # Composition
  nlâˆ¾"â‹„,"               # Separator
  "â†â†©â†’"                 # Gets
  "(){}âŸ¨âŸ©"              # Bracket
  "â€¿"                   # Ligature
  "Â·"                   # nOthing
  "ğ•Šğ•ğ•ğ”½ğ”¾ğ•¤ğ•©ğ•¨ğ•—ğ•˜"          # Input (ğ•£ pending; â„ not allowed)
  dig                   # Digit
  "Â¯.Ï€âˆ"                # Numeric
  alowâˆ¾alphâˆ¾"_"         # Alphabetic
  " "âˆ¾tab               # Whitespace
# #'" eliminated during tokenization
âŸ©
ErrUnknownCharsâ†{
  "Unclosed quote"!Â¬âˆ¨Â´âŸ¨''','"'âŸ©âˆŠğ•©
  âŸ¨"Unknown character","s"/Ëœ1<â‰ ğ•©,": ",ğ•©âŸ©âˆ¾âŠ¸!0
}
CharCodeâ†(âˆ¾charGroups){
  Chk â† âŠ¢âŠ£ErrUnknownCharsâˆ˜(â‰ /âŠ£)âŸâ‰¢âŸœ(âŠâŸœğ•—)
  gâ†â‹ğ•— â‹„ âŠ¢ Chk gâŠËœ1-Ëœ1âŒˆ(gâŠğ•—)â‹âŠ¢
}
bFâ€¿bMâ€¿bCâ€¿bSâ€¿bGâ€¿bBâ€¿bLâ€¿bOâ€¿bIâ€¿bDâ€¿bNâ€¿bAâ€¿bWâ†â‰Â¨ËœâŸœ(+`â‰ â†‘0âˆ¾âŠ¢)â‰ Â¨charGroups
bA_eâ†4+âŠ‘bA
Mâ†1âŠ¸âŠ‘(0âŠ¸â‰¤âˆ§>)-âŸœâŠ‘
viâ†+Â´â‰ Â¨9â†‘charGroups
charRoleâ†((vi-1âŠ‘bI)â†‘/0âˆ¾â‰ Â¨3â†‘charGroups)âˆ¾(5/âŒ½â†•2)âˆ¾0
spcâ†â¥Š3â€¿5â€¿6-âŒœ3â€¿0

Tokenizeâ†{
  râ†ğ•©='#'â‹„sâ†/(â‰ â†‘2âŠ¸â†“)âŠ¸âˆ§ğ•©='''â‹„dâ†/ğ•©='"'
  gâ†â‹qâ†âˆ¾âŸ¨  sâ‹„Â¯1â†“dâ‹„/râŸ© â‹„qâ†©gâŠq
  eâ† gâŠâˆ¾âŸ¨2+sâ‹„ 1â†“dâ‹„(âŠ¢-Â¯1â†“0âˆ¾âŠ¢)âˆ˜âŠâŸœ(0âˆ¾+`r)âŠ¸//(ğ•©=nl)âˆ¾1âŸ©
  Seâ†{(âŠËœğ•¨)Se 1Â¨âŒ¾((ğ•©/ğ•¨)âŠ¸âŠ)ğ•©}âŸ{0=âŠ‘âŒ½ğ•©}
  stâ†Â¯1â†“SeâŸœ(1â†‘Ëœâ‰ )âˆ¾âŸœâ‰ qâ‹eâ‹„bâ†st/qâˆ¾Ë˜e
  ToIâ†Â¯1â†“Â·/â¼(â‰ ğ•©)âˆ¾Ëœâ¥Šâ‹„fâ†Â¬â‰ `ToI b
  cbâ†(Â¬(st/q)âŠr)/b
  luâ†â·litâ†ğ•©âŠ”Ëœ1-Ëœ(+`ToIâŠ‘Ë˜cb)Ã—â‰ `ToI cb
  clâ†f/ToIâŠ‘âˆ˜âŒ½Ë˜cb

  câ†CharCodeâŒ¾((Â¬cl)âŠ¸/) f/ğ•©
  wâ†(â‰ â†‘0âˆ¾âŠ¢)âŠ¸<lâ†c M (âŠ‘bD)â‰+Â´1âŠ‘Â¨bDâ€¿bNâ€¿bA
  naâ†â‰ alphâ‹„usâ†c=Â¯1++Â´bA
  idâ†(1-Ëœ(us<l)Ã—+`w)âŠ”na(âŠ¢-âŠ£Ã—+âŸœ(âŠ‘bA)âŠ¸â‰¤)c
  tiâ†naâŒŠâˆ˜Ã·Ëœ(âŠ‘bA)-Ëœw/c
  iuâ†(â‰ â†‘Â¯1âˆ¾âŒˆ`)âŠ¸<isâ†âŠidâ‹„niâ†â‰ inâ†0>iu/ti
  tiâ†©(us/Ëœ(1â†“0âˆ¾ËœâŠ¢)âŠ¸<l)(âŠ¢+âˆ§âŸœ(2âŠ¸=))0âŒˆti

  câ†©(wâˆ¨Â¬lâˆ¨c M bW)/(vi+isâŠâ‹â‹in)âŒ¾(wâŠ¸/)(vi+ni+luâŠlit)âŒ¾(clâŠ¸/)c
  c/Ëœâ†©Â¬(â‰ â†‘1âˆ¾(câˆŠ2â€¿4+âŠ‘bB)âˆ¨âŠ¢)âŠ¸âˆ§c M bSâ‹„c/Ëœâ†©Â¬(1â†“1âˆ¾ËœcâˆŠ3â€¿5+âŠ‘bB)âˆ§c M bS
  icâ†(0âŠ¸â‰¤âˆ§<âŸœni)c-viâ‹„tâ†tiâŒ¾(icâŠ¸/)(viâŒŠc)âŠcharRole
  c+â†©5Ã—c M 5â‰ËœâŠ‘bI
  âŸ¨c,t,+Â´Â¬in,((in//iu)âŠid)âˆ¾luâŸ©
}

ReadNumâ†{
  nâ€¿dâ€¿pâ€¿iâ†4â†•âŠ¸+âŠ‘bN  # Â¯.Ï€âˆ
  Natâ†+âŸœ(10âŠ¸Ã—)Â´âˆ˜âŒ½ -âŸœ(âŠ‘bD)
  Intâ†(n=âŠ‘)â—¶âŸ¨Nat,-Â·Nat 1âŠ¸â†“âŸ©
  Decâ†âŠâŸœ(<d)âŠ¸(Natâˆ˜â†‘ + Â·(0<â‰ )â—¶âŸ¨0,NatÃ·10â‹†â‰ âŸ©+âŸœ1âŠ¸â†“)
  Posâ†(âŠ‘pâ€¿iâŠâŠ)â—¶âŸ¨Ï€,âˆ,DecâŸ©
  eâ†âŠ‘ğ•©âŠbA_e
  mâ†(n=âŠ‘)â—¶âŸ¨Pos,-Â·Pos 1âŠ¸â†“âŸ©eâ†‘ğ•©
  ğ•©Ã—âŸœ(10â‹†Â·Int(e+1)â†“âŠ£)ËœâŸ(e<â‰ ğ•©)m
}
LitValâ†(âŠ‘("'"âˆ¾'"')âŠâŠ)â—¶âŸ¨1âŠ¸âŠ‘,1âŠ¸â†“,ReadNumâŸ©


LEBv â† {
  bâ†128
  lâ†âŒŠbâ‹†â¼1âŒˆğ•©
  oâ†â‹â‹((â†•Â¯1âŠ‘âŠ¢)-/âŸœ(â‰ â†‘0âˆ¾âŠ¢))âŸœ(+`)1+l
  oâŠl{fâ†Ã—ğ•¨â‹„(ğ•¨-1)(bâŠ¸(Ã—âŸœf+|)âˆ¾ğ•ŠâŸœ(âŒŠÃ·âŸœb)â—‹(fâŠ¸/))âŸ(âˆ¨Â´f)ğ•©}ğ•©
}

Parse â† {nvâ€¿râ†ğ•¨
  gâ†â‹+`pâ†ğ•©(MÃ—Â¯1â‹†2|-âŸœâŠ‘)bBâ‹„brâ†pÃ—ğ•©M 2â‰Ëœ2+âŠ‘bB
  slâ†1âŠ¸âŒ½âŠ¸âˆ¨ğ•© M bLâ‹„srâ†Â¯1âŠ¸âŒ½âŒ¾(gâŠ¸âŠ)slâ‹„saâ†slâˆ¨sr
  gâŠËœâ†©â‹gâŠslâ‹„rÃ—â†©Â¬saâ‹„oâ†p>0
  r+â†©(sa<ğ•©=1+âŠ‘bB)(âŠ£âˆ§Â¬âŠ¸âˆ¨=â—‹(âŒˆ`(1+â†•âˆ˜â‰ )âŠ¸Ã—)âŠ¢)(Â¯1âŠ¸âŒ½âŒ¾(gâŠ¸âŠ)3=r)âˆ¨1â‰¤r
  revâ†â‹+`1+Â¯1â†“g((Â¯1âˆ¾âŠ£)(âŠ£â‹âŠ¸âŠâŠËœ-âŠËœâŸœâ‹)âŸœâ‹1(+`âˆ˜âˆ¾-âˆ¾Ëœ)âŠ)oâˆ¨slâˆ¨ğ•© M bS

  gfâ†â‹fdâ†+`revâŠbr
  revâŠËœâ†©gfâ‹„fdâŠËœâ†©gf
  ğ•©âŠËœâ†©revâ‹„bvâ†revâŠbrâ‹„bâ†/bv<0â‹„fiâ†+`câ†bv>0

  FCâ†-âŸœ(â‰ â†‘0âˆ¾âŠ¢)(câˆ¾1)/Â·+`âˆ¾âŸœ0
  Hâ†0<1â†“FCâˆ˜=
  ftâ†(0âˆ¾1âŠ¸H+2Ã—2âŠ¸HâŒˆ2Ã—3âŠ¸H)(0â€¿3â€¿4â€¿5+5+âŠ‘bI)â‹ğ•©
  fscâ†ftâŠspc
  râ†©((1â†“ft)âŠ(1+2âŠ¸â‰¤)âŠ¸/â†•4)âŒ¾(bâŠ¸âŠ)revâŠr

  idâ†/idmâ†(0âŠ¸â‰¤âˆ§<âŸœnv)xvâ†ğ•©-viâ‹„idxâ†idâŠğ•©â‹„spâ†/ğ•© M bI
  adâ†(âŒˆ`â†•âˆ˜â‰ âŠ¸Ã—ğ•© M bG)âŠğ•©=âŠ‘bG

  gâ†©â‹+`revâŠp-brâ‹„grâ†gâŠrevâ‹„sllâ†1+2Ã·Ëœ0(<-â—‹/>)grâŠsr-slâ‹„lâ†/gâŠğ•©=5+âŠ‘bB
  gâŠËœâ†©gsâ†â‹grâŠslâ‹„grâ†©gâŠrevâ‹„ğ•©âŠËœâ†©gâ‹„râŠËœâ†©gâ‹„oâŠËœâ†©grâ‹„siâ†/grâŠsr>sl
  giâ†â‹gâ‹„lâŠâ†©â‹gs
  sâ†ğ•© M bSâ‹„psâ†sâˆ¨oâˆ¨grâŠslâ‹„aâ†ğ•© M 2â‰ËœâŠ‘bG
  r-â†©psâˆ¨aâ‹„opâ†râ‰¥2â‹„feâ†(râ‰¥1)âˆ¨1âŒ½r=3
  trâ†(âŒˆ`â†•âˆ˜â‰ âŠ¸Ã—Â¯1âŒ½ps)âŠfe
  maâ†tr<(ğ•©=1+âŠ‘bG)âˆ§1âŒ½fe
  roâ†opâˆ¨a<1âŒ½r=3â‹„osâ†âŒ½â†•âˆ˜â‰ âŠ¸(âŠ£-âŒˆ`âˆ˜Ã—)âŒ½Â¬roâˆ¨maâ‹„atâ†(âŠ¢+1+âŠâŸœos)/a
  aaâ†gâŠasnâ†Â¯1âŒ½+`giâŠ-âŸœ(â‰ â†‘0âˆ¾âŠ¢)Â¯1â†“/â¼(â‰ ğ•©)âˆ¾Ëœat-1â‹„râ†©Â¯1Â¨âŒ¾(aaâŠ¸/)r
  tfâ†(aâ‰¤â—‹(âŒˆ`(1+â†•âˆ˜â‰ )âŠ¸Ã—)ps)âˆ§(âŠ¢âˆ§2(|<â‰¤)ps(âŠ¢-âŒˆ`âˆ˜Ã—)+`)Â¬ro
  opaâ†op>1â†“0âˆ¾Ëœpsâˆ¨a
  oaâ†âŒ½/opaâ‹„faâ†/(1âŒ½aa)<(tfâˆ¨Â¬tr)âˆ§(roâˆ§1âŒ½opa)<(r=1)âˆ¨op<Â¯1âŒ½opa
  dyâ†faâŠ1â†“0âˆ¾Ëœ(ğ•©â‰ âŠ‘bO)âˆ§(trâˆ§râ‰¥0)âˆ¨ro<r=0
  nâ†ğ•©â‰¥vi+nvâ‹„cnâ†/nâˆ¨ğ•©â‰¤Â¯1++Â´bCâ‹„uâ†âˆ§â·obâ†cnâŠğ•©
  loâ†(o/ğ•©)=4+âŠ‘bBâ‹„llâ†1+lo/1(â†“--âŠ¸â†“)(oâˆ¾1)/+`(sâˆ¾0)-(1âˆ¾o)âˆ§psâˆ¾1
  drâ†/s>o+`âŠ¸âŠ0âˆ¾loâ‹„rtâ†/ğ•©=2+âŠ‘bB

  dâ†idâŠdecâ†idmâˆ§adâˆ§asnâ‹„lcâ†FC dec
  igâ†â‹(âŠâŸœ(Â¯1âˆ¾c/gf)âˆ¾dâŠ¸/âŠ((â‰ ğ•©)âˆ¾bâŠgf)Ëœ)idâŠfi
  igâ†©<âŸœ(â‰ id)âŠ¸/(â‹+`âˆ˜âŠâŸœ(dâˆ¾-/Ëœd))âŠ¸âŠ(â‹âŠâŸœ(âˆ¾âŸœ(dâŠ¸/)idx))âŠ¸âŠig
  uiâ†d(âŒˆ`â†•âˆ˜â‰ âŠ¸Ã—)âŠ¸âŠâŒ¾(igâŠ¸âŠ)id
  iiâ†(uiâŠ(fiâŠfsc)-(âŒˆ`câŠ¸Ã—)âŠ¸Â¬+`dec)âˆ¾((spâŠfi)âŠ3Ã—2|ft)++âŸœ(0âŠ¸â‰¤)2+spâŠxv
  idorâ†âˆ¾3â¥Š<isâ†idâˆ¾sp
  idbcâ†âŸ¨21+isâŠasn,(id-â—‹(âŠâŸœfd)ui)âˆ¾0Â¨sp,iiâŸ©

  bâŠâ†©gi
  orâ†â‹idorâˆ¾gâŠËœâˆ¾âŸ¨cn,cn,b,b,rt,dr,l,l,si,si,at,oa+1âŒˆoaâŠos,(dyÃ—âŠâŸœos)âŠ¸+fa+dyâŸ©
  bc0â†âˆ¾idbcâˆ¾âŸ¨0Â¨cn,uâŠob,15Â¨b,1+â†•â‰ bâŸ©
  bcâ†orâŠbc0âˆ¾âˆ¾âŸ¨25Â¨rt,14Â¨dr,3+lâŠaa,ll,3+siâŠaa,sll,(11-âŠ‘bG)+a/ma+ğ•©,5+oaâŠr,(âŠ¢+9Ã—10âŠ¸=)16+dy-7Ã—faâŠtrâŸ©
  fsâ†(ftâŠâ¥Š3â‰âŒœâŸœâŒ½â—‹â†•2)âˆ¾Â¨((+`0âˆ¾1+âŒŠ128â‹†â¼1âŒˆbc)âŠËœ/1âˆ¾or M bc0â‰â—‹â‰ rt)â‰â—‹<Â¨lc+fsc
  âŸ¨LEBv bcâˆ¾25,u,fsâŸ©
}

Compileâ†{
  âŸ¨t,r,nVar,litsâŸ©â†Tokenizeğ•©
  âŸ¨bc,u,blkâŸ©â†nVarâ€¿r Parse t
  oâ†(u-(vi+nVar-â‰ ğ•¨)Ã—uâ‰¥vi)âŠğ•¨âˆ¾LitValÂ¨lits
  âŸ¨bc,o,blkâŸ©
}
