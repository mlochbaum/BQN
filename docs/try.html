<!DOCTYPE html>
<html>
<head>
  <meta charset=utf-8>
  <title>BQN online REPL</title>
  <link href="style.css" rel="stylesheet"/>
  <style>
    * { box-sizing: border-box; }
    #code { width:100%; outline:none; }
    #run, #perm { float:right; }
    .cont { margin:1.3em 0; }
    #rslt { white-space:pre; }
    #rslt.err { color:#d11; }
    #kb { line-height:1.5; width:100%; padding:0.3em 0; background:inherit; }
    #kb span { cursor:default; padding:1px; }
    #kb span:hover { background-color:#bce; }
    #kb.backslash  { background-color:#cee; }
    @media (prefers-color-scheme:dark) {
      #kb span:hover { background-color:#237; }
      #kb.backslash  { background-color:#1e2430; }
    }
  </style>
</head>
<body>
  <a href="https://mlochbaum.github.io/BQN/" title='BQN homepage'>BQN</a>
  <a id="perm" href="#" title='Permalink'>#</a>
  <div class="cont">
    <div id="kb" class="bqn"></div>
    <textarea id="code" class="bqn" rows="8" autofocus></textarea>
    <input id="run" type="submit" value="Run (or shift-enter)">
  </div>
  <div id="rslt"></div>

<script src="bqn.js"></script>
<script>
let body = document.body;
let doc={}; // html elements with an id
body.querySelectorAll('[id]').forEach(e=>doc[e.id]=e);
let repl = ()=>{
  try {
    let s=doc.code.value;
    doc.rslt.classList.remove('err');
    doc.rslt.textContent=""+bqn(s);
  } catch(e) {
  //if (console&&console.error) console.error(e.stack);
    doc.rslt.classList.add('err');
    doc.rslt.textContent=e;
  }
}
doc.run.onclick = repl;

let keymode=0; // 1 for backslash
doc.code.onkeydown = ev => {
  let k = ev.which;
  if (16<=k && k<=20) {
    return;
  } if (ev.shiftKey && k==13) { // shift-enter
    repl(); return false;
  } if (keymode) {
    keymode = 0;
    doc.kb.classList.remove('backslash');
    let c = keys[ev.key];
    if (c) return typeChar(ev.target, c, ev);
  } else if (k===220) { // \
    keymode = 1;
    doc.kb.classList.add('backslash');
    ev.preventDefault();
  }
}
let typeChar = (t, c, ev) => {
  ev.preventDefault();
  let v = t.value;
  let i = t.selectionStart;
  t.value = v.slice(0,i)+c+v.slice(t.selectionEnd);
  t.selectionStart = t.selectionEnd = i+c.length;
  return false;
}

let keydesc='+Conjugate;Add_-Negate;Subtract_Ã—Sign;Multiply_Ã·Reciprocal;Divide_â‹†Exponential;Power_âˆšSquare Root;Root_âŒŠFloor;Minimum_âŒˆCeiling;Maximum_âˆ§Sort Up;And_âˆ¨Sort Down;Or_Â¬Not;Span_|Absolute Value;Modulus_â‰¤Less Than or Equal to_<Enclose;Less Than_>Merge;Greater Than_â‰¥Greater Than or Equal to_=Rank;Equals_â‰ Length;Not Equals_â‰¡Depth;Match_â‰¢Shape;Not Match_âŠ£Identity;Left_âŠ¢Identity;Right_â¥ŠDeshape;Reshape_âˆ¾Join;Join to_â‰Solo;Couple_â†‘Prefixes;Take_â†“Suffixes;Drop_â†•Range;Windows_âŒ½Reverse;Rotate_â‰Transpose;Reorder axes_/Indices;Replicate_â‹Grade Up;Bins Up_â’Grade Down;Bins Down_âŠFirst Cell;Select_âŠ‘First;Pick_âŠIndex of_âŠ’Occurrence Count;Progressive Index of_âˆŠUnique Mask;Member of_â·Deduplicate;Find_âŠ”Group Indices;Group_!Assert;Assert with message_ËœSelf/Swap_âˆ˜Atop_â—‹Over_âŠ¸Before/Bind_âŸœAfter/Bind_âŒ¾Under_âŠ˜Valences_â—¶Choose_Ë˜Cells_â‰Rank_Â¨Each_âš‡Depth_âŒœTable_â¼Undo_âŸRepeat_Â´Fold_ËInsert_\`Scan_â†Define_â†©Change_â†’Return_â‹„Separator;(equivalent to ,)_âŸ¨Begin list_âŸ©End list_â€¿Strand_Â·Nothing_â€¢System_ğ•¤Current function (as subject)_ğ•ŠCurrent function_ğ•¨Left argument_ğ•Left argument (as function)_ğ•©Right argument_ğ•Right argument (as function)_ğ•£Current modifier_ğ•—Modifier left operand (as subject)_ğ”½Modifier left operand_ğ•˜2-modifier right operand (as subject)_ğ”¾2-modifier right operand'.split(/[\n_]/);
let kk=Array.from('`1234567890=~!@#$%^&*()_+qwertyuiop[]QWERTYUIOP{}asdfghjkl;\\ASDFGHJKL:"|zxcvbnm,./ZXCVBNM<>? ');
let kv=Array.from('ËœË˜Â¨â¼âŒœÂ´Ë7âˆÂ¯â€¢Ã—Â¬â‰âš‡âŸâ—¶âŠ˜âŠââ•âŸ¨âŸ©âˆšâ‹†âŒ½ğ•¨âˆŠâ†‘âˆ§yâŠ”âŠâŠÏ€â†â†’â†™ğ•â·ğ•£â‹YUâŠ‘âŠ’â³âŠ£âŠ¢â‰ğ•¤â†•ğ•—ğ•˜âŠ¸âˆ˜â—‹âŸœâ‹„\\â†–ğ•ŠDğ”½ğ”¾HJâŒ¾LÂ·Ë™|â¥Šğ•©â†“âˆ¨âŒŠnâ‰¡âˆ¾â‰â‰ Zğ•Câ’âŒˆNâ‰¢â‰¤â‰¥?â€¿');
let keys={}, revkeys={};
kk.map((k,i)=>{keys[k]=kv[i];revkeys[kv[i]]=k;});
doc.kb.innerHTML = keydesc.map(d=>{
  let c = Array.from(d)[0];
  let t = d.slice(c.length).replace(';','\n');
  let k = revkeys[c]; if (k) t += '\n\\ '+k;
  return '<span title="'+t+'">'+c+'</span>'
}).join("&#8203;"); // zero-width space
doc.kb.onmousedown = ev => {
  let t = ev.target;
  if (t.nodeName === 'SPAN') {
    return typeChar(doc.code, t.textContent, ev);
  }
}

doc.perm.onmouseover = doc.perm.onfocus = () => {
  doc.perm.href='#code='+escape(doc.code.value)
}

if (location.hash) {
  let hp={};
  location.hash.substring(1).split(',').map(s=>{
    let[k,v]=s.split('=');hp[k]=unescape(v)
  });
  doc.code.value = hp.code||'';
  if (hp.run) repl();
}
doc.code.focus();
</script>
</body>
</html>
