let body = document.body;
let doc={}; // html elements with a class
body.querySelectorAll('[class]').forEach(e=>doc[e.classList[0]]=e);

let setcount = s=>s;
if (doc.count) {
  let count_activeMin;
  setcount = (s,m) => {
    let l = Array.from(s).length;
    if (l<m && m!==count_activeMin) return;
    count_activeMin = m;
    doc.count.textContent = l<m ? "" : l+" char"+(l!=1?"s":"");
  }
  let c = doc.code;
  c.onmouseup = c.onkeyup = () => {
    let s=c.selectionStart, e=c.selectionEnd;
    setcount(c.value.slice(s,e), 2);
  }
}

let setExplain = e=>e;
let repl = ()=>{
  let s=Array.from(doc.code.value), src=str(s);
  doc.rslt.classList.remove('err');
  doc.rslt.textContent=' '; setExplain();
  setcount(s);
  setTimeout(() => {
    try {
      let out=[]; sysvals.show = (x,w) => { out.push(x); return x; }
      didInitPlot = 0;
      let c=compile(src);
      setExplain(src,c);
      out.push(run.apply(null,c));
      doc.rslt.textContent=out.map(fmt).join('\n');
    } catch(e) {
      doc.rslt.classList.add('err');
      doc.rslt.textContent=fmtErr(e);
    }
    sysvals.js=dojs; // In case it was disabled by fragment loading
  }, 0);
}
if (doc.run) doc.run.onclick = repl;
let exp=0, explain;
if (doc.doexplain) doc.doexplain.onclick = () => {
  if (explain===undefined) {
    let drawEval = run(
      [0,19,33,0,0,48,33,0,1,48,6,1,1,33,0,2,48,6,1,2,33,0,3,48,6,1,3,33,0,4,48,6,1,4,33,0,5,48,6,0,20,0,46,32,0,5,27,0,31,20,0,20,0,50,34,0,5,27,1,5,11,3,0,52,0,16,0,5,0,56,21,27,33,0,6,48,6,32,0,6,32,0,6,0,41,0,21,26,0,69,21,0,21,20,0,24,0,55,21,1,6,11,3,0,52,0,16,0,5,0,56,21,27,33,0,7,48,6,0,43,1,7,26,0,21,0,82,21,33,0,8,48,6,0,55,0,53,32,0,8,0,46,0,11,27,27,0,21,20,0,49,0,21,27,33,0,9,48,6,1,8,33,0,10,48,6,32,0,6,0,40,0,22,26,0,85,0,86,11,2,21,33,0,11,48,6,32,0,9,0,46,34,0,4,27,33,0,12,48,6,1,9,33,0,13,48,6,0,63,0,64,11,2,33,0,14,48,6,0,56,0,55,11,2,0,2,32,0,14,17,33,0,15,48,6,0,56,0,57,11,2,0,3,32,0,14,17,0,0,0,58,0,65,11,2,17,33,0,16,48,6,0,61,33,0,17,48,6,0,89,32,0,10,16,33,0,18,48,6,0,90,32,0,10,16,33,0,19,48,6,0,92,32,0,10,0,91,17,33,0,20,48,6,0,93,32,0,10,0,91,17,33,0,21,48,6,0,94,32,0,10,0,91,17,33,0,22,48,6,0,95,34,0,10,0,91,17,33,0,23,48,6,0,96,0,97,0,21,0,61,0,25,16,0,0,0,70,17,17,0,98,0,99,0,100,0,101,0,102,0,103,0,104,0,105,0,106,0,107,0,21,0,73,17,0,21,0,84,17,0,108,0,109,11,14,0,20,0,46,0,56,11,2,17,0,27,16,0,40,0,11,26,16,33,0,24,33,0,25,12,2,48,6,0,110,0,111,0,112,0,113,0,114,0,115,0,116,11,7,0,21,33,0,24,50,6,1,10,32,0,25,26,33,0,26,48,6,34,0,24,0,41,1,11,26,16,33,0,27,48,6,0,119,33,0,28,48,6,0,122,0,123,0,124,0,125,11,4,0,41,0,121,0,49,0,21,27,0,21,0,120,21,26,16,33,0,29,48,6,1,12,33,0,30,48,7,0,55,0,18,34,0,2,17,0,54,0,17,0,39,0,20,26,0,55,0,56,11,2,21,0,49,0,39,0,41,0,24,0,21,0,75,21,0,21,0,23,21,26,26,27,27,33,0,3,48,6,34,0,1,32,1,1,0,48,32,1,0,0,31,0,50,34,0,3,27,20,0,21,0,48,0,11,27,0,41,0,55,26,21,27,16,7,1,13,33,0,3,48,6,0,76,32,0,2,0,77,11,3,0,21,16,33,0,4,48,6,0,78,32,0,2,0,28,0,69,0,13,34,0,2,17,0,45,0,9,26,16,17,0,77,11,3,0,21,16,33,0,5,48,6,32,0,1,0,16,16,33,0,6,48,0,11,0,55,17,33,0,7,48,6,34,0,5,32,0,7,0,54,0,11,0,46,0,20,27,27,0,47,1,14,34,0,1,34,0,7,0,54,1,15,27,16,26,27,34,0,4,17,0,21,16,7,0,76,34,0,1,0,80,11,3,0,21,16,7,32,0,1,0,60,0,49,0,11,27,0,9,0,11,0,48,0,59,27,21,16,0,43,0,9,26,16,0,37,16,6,0,61,33,0,3,48,0,39,0,4,26,0,57,17,33,0,4,48,6,0,70,0,1,0,81,17,33,0,5,33,0,6,12,2,48,6,0,58,0,11,32,0,1,17,33,0,7,48,6,34,0,1,0,7,16,33,0,8,48,6,34,0,8,0,2,32,0,4,17,0,0,0,62,17,0,5,16,33,0,9,48,6,34,0,7,0,28,16,0,41,34,0,5,26,0,49,0,11,0,47,0,22,27,27,16,0,22,16,32,0,4,0,3,32,0,9,17,0,5,16,1,16,0,48,0,13,0,46,0,25,27,27,16,34,0,9,1,17,0,48,0,13,0,46,0,25,27,27,16,0,13,0,11,0,58,21,0,54,0,21,0,48,0,30,0,46,0,26,0,31,20,0,50,0,41,34,0,6,26,27,27,27,27,16,11,3,0,21,16,0,27,16,0,40,0,21,0,46,0,11,27,26,16,0,43,0,0,0,48,0,70,27,0,49,0,36,27,26,16,7,34,0,1,6,0,58,0,37,16,7,34,0,1,6,0,58,0,37,16,7,34,0,2,0,83,34,0,1,0,84,11,4,0,21,16,7,1,18,33,0,3,48,6,34,0,1,32,0,3,0,72,26,16,0,41,34,0,3,0,71,26,26,16,0,41,32,1,8,26,0,21,20,0,49,0,21,27,0,51,0,12,27,34,0,2,19,7,34,0,1,32,1,3,0,88,34,0,2,32,1,7,16,11,2,32,1,9,0,87,17,17,7,0,32,0,48,32,0,1,0,21,16,27,0,29,34,0,1,0,41,0,13,26,16,0,45,0,0,26,16,21,7,0,118,0,21,34,0,1,17,0,21,0,117,17,7,34,0,2,33,0,3,33,0,4,33,0,5,33,0,6,33,0,7,33,0,8,12,2,33,0,9,12,6,48,6,0,126,0,127,0,128,0,129,0,130,11,5,0,39,0,1,26,0,70,17,0,24,0,48,0,55,27,0,41,0,28,26,0,30,21,16,33,0,10,33,0,11,33,0,12,33,0,13,12,4,48,6,1,19,33,0,14,48,6,32,0,3,34,0,7,11,2,0,41,0,28,0,48,32,0,14,27,26,16,0,41,0,24,26,0,58,0,65,11,2,17,33,0,15,33,0,16,12,2,48,6,34,0,11,0,30,32,0,15,17,33,0,17,48,0,14,0,65,17,33,0,18,48,6,34,0,14,0,28,16,0,39,0,28,0,48,32,0,18,27,0,50,0,18,0,0,0,55,21,0,39,0,30,26,32,0,3,21,27,26,33,0,17,50,6,34,0,12,0,30,32,0,15,17,0,31,0,48,0,65,27,0,50,0,55,27,16,33,0,19,48,6,32,0,17,0,1,32,0,19,17,0,45,0,0,26,16,33,0,20,48,6,32,0,20,0,31,0,65,17,0,14,0,55,17,0,37,16,6,32,0,17,0,11,0,58,17,33,0,21,48,0,2,0,48,0,2,0,48,32,0,19,27,0,45,0,0,26,20,27,16,33,0,22,48,6,34,0,19,0,8,34,0,17,17,0,28,16,0,30,0,48,0,33,0,0,32,0,20,0,49,0,30,27,21,0,29,0,47,0,30,0,48,0,29,27,27,34,0,20,0,24,0,65,17,21,27,16,33,0,23,48,6,34,0,21,0,8,16,0,23,0,48,0,13,27,32,0,23,17,33,0,24,48,6,32,0,1,1,20,34,0,9,17,33,0,25,33,0,26,33,0,27,12,3,48,6,32,0,23,1,21,16,0,13,0,54,0,39,0,30,26,27,16,0,39,0,30,26,32,0,27,0,30,32,0,24,0,45,0,0,26,16,0,39,0,1,26,0,55,17,17,17,0,24,0,65,17,33,0,28,48,6,0,66,0,21,32,0,28,17,33,0,29,48,6,32,0,23,0,18,0,22,0,30,21,34,0,18,0,1,32,0,29,17,0,30,32,0,23,17,0,13,34,0,28,17,0,15,32,0,24,17,0,28,16,17,33,0,30,48,6,32,0,22,0,22,34,0,29,17,0,0,0,62,0,67,11,2,17,0,2,32,1,14,17,0,27,16,32,1,6,16,0,30,34,0,30,17,0,44,0,39,0,40,0,26,0,49,0,21,27,0,41,0,21,26,0,133,21,0,21,20,0,46,0,11,27,26,26,26,16,33,0,31,48,6,32,0,22,0,30,34,0,23,0,28,32,0,24,17,17,0,41,0,22,0,2,32,1,14,21,0,0,32,1,16,21,0,46,32,1,11,32,1,9,0,134,21,27,26,34,0,27,17,33,0,32,48,6,32,1,15,0,2,0,56,0,58,11,2,17,0,0,34,0,1,0,13,16,34,0,22,0,43,0,6,26,16,0,0,0,56,17,11,2,0,2,32,1,14,17,17,33,0,33,48,6,32,0,33,32,1,6,16,0,40,0,22,26,0,136,0,137,11,2,17,0,21,32,1,15,0,1,16,32,1,11,16,17,0,21,32,1,19,17,32,1,12,0,135,17,0,11,16,34,0,25,32,1,3,0,134,17,0,11,16,34,0,31,0,41,0,19,0,11,0,47,0,22,27,0,139,21,0,21,32,1,18,21,32,1,12,0,138,21,26,16,34,0,26,0,41,0,21,26,0,19,0,41,32,1,3,26,34,0,32,21,0,47,0,11,0,47,0,22,27,27,0,41,0,31,0,48,0,55,27,26,21,16,0,41,32,1,3,26,32,1,22,32,1,23,11,2,17,32,1,3,32,1,21,17,11,4,0,41,0,20,26,16,0,21,16,32,1,3,32,1,20,17,32,1,13,32,1,17,0,2,0,56,17,0,0,34,0,33,17,0,38,0,56,26,0,3,0,39,0,1,26,21,0,39,0,1,26,32,1,15,0,0,32,1,17,17,21,0,39,0,21,26,0,18,21,0,48,0,6,0,48,0,68,0,58,11,2,27,27,16,17,7,34,0,1,0,20,16,0,58,0,46,0,37,27,0,11,0,20,20,0,19,0,41,34,0,0,26,0,21,20,11,4,0,52,0,16,0,5,0,57,21,27,16,7,34,0,2,34,0,4,34,0,1,11,3,7,34,0,1,0,20,16,32,1,6,0,15,0,57,17,0,54,0,41,32,1,3,26,0,21,20,27,16,0,41,0,21,0,48,0,79,27,26,16,7,32,0,1,0,15,32,1,3,17,33,0,3,48,6,34,0,2,34,0,1,11,2,0,22,0,26,0,31,20,0,50,0,7,0,48,32,1,3,27,27,0,21,0,43,0,28,0,48,32,0,3,27,0,47,32,1,3,0,49,0,3,27,0,5,20,0,49,34,0,0,27,27,26,21,11,2,0,52,34,0,3,0,43,0,10,26,16,27,16,7,32,0,1,0,7,32,1,4,17,33,0,1,49,0,2,16,33,0,3,48,6,34,0,1,0,58,0,56,11,2,0,25,16,0,28,0,48,32,0,3,27,0,47,0,2,0,48,32,1,3,27,0,49,34,0,0,0,21,32,1,4,0,49,0,3,27,0,5,20,0,49,0,11,0,47,0,22,27,27,21,27,27,11,2,0,52,34,0,3,0,43,0,10,26,16,27,34,0,2,19,7,0,36,0,48,0,14,0,48,34,0,1,27,0,1,0,48,0,8,0,2,0,45,0,0,26,21,27,20,27,7,32,1,3,0,19,0,2,0,12,0,48,0,13,27,21,0,39,0,30,26,0,18,21,32,1,10,17,0,0,0,55,17,0,0,32,1,3,0,13,16,0,25,16,17,33,0,0,48,6,0,19,0,31,0,65,21,0,14,0,58,21,0,54,1,22,27,33,0,1,48,6,34,0,0,0,41,0,58,26,0,21,0,55,21,32,0,1,0,13,0,49,0,21,27,21,0,23,0,13,21,16,7,34,0,2,33,0,3,33,0,4,33,0,5,33,0,6,33,0,7,12,5,48,6,32,2,25,0,13,16,33,0,8,48,6,32,0,1,0,30,32,0,6,17,32,2,26,16,0,14,0,48,32,0,8,27,0,2,0,1,21,0,0,0,19,21,34,0,4,0,0,0,57,17,0,0,34,0,8,17,17,0,39,0,30,26,32,2,27,17,33,0,9,48,6,32,0,7,0,41,0,131,26,16,33,0,10,48,6,32,0,9,0,21,32,0,10,17,33,0,11,48,6,0,61,0,0,0,74,17,0,14,32,0,1,17,0,28,16,33,0,12,48,6,32,0,1,0,30,0,48,32,0,12,27,0,50,0,132,0,30,32,0,6,0,34,34,0,12,17,17,27,16,33,0,1,49,6,32,0,1,0,32,32,2,28,17,33,0,13,48,0,12,0,48,0,13,27,32,2,28,17,33,0,14,48,0,8,16,0,28,16,33,0,15,48,6,32,0,13,0,28,32,0,14,17,0,39,0,30,26,32,2,29,17,0,39,0,21,26,33,0,11,50,6,0,55,0,1,32,0,6,17,0,21,32,0,7,17,0,21,34,0,14,0,28,16,17,0,28,32,0,11,0,41,0,13,26,16,17,0,21,32,0,15,17,0,29,16,33,0,16,48,6,34,0,11,0,21,16,0,21,32,0,1,0,30,34,0,15,17,17,0,30,32,0,16,17,33,0,17,48,6,0,55,0,21,32,2,29,0,41,0,13,26,16,17,0,30,34,0,13,17,33,0,18,48,6,32,0,17,0,28,0,48,0,13,0,46,0,25,27,0,12,32,0,18,0,43,0,0,26,16,21,0,30,34,0,16,21,27,16,33,0,19,48,6,34,0,9,32,0,7,0,0,0,55,17,0,42,0,28,26,0,23,34,0,1,0,13,16,21,0,45,0,0,26,20,0,47,0,12,0,2,0,18,21,27,32,0,6,17,0,39,0,1,26,0,55,17,0,28,34,0,18,17,0,39,0,36,26,34,0,19,17,34,0,10,11,3,0,12,16,0,27,16,0,40,0,11,26,16,33,0,20,48,6,32,1,16,0,28,32,1,24,17,0,32,32,0,6,17,33,0,21,48,6,34,0,17,34,0,20,0,30,32,0,21,17,0,56,0,3,34,0,7,0,0,34,0,6,17,17,0,30,34,0,21,17,11,3,7,32,0,1,0,29,16,33,0,3,48,0,39,0,30,26,34,0,1,17,33,0,4,48,6,32,1,15,0,13,16,0,25,16,0,30,0,48,32,0,4,0,35,16,27,0,50,32,1,13,0,30,32,1,15,17,0,30,32,0,4,17,0,14,34,0,4,0,33,16,17,0,39,0,28,26,34,0,3,17,27,16,7,32,0,1,0,30,0,48,32,0,2,0,28,34,0,1,17,27,0,50,0,41,0,55,26,27,16,32,1,1,34,0,2,0,39,0,30,26,16,17,7]
     ,[runtime[0],runtime[1],runtime[2],runtime[3],runtime[4],runtime[6],runtime[7],runtime[8],runtime[9],runtime[10],runtime[11],runtime[12],runtime[13],runtime[14],runtime[15],runtime[16],runtime[18],runtime[19],runtime[20],runtime[21],runtime[22],runtime[23],runtime[24],runtime[25],runtime[26],runtime[27],runtime[30],runtime[31],runtime[32],runtime[33],runtime[35],runtime[36],runtime[37],runtime[38],runtime[39],runtime[40],runtime[41],runtime[42],runtime[43],runtime[44],runtime[45],runtime[46],runtime[48],runtime[49],runtime[50],runtime[51],runtime[52],runtime[53],runtime[54],runtime[55],runtime[56],runtime[57],runtime[58],runtime[59],runtime[61],1,2,3,0,-Infinity,Infinity,10,0.5,10.84,24,-1,-1.25,0.1,512,' ','0','=','|','\"','\0',str("t"),str("<"),str(">"),str("</"),str("  "),str("/>"),str("-."),str(" "),str("=\'"),str("\'"),str("x"),str("y"),str("svg"),str("viewBox"),str("stroke=currentColor|fill=none|stroke-width=1"),str("class=code|stroke-width=1|rx=10"),str("g"),str("font-family=BQN,monospace|font-size=18px|class=Paren|fill=currentColor"),str("font-size=15px|text-anchor=middle"),str("class=codeCover|stroke-width=8|stroke-linejoin=round"),str("opacity=0.9"),str("Number"),str("¬Ø.œÄ‚àû"),str("Paren"),str("()"),str("Bracket"),str("‚ü®‚ü©"),str("Brace"),str("{}"),str("Nothing"),str("¬∑"),str("String"),str("@"),str("Comment"),str("#"),str("Gets"),str("Ligature"),str("Separator"),str("Value"),str("Function"),str("Modifier"),str("Modifier2"),str("<tspan class=\'"),str("\'>"),str("\"&<>"),str("&"),str(";"),str("quot"),str("amp"),str("lt"),str("gt"),str("114113141111111311411413141111=111"),str("1110001100000000000222110000000111"),str("000111//23232303232000001122232111"),str("1110001111111101111111110101111111"),str("0000000011111101010000000000010000"),str("</tspan>"),str(" ‚ãÑ"),str("M VH"),str("text"),str("rect"),str("width"),str("height"),str("path"),str("d")]
     ,[[0,1,0],[0,0,1],[0,0,[[],[2]]],[0,0,3],[0,0,4],[0,0,5],[0,0,6],[0,0,[[],[7]]],[0,0,8],[0,0,[[],[9]]],[1,1,10],[0,0,11],[0,0,[[],[12]]],[0,0,13],[1,0,[[],[14]]],[0,0,15],[0,0,[[],[16]]],[0,0,17],[1,1,18],[0,1,19],[0,0,[[],[20]]],[0,0,21],[0,0,[[],[22]]]]
     ,[[0,31],[516,4],[603,8],[723,3],[736,10],[987,3],[997,3],[1007,3],[1023,4],[1074,3],[1099,2],[1129,3],[1143,34],[2073,3],[2116,5],[2128,3],[2167,4],[2257,4],[2358,2],[2388,2],[2490,22],[3020,5],[3102,3]]
    );
    explain = (s,c) => {
      let e = doc.explain;
      e.innerHTML = s?drawEval(s,c).map(l=>l.join("")).join("\n"):'';
      setTimeout(() => {
        e.querySelectorAll('tspan').forEach(t => {
          let h = primhelp[t.textContent];
          if (!h) return;
          t.innerHTML = t.textContent+'<title>'+h+'</title>';
        });
      }, 0);
    }
  }
  explain(); // Clear
  setExplain = doc.doexplain.classList.toggle('selected')
             ? explain : (e=>e);
}

let makePlot,setPlot,initPlot,didInitPlot;
let startPlot = () => {
  if (!makePlot) [makePlot,initPlot,setPlot] = run(
    [0,19,33,0,0,48,33,0,1,48,6,1,1,33,0,2,48,6,1,2,33,0,3,48,6,1,3,33,0,4,48,6,1,4,33,0,5,48,6,0,20,0,42,32,0,5,27,0,30,20,0,20,0,46,34,0,5,27,1,5,11,3,0,48,0,16,0,5,0,52,21,27,33,0,6,48,6,32,0,6,32,0,6,0,37,0,21,26,0,65,21,0,21,20,0,24,0,51,21,1,6,11,3,0,48,0,16,0,5,0,52,21,27,33,0,7,48,6,0,39,1,7,26,0,21,0,78,21,33,0,8,48,6,0,51,0,49,32,0,8,0,42,0,11,27,27,0,21,20,0,45,0,21,27,33,0,9,48,6,1,8,33,0,10,48,6,32,0,6,0,36,0,22,26,0,81,0,82,11,2,21,33,0,11,48,6,32,0,9,0,42,34,0,4,27,33,0,12,48,6,1,9,33,0,13,48,6,0,59,33,0,14,48,6,0,57,0,20,0,52,17,33,0,15,48,6,0,69,33,0,16,48,6,1,10,33,0,17,48,6,1,11,33,0,18,48,6,0,86,32,0,10,16,33,0,19,48,6,0,87,32,0,10,16,33,0,20,48,6,0,88,32,0,10,16,33,0,21,48,6,0,89,32,0,10,16,33,0,22,48,6,0,91,34,0,10,0,90,17,33,0,23,48,6,0,19,0,11,0,43,0,22,27,0,93,21,0,21,0,18,21,32,0,12,0,92,21,33,0,24,48,6,1,12,33,0,25,48,6,1,13,33,0,26,48,6,1,14,33,0,27,48,6,34,0,27,34,0,17,34,0,18,11,3,7,0,51,0,18,34,0,2,19,0,50,0,17,0,35,0,20,26,0,51,0,52,11,2,21,0,45,0,35,0,37,0,24,0,21,0,71,21,0,21,0,23,21,26,26,27,27,33,0,3,48,6,34,0,1,32,1,1,0,44,32,1,0,0,30,0,46,34,0,3,27,20,0,21,0,44,0,11,27,0,37,0,51,26,21,27,16,7,1,15,33,0,3,48,6,0,72,32,0,2,0,73,11,3,0,21,16,33,0,4,48,6,0,74,32,0,2,0,28,0,65,0,13,34,0,2,19,0,41,0,9,26,16,19,0,73,11,3,0,21,16,33,0,5,48,6,32,0,1,0,16,16,33,0,6,48,0,11,0,51,17,33,0,7,48,6,34,0,5,32,0,7,0,50,0,11,0,42,0,20,27,27,0,43,1,16,34,0,1,34,0,7,0,50,1,17,27,16,26,27,34,0,4,17,0,21,16,7,0,72,34,0,1,0,76,11,3,0,21,16,7,32,0,1,0,56,0,45,0,11,27,0,9,0,11,0,44,0,55,27,21,16,0,39,0,9,26,16,0,33,16,6,0,57,33,0,3,48,0,35,0,4,26,0,53,17,33,0,4,48,6,0,66,0,1,0,77,17,33,0,5,33,0,6,12,2,48,6,0,54,0,11,32,0,1,17,33,0,7,48,6,34,0,1,0,7,16,33,0,8,48,6,34,0,8,0,2,32,0,4,17,0,0,0,58,17,0,5,16,33,0,9,48,6,34,0,7,0,28,16,0,37,34,0,5,26,0,45,0,11,0,43,0,22,27,27,16,0,22,16,32,0,4,0,3,32,0,9,17,0,5,16,1,18,0,44,0,13,0,42,0,25,27,27,16,34,0,9,1,19,0,44,0,13,0,42,0,25,27,27,16,0,13,0,11,0,54,21,0,50,0,21,0,44,0,29,0,42,0,26,0,30,20,0,46,0,37,34,0,6,26,27,27,27,27,16,11,3,0,21,16,0,27,16,0,36,0,21,0,42,0,11,27,26,16,0,39,0,0,0,44,0,66,27,0,45,0,32,27,26,16,7,34,0,1,6,0,54,0,33,16,7,34,0,1,6,0,54,0,33,16,7,34,0,2,0,79,34,0,1,0,80,11,4,0,21,16,7,1,20,33,0,3,48,6,34,0,1,32,0,3,0,68,26,16,0,37,34,0,3,0,67,26,26,16,0,37,32,1,8,26,0,21,20,0,45,0,21,27,0,47,0,12,27,34,0,2,19,7,34,0,1,32,1,3,0,84,34,0,2,32,1,7,18,11,2,32,1,9,0,83,17,17,7,34,0,0,6,0,85,33,1,16,49,7,34,0,0,6,34,0,1,33,1,16,49,7,32,0,1,0,54,0,12,0,44,0,69,27,0,20,0,42,0,39,0,9,26,27,20,11,2,0,48,0,14,0,15,0,51,21,27,0,43,0,9,0,47,0,19,27,27,32,0,2,19,0,33,0,94,17,6,32,0,1,0,17,0,30,0,60,21,0,43,0,16,27,0,47,0,51,27,32,0,2,19,0,33,0,95,17,6,34,0,1,0,51,0,49,0,19,0,11,0,43,0,22,27,0,18,0,47,0,17,0,30,0,60,21,0,25,20,27,21,0,11,20,27,34,0,2,19,0,20,16,7,32,0,1,0,16,0,43,0,22,27,32,0,2,19,33,0,3,48,6,34,0,1,0,34,32,0,3,26,0,14,0,51,21,0,39,0,9,26,20,0,33,0,96,21,0,18,32,1,25,21,0,37,34,0,0,26,0,20,0,42,0,21,27,20,11,2,0,48,34,0,3,0,39,0,5,26,16,0,15,0,52,17,27,34,0,2,19,7,34,0,1,32,1,26,34,0,2,19,0,12,16,0,27,16,0,5,0,6,0,44,0,1,27,0,18,21,0,61,17,33,0,3,48,6,32,0,3,0,36,0,21,0,42,0,11,27,26,16,33,0,4,48,6,1,21,33,0,5,48,6,32,0,4,0,37,0,39,0,6,26,0,22,0,39,0,5,26,21,34,0,5,20,26,16,33,0,6,48,0,37,0,41,0,35,0,1,26,26,26,16,33,0,7,48,6,32,0,7,0,37,0,30,26,0,51,17,0,39,0,35,0,3,26,26,16,0,11,0,44,0,64,27,0,10,0,12,0,44,0,63,0,3,16,27,21,0,50,0,51,27,16,33,0,8,48,6,34,0,8,0,2,0,22,0,18,21,32,1,14,17,33,0,9,48,6,0,19,0,37,1,22,26,34,0,7,0,37,0,39,1,23,26,26,16,0,30,0,44,0,51,27,0,46,1,24,27,16,21,33,0,10,48,6,34,0,4,32,0,10,16,0,2,32,0,9,17,0,12,16,0,27,16,32,1,6,16,0,32,34,0,3,0,29,16,0,37,0,13,26,16,0,28,16,17,33,0,11,48,6,0,37,1,25,32,1,24,32,1,20,21,26,0,21,0,42,0,36,0,11,26,27,0,37,0,19,0,36,0,22,26,0,100,0,101,11,2,21,0,21,32,1,21,21,32,1,12,0,99,21,26,20,11,2,0,30,32,1,16,0,11,0,46,0,31,0,44,0,85,0,97,11,2,27,27,16,17,33,0,12,48,6,32,1,15,0,0,32,0,9,17,32,1,6,16,0,36,0,22,26,0,103,0,104,11,2,17,0,21,0,52,0,3,32,1,15,17,0,1,16,32,1,11,16,17,0,21,32,1,22,17,32,1,12,0,102,17,0,11,16,0,54,34,0,10,16,0,2,0,44,0,52,0,25,16,0,35,0,38,0,14,26,26,16,27,0,18,0,42,0,26,27,0,36,0,21,26,0,2,21,32,0,9,21,32,1,6,20,0,37,0,21,26,0,106,0,36,0,21,0,44,0,105,27,26,16,21,0,36,0,21,0,42,0,11,27,26,20,0,28,0,51,0,45,0,15,27,0,9,0,15,0,44,0,54,27,21,21,16,0,37,32,1,24,0,44,32,1,19,27,26,16,34,0,11,34,0,12,16,11,3,0,37,0,20,26,16,0,21,16,32,1,3,32,1,23,17,32,1,13,32,1,15,0,2,0,52,17,0,0,34,0,9,17,0,21,32,1,15,0,1,16,17,17,7,34,0,1,0,20,16,0,54,0,42,0,33,27,0,11,0,20,20,0,19,0,37,34,0,0,26,0,21,20,11,4,0,48,0,16,0,5,0,53,21,27,16,7,34,0,2,34,0,4,34,0,1,11,3,7,34,0,1,0,20,16,32,1,6,0,15,0,53,17,0,50,0,37,32,1,3,26,0,21,20,27,16,0,37,0,21,0,44,0,75,27,26,16,7,32,0,1,0,15,32,1,3,17,33,0,3,48,6,34,0,2,34,0,1,11,2,0,22,0,26,0,30,20,0,46,0,7,0,44,32,1,3,27,27,0,21,0,39,0,28,0,44,32,0,3,27,0,43,32,1,3,0,45,0,3,27,0,5,20,0,45,34,0,0,27,27,26,21,11,2,0,48,34,0,3,0,39,0,10,26,16,27,16,7,32,0,1,0,7,32,1,4,17,33,0,1,49,0,2,16,33,0,3,48,6,34,0,1,0,54,0,52,11,2,0,25,16,0,28,0,44,32,0,3,27,0,43,0,2,0,44,32,1,3,27,0,45,34,0,0,0,21,32,1,4,0,45,0,3,27,0,5,20,0,45,0,11,0,43,0,22,27,27,21,27,27,11,2,0,48,34,0,3,0,39,0,10,26,16,27,34,0,2,19,7,0,32,0,44,0,14,0,44,34,0,1,27,0,1,0,44,0,8,0,2,0,41,0,0,26,21,27,20,27,7,32,0,1,0,7,16,0,39,0,6,26,0,2,0,18,21,0,62,0,3,16,17,33,0,3,48,6,34,0,1,0,54,34,0,3,11,2,0,45,0,1,27,0,46,0,40,0,6,0,22,0,5,21,26,27,16,7,34,0,1,34,0,2,16,7,0,19,0,35,0,1,26,34,0,2,23,0,35,0,3,26,34,0,1,21,7,34,0,1,0,8,20,7,34,0,1,0,51,0,49,0,37,0,21,26,27,0,98,17,0,20,16,0,21,16,0,30,0,46,0,70,27,16,7]
   ,[runtime[0],runtime[1],runtime[2],runtime[3],runtime[4],runtime[6],runtime[7],runtime[8],runtime[9],runtime[10],runtime[11],runtime[12],runtime[13],runtime[14],runtime[15],runtime[16],runtime[18],runtime[19],runtime[20],runtime[21],runtime[22],runtime[23],runtime[24],runtime[25],runtime[26],runtime[27],runtime[30],runtime[31],runtime[32],runtime[35],runtime[36],runtime[37],runtime[41],runtime[42],runtime[43],runtime[44],runtime[45],runtime[46],runtime[47],runtime[49],runtime[50],runtime[51],runtime[52],runtime[53],runtime[54],runtime[55],runtime[56],runtime[57],runtime[58],runtime[59],runtime[61],1,2,3,0,-Infinity,Infinity,10,0.5,384,-1,1e300,5000000000000000,4,1.5,' ','0','=','|','\0','M',str("t"),str("<"),str(">"),str("</"),str("  "),str("/>"),str("-."),str(" "),str("=\'"),str("\'"),str("x"),str("y"),str("svg"),str("viewBox"),str("line"),str("class=Paren|stroke=currentColor|stroke-width=1"),str("class=red|style=fill:none|stroke-width=1"),str("class=red|r=4"),str("class=code|stroke-width=1|rx=5"),str("g"),str("font-family=BQN,monospace|font-size=18px"),str("path"),str("d"),str("‚Ä¢Plot: ùï® and ùï© must consist of rows of numbers"),str("‚Ä¢Plot: ùï® and ùï© must have the same length"),str("‚Ä¢Plot: invalid depth mixing"),str("scatter"),str("L "),str("circle"),str("cx"),str("cy"),str("rect"),str("width"),str("height"),str("M "),str("VH")]
   ,[[0,1,0],[0,0,1],[0,0,[[],[2]]],[0,0,3],[0,0,4],[0,0,5],[0,0,6],[0,0,[[],[7]]],[0,0,8],[0,0,[[],[9]]],[0,0,10],[0,0,11],[0,0,12],[0,0,13],[0,0,14],[0,0,15],[1,0,[[],[16]]],[0,0,17],[0,0,[[],[18]]],[0,0,19],[1,1,20],[0,0,21],[0,0,[[],[22]]],[0,0,23],[0,0,24],[0,0,25]]
   ,[[0,28],[365,4],[452,8],[572,3],[585,10],[836,3],[846,3],[856,3],[872,4],[923,3],[948,3],[959,3],[971,3],[1100,4],[1188,13],[1754,3],[1797,5],[1809,3],[1848,4],[1938,4],[2039,2],[2069,4],[2126,3],[2134,3],[2155,3],[2162,3]]
  );
  if (!didInitPlot) { initPlot('\0'); didInitPlot=1; }
}
sysvals.plot = (x,w) => {
  startPlot();
  doc.explain.innerHTML = makePlot(x,w).map(l=>l.join("")).join("\n");
  setExplain = () => doc.explain.innerHTML = '';
  return '\0';
}
sysvals.setplot = (x,w) => { startPlot(); setPlot(x,w); }

let keymode=0; // 1 for prefix
let prefix='\\';
doc.code.onkeydown = ev => {
  let k = ev.which;
  if (16<=k && k<=20) {
    return;
  } if (k==13 && (ev.shiftKey||ev.ctrlKey||ev.altKey||ev.metaKey)) { // *-enter
    repl(); return false;
  } if (keymode) {
    keymode = 0;
    doc.kb.classList.remove('prefix');
    let c = keys[ev.key];
    if (c) return typeChar(ev.target, c, ev);
  } else if (ev.key==prefix) {
    keymode = 1;
    doc.kb.classList.add('prefix');
    ev.preventDefault();
  }
}
let typeChar = (t, c, ev) => {
  ev.preventDefault();
  let v = t.value;
  let i = t.selectionStart;
  t.value = v.slice(0,i)+c+v.slice(t.selectionEnd);
  t.selectionStart = t.selectionEnd = i+c.length;
  return false;
}

let syncls={ v:"Value", f:"Function", m:"Modifier", d:"Modifier2", n:"Number", g:"Gets", p:"Paren", b:"Bracket", k:"Brace", l:"Ligature", n:"Nothing", s:"Separator", c:"Comment", a:"String" };
let keydesc='f+Conjugate;Add_f-Negate;Subtract_f√óSign;Multiply_f√∑Reciprocal;Divide_f‚ãÜExponential;Power_f‚àöSquare Root;Root_f‚åäFloor;Minimum_f‚åàCeiling;Maximum_f‚àßSort Up;And_f‚à®Sort Down;Or_f¬¨Not;Span_f|Absolute Value;Modulus_f‚â§Less Than or Equal to_f<Enclose;Less Than_f>Merge;Greater Than_f‚â•Greater Than or Equal to_f=Rank;Equals_f‚â†Length;Not Equals_f‚â°Depth;Match_f‚â¢Shape;Not Match_f‚ä£Identity;Left_f‚ä¢Identity;Right_f‚•äDeshape;Reshape_f‚àæJoin;Join to_f‚âçSolo;Couple_f‚ÜëPrefixes;Take_f‚ÜìSuffixes;Drop_f‚ÜïRange;Windows_f¬´Shift Before_f¬ªShift After_f‚åΩReverse;Rotate_f‚çâTranspose;Reorder axes_f/Indices;Replicate_f‚çãGrade Up;Bins Up_f‚çíGrade Down;Bins Down_f‚äèFirst Cell;Select_f‚äëFirst;Pick_f‚äêClassify;Index of_f‚äíOccurrence Count;Progressive Index of_f‚àäMark First;Member of_f‚ç∑Deduplicate;Find_f‚äîGroup Indices;Group_f!Assert;Assert with message_mÀôConstant_mÀúSelf/Swap_d‚àòAtop_d‚óãOver_d‚ä∏Before/Bind_d‚üúAfter/Bind_d‚åæUnder_d‚äòValences_d‚ó∂Choose_d‚éäCatch_d‚éâRank_mÀòCells_d‚öáDepth_m¬®Each_m‚åúTable_d‚çüRepeat_m‚ÅºUndo_m¬¥Fold_mÀùInsert_m`Scan_g‚ÜêDefine_g‚áêExport_g‚Ü©Change_g‚ÜíReturn_s‚ãÑSeparator_s,Separator_v.Namespace field_p(Begin expression_p)End expression_k{Begin block_k}End block_b‚ü®Begin list_b‚ü©End list_l‚ÄøStrand_n¬∑Nothing_v‚Ä¢System_vùï®Left argument_fùïéLeft argument (as function)_vùï©Right argument_fùïèRight argument (as function)_vùïóModifier left operand (as subject)_fùîΩModifier left operand_vùïò2-modifier right operand (as subject)_fùîæ2-modifier right operand_vùï§Current function (as subject)_fùïäCurrent function_mùï£Current modifier_n¬ØMinus_nœÄPi_n‚àûInfinity_a@Null character_c#Comment'.split(/[\n_]/);
let kk=Array.from('`123456890-=~!@#$%^&*()_+qwertuiop[]QWERTIOP{}asdfghjkl;ASFGHKL:"zxcvbm,./ZXVBM<>? \'');
let kv=Array.from('ÀúÀò¬®‚Åº‚åú¬¥Àù‚àû¬Ø‚Ä¢√∑√ó¬¨‚éâ‚öá‚çü‚ó∂‚äò‚éä‚çé‚çï‚ü®‚ü©‚àö‚ãÜ‚åΩùï®‚àä‚Üë‚àß‚äî‚äè‚äêœÄ‚Üê‚Üí‚Üôùïé‚ç∑ùï£‚çã‚äë‚äí‚ç≥‚ä£‚ä¢‚çâùï§‚Üïùïóùïò‚ä∏‚àò‚óã‚üú‚ãÑ‚ÜñùïäùîΩùîæ¬´‚åæ¬ª¬∑Àô‚•äùï©‚Üì‚à®‚åä‚â°‚àæ‚âç‚â†‚ãàùïè‚çí‚åà‚â¢‚â§‚â•‚áê‚Äø‚Ü©');
let keys={}, revkeys={}, primhelp={};
kk.map((k,i)=>{keys[k]=kv[i];revkeys[kv[i]]=k;});
doc.kb.innerHTML = keydesc
  .map(d=>'<span class="'+syncls[d[0]]+'">'+Array.from(d)[1]+'</span>')
  .concat(['<a href="keymap.html" target="_blank">map</a>'])
  .join("&#8203;"); // zero-width space
let setPrefix = () => {
  doc.kb.querySelectorAll("span").forEach((x,i) => {
    let d = keydesc[i];
    let c = Array.from(d)[1];
    let t = d.slice(1+c.length).replace(';','\n');
    let k = revkeys[c]; if (k) t += '\n'+prefix+(k==='"'?'&quot;':k);
    x.title = primhelp[c] = t;
  });
}
setPrefix();
doc.kb.onmousedown = ev => {
  let t = ev.target;
  if (t.nodeName === 'SPAN') {
    return typeChar(doc.code, t.textContent, ev);
  }
}

let appendHTML = (e,a) => e.insertAdjacentHTML('beforeend', a);
appendHTML(doc.kb, '<div class="kbext"></div>');
doc.kbext = doc.kb.querySelector('.kbext');

if (doc.demo) {
  let fonts=[["BQN386"],["DejaVu","Mod"],["Fairfax","HD"],["3270","font"],["Iosevka","Term"],["Julia","Mono"]];
  let fclass = f => f==="3270"?"f"+f:f
  let fontsel = '<select>'+fonts.map(f =>
      '<option value="'+f[0]+'">'+f[0]+(f[1]?' '+f[1]:'')+'</option>'
    ).join("")+'select';
  appendHTML(doc.kbext, fontsel);
  doc.kbext.querySelector('select').onchange =
    e=>doc.cont.className='cont '+fclass(e.target.value);
}

appendHTML(doc.kbext, '<input class="prfx" type="text" maxlength="1" value="'+prefix+'"/>');
doc.kbext.querySelector(".prfx").onchange = ev => {
  prefix = ev.target.value; setPrefix();
}

if (doc.perm) doc.perm.onmouseover = doc.perm.onfocus = () => {
  let b=(new TextEncoder()).encode(doc.code.value);
  doc.perm.href='#code='+btoa(String.fromCharCode(...b));
}

let demo = 0;
if (doc.demo) doc.demo.onclick = () => {
  const demos = [
    '<‚üú\'a\'‚ä∏/ "Big Questions Notation"'
   ,'‚â†‚åúÀú 8 ‚•ä 0‚Äø1'
   ,'+¬¥ 1 + ‚Üï100'
   ,'(+¬¥ √∑ ‚â†) 2‚Äø5‚Äø7‚Äø4'
   ,'+`-Àù "()" =‚åú "(2√ó(4-1)√∑(‚àö9))"'
   ,'(‚äë + ‚Üï‚àò¬¨Àú¬¥) "CG"'
   ,'0‚Äø1‚Äø10‚Äø100‚ä∏‚çã‚ä∏‚äî ‚ü®6,11,9,20,105,1,¬Ø1,4‚ü©'
   ,'{(+`ùï©<\'a\') ‚äî ùï©} "camelCaseWord"'
   ,'3‚Äø4‚Äø2‚åæ(0‚Äø0‚ä∏‚çâ) 3‚Äø3‚•ä¬Ø1'
   ,'‚àæ (<Àò ‚âç¬®¬® 1‚Üì‚Üì) "abcd"'
   ,'Life‚Üê{‚à®¬¥1‚Äøùï©‚àß3‚Äø4=+Àù‚•ä‚åΩ‚üúùï©¬®1-Àú‚Üï3‚Äø3}\nLife‚çü(‚Üï4) 6‚Äø6‚Üë(1‚ä∏=‚à®5‚ä∏‚â§)3‚Äø3‚•ä‚Üï9'
   ,'‚•ä 1‚Äø0‚Äø1 ‚àß‚åú‚çü3 1'
   ,'‚åàÀù (‚â† ‚Üï 0‚Äø0‚ä∏‚àæ) 1‚Äø2‚Äø5‚Äø4‚Äø0‚Äø2‚Äø1'
  ];
  ++demo; if (demo===demos.length) demo=0;
  doc.code.value = demos[demo]; repl();
}

if (location.hash) {
  let code, run=1, ee=0;
  location.hash.slice(1).split('&').map(s => {
    if (s.slice(0,5)==='code=') code=s.slice(5);
    if (s.slice(0,5)==='norun') run=0;
    if (s.slice(0,7)==='explain') ee=1;
  });
  if (code!==undefined) {
    let b=new Uint8Array([...atob(code)].map(c=>c.charCodeAt(0)));
    let c=doc.code.value=(new TextDecoder()).decode(b);
    setcount(c); doc.code.rows = Math.max(doc.code.rows, 1+c.split("\n").length);
    if (ee && doc.doexplain) doc.doexplain.onclick();
    nojs = () => { throw Error("Possible script injection; press Run to confirm"); }
    if (run) { sysvals.js=nojs; repl(); }
    doc.code.focus();
  }
}
