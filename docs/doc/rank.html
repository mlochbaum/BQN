<head>
  <meta charset="utf-8">
  <link href="../favicon.ico" rel="shortcut icon" type="image/x-icon"/>
  <link href="../style.css" rel="stylesheet"/>
  <title>BQN: Cells and Rank</title>
</head>
<div class="nav">(<a href="https://github.com/mlochbaum/BQN">github</a>) / <a href="../index.html">BQN</a> / <a href="index.html">doc</a></div>
<h1 id="cells-and-rank"><a class="header" href="#cells-and-rank">Cells and Rank</a></h1>
<svg viewBox='-13.8 -12 506 240'>
  <g font-size='18px' fill='currentColor' font-family='BQN,monospace' text-anchor='middle'>
    <rect class='code' stroke-width='1.5' rx='12' x='0' y='0' width='478.4' height='216'/>
    <g font-size='24px' fill='currentColor' opacity='0.9' text-anchor='start'><text dy='0.33em' x='9.2' y='0'>Cells</text></g>
    <g transform='translate(55.2,96)'>
      <g stroke-width='0.3' fill='none' stroke='currentColor'>
        <rect x='-11' y='-11' width='160' height='22'/>
        <rect x='-11' y='29' width='160' height='22'/>
        <rect x='-11' y='69' width='160' height='22'/>
      </g>
      <text dy='0.33em' x='0' y='0'><tspan class='Number'>0</tspan></text>
      <text dy='0.33em' x='46' y='0'><tspan class='Number'>0</tspan></text>
      <text dy='0.33em' x='92' y='0'><tspan class='Number'>0</tspan></text>
      <text dy='0.33em' x='138' y='0'><tspan class='Number'>0</tspan></text>
      <text dy='0.33em' x='0' y='40'><tspan class='Number'>0</tspan></text>
      <text dy='0.33em' x='46' y='40'><tspan class='Number'>1</tspan></text>
      <text dy='0.33em' x='92' y='40'><tspan class='Number'>0</tspan></text>
      <text dy='0.33em' x='138' y='40'><tspan class='Number'>5</tspan></text>
      <text dy='0.33em' x='0' y='80'><tspan class='Number'>0</tspan></text>
      <text dy='0.33em' x='46' y='80'><tspan class='Number'>2</tspan></text>
      <text dy='0.33em' x='92' y='80'><tspan class='Number'>0</tspan></text>
      <text dy='0.33em' x='138' y='80'><tspan class='Number'>0</tspan></text>
      <path class='bluegreen' stroke-width='2' stroke-linecap='round' style='fill:none' opacity='0.7' d='M142 99h15v-15M3.5 -19h-22.5v22.5'/>
      <rect stroke-width='0.3' fill='none' stroke='currentColor' x='-11' y='-55' width='160' height='22'/>
      <path class='green' stroke-width='3' stroke-linecap='round' opacity='0.2' d='M101.2 92v-76h23l-55.2 -56l-55.2 56h23v76z'/>
      <g font-size='24px' text-anchor='start'><text dy='0.33em' x='-46' y='-44'><tspan class='Function'>+</tspan><tspan class='Modifier'>Ë</tspan></text></g>
      <text dy='0.33em' x='0' y='-44'><tspan class='Number'>0</tspan></text>
      <text dy='0.33em' x='46' y='-44'><tspan class='Number'>3</tspan></text>
      <text dy='0.33em' x='92' y='-44'><tspan class='Number'>0</tspan></text>
      <text dy='0.33em' x='138' y='-44'><tspan class='Number'>5</tspan></text>
      <g font-size='24px'>
        <text dy='0.33em' x='69' y='20'><tspan class='Function'>+</tspan></text>
        <text dy='0.33em' x='69' y='60'><tspan class='Function'>+</tspan></text>
      </g>
    </g>
    <g transform='translate(308.2,96)'>
      <g stroke-width='0.3' fill='none' stroke='currentColor'>
        <rect x='-11' y='-11' width='160' height='22'/>
        <rect x='-11' y='29' width='160' height='22'/>
        <rect x='-11' y='69' width='160' height='22'/>
      </g>
      <text dy='0.33em' x='0' y='0'><tspan class='Number'>0</tspan></text>
      <text dy='0.33em' x='46' y='0'><tspan class='Number'>0</tspan></text>
      <text dy='0.33em' x='92' y='0'><tspan class='Number'>0</tspan></text>
      <text dy='0.33em' x='138' y='0'><tspan class='Number'>0</tspan></text>
      <text dy='0.33em' x='0' y='40'><tspan class='Number'>0</tspan></text>
      <text dy='0.33em' x='46' y='40'><tspan class='Number'>1</tspan></text>
      <text dy='0.33em' x='92' y='40'><tspan class='Number'>0</tspan></text>
      <text dy='0.33em' x='138' y='40'><tspan class='Number'>5</tspan></text>
      <text dy='0.33em' x='0' y='80'><tspan class='Number'>0</tspan></text>
      <text dy='0.33em' x='46' y='80'><tspan class='Number'>2</tspan></text>
      <text dy='0.33em' x='92' y='80'><tspan class='Number'>0</tspan></text>
      <text dy='0.33em' x='138' y='80'><tspan class='Number'>0</tspan></text>
      <path class='bluegreen' stroke-width='2' stroke-linecap='round' style='fill:none' opacity='0.7' d='M142 99h15v-15M3.5 -19h-22.5v22.5'/>
      <g stroke-width='0.3' fill='none' stroke='currentColor'>
        <rect x='-57' y='-11' width='22' height='22'/>
        <rect x='-57' y='29' width='22' height='22'/>
        <rect x='-57' y='69' width='22' height='22'/>
      </g>
      <g class='green' stroke-width='3' stroke-linecap='round' opacity='0.2' style='fill:none'>
        <path d='M147.2 0l-184 0m15 8l-15 -8l15 -8'/>
        <path d='M147.2 40l-184 0m15 8l-15 -8l15 -8'/>
        <path d='M147.2 80l-184 0m15 8l-15 -8l15 -8'/>
      </g>
      <g font-size='24px' text-anchor='start'><text dy='0.33em' x='-55.2' y='-44'><tspan class='Function'>+</tspan><tspan class='Modifier'>ËË˜</tspan></text></g>
      <text dy='0.33em' x='-46' y='0'><tspan class='Number'>0</tspan></text>
      <text dy='0.33em' x='-46' y='40'><tspan class='Number'>6</tspan></text>
      <text dy='0.33em' x='-46' y='80'><tspan class='Number'>2</tspan></text>
      <text dy='0.33em' x='23' y='0'><tspan class='Function'>+</tspan></text>
      <text dy='0.33em' x='69' y='0'><tspan class='Function'>+</tspan></text>
      <text dy='0.33em' x='115' y='0'><tspan class='Function'>+</tspan></text>
      <text dy='0.33em' x='23' y='40'><tspan class='Function'>+</tspan></text>
      <text dy='0.33em' x='69' y='40'><tspan class='Function'>+</tspan></text>
      <text dy='0.33em' x='115' y='40'><tspan class='Function'>+</tspan></text>
      <text dy='0.33em' x='23' y='80'><tspan class='Function'>+</tspan></text>
      <text dy='0.33em' x='69' y='80'><tspan class='Function'>+</tspan></text>
      <text dy='0.33em' x='115' y='80'><tspan class='Function'>+</tspan></text>
    </g>
  </g>
</svg>

<p>The Cells modifier <code><span class='Modifier'>Ë˜</span></code> applies a function to major cells of its argument, much like <a href="map.html">Each</a> applies to elements. Each result from <code><span class='Function'>ğ”½</span></code> becomes a major cell of the result, which means they must all have the same shape.</p>
<p>The Rank modifier <code><span class='Modifier2'>â‰</span></code> generalizes this concept by allowing numbers provided by <code><span class='Function'>ğ”¾</span></code> to specify a rank for each argument: non-negative to indicate the rank of each array passed to <code><span class='Function'>ğ”½</span></code>, or negative for the number of axes that are mapped over. Cells, which maps over one axis of each argument, is identical to <code><span class='Modifier2'>â‰</span><span class='Number'>Â¯1</span></code>. Rank is analogous to the <a href="depth.html#the-depth-modifier">Depth modifier</a>, but the homogeneous structure of an array eliminates some tricky edge cases found in Depth.</p>
<h2 id="cells"><a class="header" href="#cells">Cells</a></h2>
<p>The function Cells (<code><span class='Modifier'>Ë˜</span></code>) is named after <em>major cells</em> in an array. A <a href="array.html#cells">major cell</a> is a component of an array with dimension one smaller, so that the major cells of a list are <a href="enclose.html#whats-a-unit">units</a>, the major cells of a rank-2 table are its rows (which are lists), and the major cells of a rank-3 array are tables.</p>
<p>The function <code><span class='Function'>ğ”½</span><span class='Modifier'>Ë˜</span></code> applies <code><span class='Function'>ğ”½</span></code> to the major cells of <code><span class='Value'>ğ•©</span></code>. So, for example, where <a href="shift.html">Nudge</a> (<code><span class='Function'>Â»</span></code>) shifts an entire table, Nudge Cells shifts its major cells, or rows.</p>
<a class="replLink" title="Open in the REPL" target="_blank" href="https://mlochbaum.github.io/BQN/try.html#code=YSDihpAgJ2EnICsgM+KAv+KImCDipYog4oaVMjQgICMgQSBjaGFyYWN0ZXIgYXJyYXkKCuKfqCAgYSAgICAgICwgICAgIMK7YSAgICAgLCAgICDCu8uYYSDin6k=">â†—ï¸</a><pre>    <span class='Value'>a</span> <span class='Gets'>â†</span> <span class='String'>'a'</span> <span class='Function'>+</span> <span class='Number'>3</span><span class='Ligature'>â€¿</span><span class='Modifier2'>âˆ˜</span> <span class='Function'>â¥Š</span> <span class='Function'>â†•</span><span class='Number'>24</span>  <span class='Comment'># A character array
</span>
    <span class='Bracket'>âŸ¨</span>  <span class='Value'>a</span>      <span class='Separator'>,</span>     <span class='Function'>Â»</span><span class='Value'>a</span>     <span class='Separator'>,</span>    <span class='Function'>Â»</span><span class='Modifier'>Ë˜</span><span class='Value'>a</span> <span class='Bracket'>âŸ©</span>
â”Œâ”€                                        
Â· â”Œâ”€           â”Œâ”€           â”Œâ”€            
  â•µ"abcdefgh   â•µ"           â•µ" abcdefg    
    ijklmnop     abcdefgh      ijklmno    
    qrstuvwx"    ijklmnop"     qrstuvw"   
             â”˜            â”˜            â”˜  
                                         â”˜
</pre>
<p>What's it mean for Nudge to shift the &quot;entire table&quot;? The block above shows that it shifts downward, but what's really happening is that Nudge treats <code><span class='Value'>ğ•©</span></code> as a collection of major cellsâ€”its rowsâ€”and shifts these. So it adds an entire row and moves the rest of the rows downwards. Nudge Cells appears similar, but it's acting independently on each row, and the values that it moves around are major cells of the row, that is, rank-0 units.</p>
<p>Here's an example showing how Cells can be used to shift each row independently, even though it's not possible to shift columns like this (in fact the best way to do that would be to <a href="transpose.html">transpose</a> in order to work on rows). It uses the not-yet-introduced dyadic form of Cells, so you might want to come back to it after reading the next section.</p>
<a class="replLink" title="Open in the REPL" target="_blank" href="https://mlochbaum.github.io/BQN/try.html#code=YSDihpAgJ2EnICsgM+KAv+KImCDipYog4oaVMjQgICMgQSBjaGFyYWN0ZXIgYXJyYXkKKOKGkSLiiJjiiJgiKSDiipHiirjCu8uYIGE=">â†—ï¸</a><pre>    <span class='Paren'>(</span><span class='Function'>â†‘</span><span class='String'>&quot;âˆ˜âˆ˜&quot;</span><span class='Paren'>)</span> <span class='Function'>âŠ‘</span><span class='Modifier2'>âŠ¸</span><span class='Function'>Â»</span><span class='Modifier'>Ë˜</span> <span class='Value'>a</span>
â”Œâ”€          
â•µ"abcdefgh  
  âˆ˜ijklmno  
  âˆ˜âˆ˜qrstuv" 
           â”˜
</pre>
<p>You can also see how Cells splits its argument into rows using a less array-oriented primitive: <a href="enclose.html">Enclose</a> just wraps each row up so that it appears as a separate element in the final result.</p>
<a class="replLink" title="Open in the REPL" target="_blank" href="https://mlochbaum.github.io/BQN/try.html#code=YSDihpAgJ2EnICsgM+KAv+KImCDipYog4oaVMjQgICMgQSBjaGFyYWN0ZXIgYXJyYXkKPMuYIGE=">â†—ï¸</a><pre>    <span class='Function'>&lt;</span><span class='Modifier'>Ë˜</span> <span class='Value'>a</span>
âŸ¨ "abcdefgh" "ijklmnop" "qrstuvwx" âŸ©
</pre>
<p>Enclose also comes in handy for the following task: join the rows in an array of lists, resulting in an array where each element is a joined row. The obvious guess would be &quot;join cells&quot;, <code><span class='Function'>âˆ¾</span><span class='Modifier'>Ë˜</span></code>, but it doesn't work, because each <code><span class='Function'>âˆ¾</span></code> can return a result with a different length. Cells tries to make each result of <code><span class='Function'>âˆ¾</span></code> into a <em>cell</em>, when the problem was to use it as an <em>element</em>. But a 0-cell is an enclosed element, so we can close the gap by applying <code><span class='Function'>&lt;</span></code> to a joined list: <code><span class='Function'>&lt;</span><span class='Modifier2'>âˆ˜</span><span class='Function'>âˆ¾</span></code>.</p>
<a class="replLink" title="Open in the REPL" target="_blank" href="https://mlochbaum.github.io/BQN/try.html#code=4oqiIHMg4oaQICJ3b3JkcyLigL8iZ28i4oC/ImhlcmUiIOKJjSAic29tZSLigL8ib3RoZXIi4oC/IndvcmRzIgoK4oi+y5ggcwoKPOKImOKIvsuYIHM=">â†—ï¸</a><pre>    <span class='Function'>âŠ¢</span> <span class='Value'>s</span> <span class='Gets'>â†</span> <span class='String'>&quot;words&quot;</span><span class='Ligature'>â€¿</span><span class='String'>&quot;go&quot;</span><span class='Ligature'>â€¿</span><span class='String'>&quot;here&quot;</span> <span class='Function'>â‰</span> <span class='String'>&quot;some&quot;</span><span class='Ligature'>â€¿</span><span class='String'>&quot;other&quot;</span><span class='Ligature'>â€¿</span><span class='String'>&quot;words&quot;</span>
â”Œâ”€                         
â•µ "words" "go"    "here"   
  "some"  "other" "words"  
                          â”˜

    <span class='Function'>âˆ¾</span><span class='Modifier'>Ë˜</span> <span class='Value'>s</span>
<span class='Error'>Error: ğ”½Ë˜: Incompatible result shapes (encountered shapes âŸ¨11âŸ© and âŸ¨14âŸ©)</span>

    <span class='Function'>&lt;</span><span class='Modifier2'>âˆ˜</span><span class='Function'>âˆ¾</span><span class='Modifier'>Ë˜</span> <span class='Value'>s</span>
âŸ¨ "wordsgohere" "someotherwords" âŸ©
</pre>
<p>This approach can apply to more complicated functions as well. And because the result of <code><span class='Function'>&lt;</span></code> always has the same shape, <code><span class='Bracket'>âŸ¨âŸ©</span></code>, the function <code><span class='Function'>&lt;</span><span class='Modifier2'>âˆ˜</span><span class='Function'>ğ”½</span><span class='Modifier'>Ë˜</span></code> can never have a shape agreement error. So if <code><span class='Function'>ğ”½</span><span class='Modifier'>Ë˜</span></code> fails, it can't hurt to check <code><span class='Function'>&lt;</span><span class='Modifier2'>âˆ˜</span><span class='Function'>ğ”½</span><span class='Modifier'>Ë˜</span></code> and see what results <code><span class='Function'>ğ”½</span></code> is returning.</p>
<h3 id="two-arguments"><a class="header" href="#two-arguments">Two arguments</a></h3>
<p>When given two arguments, Cells tries to pair their cells together. Starting simple, a unit (whether array or atom) on either side will be paired with every cell of the other argument.</p>
<a class="replLink" title="Open in the REPL" target="_blank" href="https://mlochbaum.github.io/BQN/try.html#code=YSDihpAgJ2EnICsgM+KAv+KImCDipYog4oaVMjQgICMgQSBjaGFyYWN0ZXIgYXJyYXkKJ+KImCcgwrvLmCBh">â†—ï¸</a><pre>    <span class='String'>'âˆ˜'</span> <span class='Function'>Â»</span><span class='Modifier'>Ë˜</span> <span class='Value'>a</span>
â”Œâ”€          
â•µ"âˆ˜abcdefg  
  âˆ˜ijklmno  
  âˆ˜qrstuvw" 
           â”˜
</pre>
<p>If you <em>want</em> to use this one-to-many behavior with an array, it'll take more work: since you're really only mapping over one argument, <a href="hook.html">bind</a> the other inside Cells.</p>
<a class="replLink" title="Open in the REPL" target="_blank" href="https://mlochbaum.github.io/BQN/try.html#code=YSDihpAgJ2EnICsgM+KAv+KImCDipYog4oaVMjQgICMgQSBjaGFyYWN0ZXIgYXJyYXkKIuKImOKImCIgwrvLmCBhCgoi4oiY4oiYIuKKuMK7y5ggYQ==">â†—ï¸</a><pre>    <span class='String'>&quot;âˆ˜âˆ˜&quot;</span> <span class='Function'>Â»</span><span class='Modifier'>Ë˜</span> <span class='Value'>a</span>
<span class='Error'>Error: ğ•¨Ë˜ğ•©: Argument frames don't agree (âŸ¨2âŸ© â‰¡ â‰¢ğ•¨, 3â€¿8 â‰¡ â‰¢ğ•©, common frame of 1 axes)</span>

    <span class='String'>&quot;âˆ˜âˆ˜&quot;</span><span class='Modifier2'>âŠ¸</span><span class='Function'>Â»</span><span class='Modifier'>Ë˜</span> <span class='Value'>a</span>
â”Œâ”€          
â•µ"âˆ˜âˆ˜abcdef  
  âˆ˜âˆ˜ijklmn  
  âˆ˜âˆ˜qrstuv" 
           â”˜
</pre>
<p>This is because the general case of Cells does one-to-one matching, pairing the first axis of one argument with the other. For this to work, the two arguments need to have the same length.</p>
<a class="replLink" title="Open in the REPL" target="_blank" href="https://mlochbaum.github.io/BQN/try.html#code=YSDihpAgJ2EnICsgM+KAv+KImCDipYog4oaVMjQgICMgQSBjaGFyYWN0ZXIgYXJyYXkK4p+oICIwMTIiIMK7y5ggYSwgICgz4oC/4oiY4qWKIlVWV1hZWiIpIMK7y5ggYSDin6k=">â†—ï¸</a><pre>    <span class='Bracket'>âŸ¨</span> <span class='String'>&quot;012&quot;</span> <span class='Function'>Â»</span><span class='Modifier'>Ë˜</span> <span class='Value'>a</span><span class='Separator'>,</span>  <span class='Paren'>(</span><span class='Number'>3</span><span class='Ligature'>â€¿</span><span class='Modifier2'>âˆ˜</span><span class='Function'>â¥Š</span><span class='String'>&quot;UVWXYZ&quot;</span><span class='Paren'>)</span> <span class='Function'>Â»</span><span class='Modifier'>Ë˜</span> <span class='Value'>a</span> <span class='Bracket'>âŸ©</span>
â”Œâ”€                           
Â· â”Œâ”€           â”Œâ”€            
  â•µ"0abcdefg   â•µ"UVabcdef    
    1ijklmno     WXijklmn    
    2qrstuvw"    YZqrstuv"   
             â”˜            â”˜  
                            â”˜
</pre>
<p>The arguments might have different ranks: for example, <code><span class='String'>&quot;012&quot;</span></code> has rank 1 and <code><span class='Value'>a</span></code> has rank 2 above. That's fine: it just means Cells will pass arguments of rank 0 and 1 to its operand. You can see these arguments using <a href="pair.html">Pair</a> Cells, <code><span class='Function'>â‹ˆ</span><span class='Modifier'>Ë˜</span></code>, so that each cell of the result is just a list of the two arguments used for that call.</p>
<a class="replLink" title="Open in the REPL" target="_blank" href="https://mlochbaum.github.io/BQN/try.html#code=YSDihpAgJ2EnICsgM+KAv+KImCDipYog4oaVMjQgICMgQSBjaGFyYWN0ZXIgYXJyYXkKIjAxMiIg4ouIy5ggYQ==">â†—ï¸</a><pre>    <span class='String'>&quot;012&quot;</span> <span class='Function'>â‹ˆ</span><span class='Modifier'>Ë˜</span> <span class='Value'>a</span>
â”Œâ”€                  
â•µ â”ŒÂ·    "abcdefgh"  
  Â·'0'              
      â”˜             
  â”ŒÂ·    "ijklmnop"  
  Â·'1'              
      â”˜             
  â”ŒÂ·    "qrstuvwx"  
  Â·'2'              
      â”˜             
                   â”˜
</pre>
<h2 id="rank"><a class="header" href="#rank">Rank</a></h2>
<p>Rank (<code><span class='Modifier2'>â‰</span></code>) is a generalization of Cells (<code><span class='Function'>ğ”½</span><span class='Modifier'>Ë˜</span></code> is defined to be <code><span class='Function'>ğ”½</span><span class='Modifier2'>â‰</span><span class='Number'>Â¯1</span></code>) that can apply to arbitraryâ€”not just majorâ€”<a href="array.html#cells">cells</a> and combine different levels of mapping for two arguments.</p>
<p>Rank comes in handy when there are high-rank arrays with lots of exciting axes, which is a great use case for BQN but honestly isn't all that common. And to continue this trend of honesty, using Rank just never <em>feels</em> goodâ€”it's some heavy machinery that I drag out when nothing else works, only to make use of a small part of the functionality. If Cells covers your use cases, that's probably for the best!</p>
<h3 id="negative-and-positive-ranks"><a class="header" href="#negative-and-positive-ranks">Negative and positive ranks</a></h3>
<p>I've said that <code><span class='Function'>ğ”½</span><span class='Modifier2'>â‰</span><span class='Number'>Â¯1</span></code> is <code><span class='Function'>ğ”½</span><span class='Modifier'>Ë˜</span></code>. And it's also the case that <code><span class='Function'>ğ”½</span><span class='Modifier2'>â‰</span><span class='Number'>Â¯2</span></code> is <code><span class='Function'>ğ”½</span><span class='Modifier'>Ë˜Ë˜</span></code>. And <code><span class='Function'>ğ”½</span><span class='Modifier2'>â‰</span><span class='Number'>Â¯3</span></code> is <code><span class='Function'>ğ”½</span><span class='Modifier'>Ë˜Ë˜Ë˜</span></code>. And so on.</p>
<a class="replLink" title="Open in the REPL" target="_blank" href="https://mlochbaum.github.io/BQN/try.html#code=KOKGlTQpICjii4jLmMuYy5gg4omhIOKLiOKOicKvMykg4oaVNOKAvzLigL8y4oC/NQ==">â†—ï¸</a><pre>    <span class='Paren'>(</span><span class='Function'>â†•</span><span class='Number'>4</span><span class='Paren'>)</span> <span class='Paren'>(</span><span class='Function'>â‹ˆ</span><span class='Modifier'>Ë˜Ë˜Ë˜</span> <span class='Function'>â‰¡</span> <span class='Function'>â‹ˆ</span><span class='Modifier2'>â‰</span><span class='Number'>Â¯3</span><span class='Paren'>)</span> <span class='Function'>â†•</span><span class='Number'>4</span><span class='Ligature'>â€¿</span><span class='Number'>2</span><span class='Ligature'>â€¿</span><span class='Number'>2</span><span class='Ligature'>â€¿</span><span class='Number'>5</span>
1
</pre>
<p>So <code><span class='Function'>ğ”½</span><span class='Modifier2'>â‰</span><span class='Paren'>(</span><span class='Function'>-</span><span class='Value'>k</span><span class='Paren'>)</span></code>, at least for <code><span class='Value'>k</span><span class='Function'>â‰¥</span><span class='Number'>1</span></code>, is how you map over the first <code><span class='Value'>k</span></code> axes of an array or two. We'll get more into why this is in the next section. What about some positivity for a change?</p>
<a class="replLink" title="Open in the REPL" target="_blank" href="https://mlochbaum.github.io/BQN/try.html#code=POKOiTAgImFiYyLiiY0iZGVmIgoKPOKOiTEgImFiYyLiiY0iZGVmIg==">â†—ï¸</a><pre>    <span class='Function'>&lt;</span><span class='Modifier2'>â‰</span><span class='Number'>0</span> <span class='String'>&quot;abc&quot;</span><span class='Function'>â‰</span><span class='String'>&quot;def&quot;</span>
â”Œâ”€                   
â•µ â”ŒÂ·    â”ŒÂ·    â”ŒÂ·     
  Â·'a'  Â·'b'  Â·'c'   
      â”˜     â”˜     â”˜  
  â”ŒÂ·    â”ŒÂ·    â”ŒÂ·     
  Â·'d'  Â·'e'  Â·'f'   
      â”˜     â”˜     â”˜  
                    â”˜

    <span class='Function'>&lt;</span><span class='Modifier2'>â‰</span><span class='Number'>1</span> <span class='String'>&quot;abc&quot;</span><span class='Function'>â‰</span><span class='String'>&quot;def&quot;</span>
âŸ¨ "abc" "def" âŸ©
</pre>
<p>The function <code><span class='Function'>ğ”½</span><span class='Modifier2'>â‰</span><span class='Value'>k</span></code>, for <code><span class='Value'>k</span><span class='Function'>â‰¥</span><span class='Number'>0</span></code>, operates on the <code><span class='Value'>k</span></code>-cells of its argumentsâ€”that is, it maps over all <em>but</em> the last <code><span class='Value'>k</span></code> axes. For any given argument <code><span class='Value'>a</span></code>, ranks <code><span class='Value'>k</span></code> and <code><span class='Value'>k</span><span class='Function'>-=</span><span class='Value'>a</span></code> are the same, as long as <code><span class='Value'>k</span><span class='Function'>â‰¥</span><span class='Number'>0</span></code> and <code><span class='Paren'>(</span><span class='Value'>k</span><span class='Function'>-=</span><span class='Value'>a</span><span class='Paren'>)</span><span class='Function'>â‰¤</span><span class='Number'>Â¯1</span></code>. So rank 2 is rank Â¯3 for a rank-5 array. The reason this option is useful is that the same rank might be applied to multiple arguments, either with multiple function calls or one call on two arguments. Let's revisit an example with Cells from before, shifting the same string into each row of a table. The function <code><span class='Function'>Â»</span></code> should be called on rank-1 strings, but because the argument ranks are different, a negative rank can't get down to rank 1 on both sides. Positive rank 1 does the job, allowing us to unbundle the string <code><span class='String'>&quot;âˆ˜âˆ˜&quot;</span></code> so that <code><span class='Function'>Â»</span><span class='Modifier2'>â‰</span><span class='Number'>1</span></code> is a standalone function.</p>
<a class="replLink" title="Open in the REPL" target="_blank" href="https://mlochbaum.github.io/BQN/try.html#code=YSDihpAgJ2EnICsgM+KAv+KImCDipYog4oaVMjQgICMgQSBjaGFyYWN0ZXIgYXJyYXkKIuKImOKImCLiirjCu8uYIGEKCiLiiJjiiJgiIMK74o6JMSBh">â†—ï¸</a><pre>    <span class='String'>&quot;âˆ˜âˆ˜&quot;</span><span class='Modifier2'>âŠ¸</span><span class='Function'>Â»</span><span class='Modifier'>Ë˜</span> <span class='Value'>a</span>
â”Œâ”€          
â•µ"âˆ˜âˆ˜abcdef  
  âˆ˜âˆ˜ijklmn  
  âˆ˜âˆ˜qrstuv" 
           â”˜

    <span class='String'>&quot;âˆ˜âˆ˜&quot;</span> <span class='Function'>Â»</span><span class='Modifier2'>â‰</span><span class='Number'>1</span> <span class='Value'>a</span>
â”Œâ”€          
â•µ"âˆ˜âˆ˜abcdef  
  âˆ˜âˆ˜ijklmn  
  âˆ˜âˆ˜qrstuv" 
           â”˜
</pre>
<p>The rank for a given argument is clamped, so that on a rank 3 argument for example, a rank of Â¯5 counts as Â¯3 and a rank of 6 counts as 3 (same for any other value less than Â¯3 or greater than 3, although it does have to be a whole number). You may have noticed there's <a href="../commentary/problems.html#rankdepth-negative-zero">no</a> option for Â¯0, &quot;don't map over anything&quot;, but âˆ serves that purpose, as it indicates the highest possible rank and thus the entire array. More on why that's useful later.</p>
<h3 id="frame-and-cells"><a class="header" href="#frame-and-cells">Frame and Cells</a></h3>
<p>Lets look at things more systematically. Suppose <code><span class='Value'>x</span></code> has shape <code><span class='Number'>4</span><span class='Ligature'>â€¿</span><span class='Number'>3</span><span class='Ligature'>â€¿</span><span class='Number'>2</span><span class='Ligature'>â€¿</span><span class='Number'>1</span><span class='Ligature'>â€¿</span><span class='Number'>0</span></code>, and we'd like to approach it with <code><span class='Modifier2'>â‰</span><span class='Number'>2</span></code>, or equivalently <code><span class='Modifier2'>â‰</span><span class='Number'>Â¯3</span></code>. This choice splits the axes of <code><span class='Value'>x</span></code> into two parts: leading axes (shapes <code><span class='Number'>4</span><span class='Ligature'>â€¿</span><span class='Number'>3</span><span class='Ligature'>â€¿</span><span class='Number'>2</span></code>) make up the <em>frame</em> of <code><span class='Value'>x</span></code>, while trailing axes give the shape <code><span class='Number'>1</span><span class='Ligature'>â€¿</span><span class='Number'>0</span></code> of each <em>cell</em> of <code><span class='Value'>x</span></code>.</p>
<a class="replLink" title="Open in the REPL" target="_blank" href="https://mlochbaum.github.io/BQN/try.html#code=4omiICAgPOKOiTIg4oaVNOKAvzPigL8y4oC/MeKAvzAKCuKJoiDiipEgPOKOiTIg4oaVNOKAvzPigL8y4oC/MeKAvzA=">â†—ï¸</a><pre>    <span class='Function'>â‰¢</span>   <span class='Function'>&lt;</span><span class='Modifier2'>â‰</span><span class='Number'>2</span> <span class='Function'>â†•</span><span class='Number'>4</span><span class='Ligature'>â€¿</span><span class='Number'>3</span><span class='Ligature'>â€¿</span><span class='Number'>2</span><span class='Ligature'>â€¿</span><span class='Number'>1</span><span class='Ligature'>â€¿</span><span class='Number'>0</span>
âŸ¨ 4 3 2 âŸ©

    <span class='Function'>â‰¢</span> <span class='Function'>âŠ‘</span> <span class='Function'>&lt;</span><span class='Modifier2'>â‰</span><span class='Number'>2</span> <span class='Function'>â†•</span><span class='Number'>4</span><span class='Ligature'>â€¿</span><span class='Number'>3</span><span class='Ligature'>â€¿</span><span class='Number'>2</span><span class='Ligature'>â€¿</span><span class='Number'>1</span><span class='Ligature'>â€¿</span><span class='Number'>0</span>
âŸ¨ 1 0 âŸ©
</pre>
<p>We can build a frame array using <code><span class='Function'>&lt;</span><span class='Modifier2'>â‰</span><span class='Number'>2</span></code>, as shown above. In the general case <code><span class='Function'>F</span><span class='Modifier2'>â‰</span><span class='Number'>2</span> <span class='Value'>x</span></code>, the frame remains conceptual: the actual array <code><span class='Function'>&lt;</span><span class='Modifier2'>â‰</span><span class='Number'>2</span> <span class='Value'>x</span></code> is never exposed, and the final result might not have exactly shape <code><span class='Number'>4</span><span class='Ligature'>â€¿</span><span class='Number'>3</span><span class='Ligature'>â€¿</span><span class='Number'>2</span></code>. But its shape does always start with <code><span class='Number'>4</span><span class='Ligature'>â€¿</span><span class='Number'>3</span><span class='Ligature'>â€¿</span><span class='Number'>2</span></code>, because Rank maps over the frame axes, leaving them intact. In terms of our cell-splitting function <code><span class='Function'>&lt;</span><span class='Modifier2'>â‰</span><span class='Value'>k</span></code>, and its inverse <a href="couple.html">Merge</a> (<code><span class='Function'>&gt;</span></code>), we have:</p>
<pre><span class='Function'>F</span><span class='Modifier2'>â‰</span><span class='Value'>k</span> <span class='Value'>x</span>  <span class='Gets'>â†â†’</span>  <span class='Function'>&gt;F</span><span class='Modifier'>Â¨</span><span class='Function'>&lt;</span><span class='Modifier2'>â‰</span><span class='Value'>k</span> <span class='Value'>x</span>
</pre>
<p>That is, <code><span class='Function'>F</span><span class='Modifier2'>â‰</span><span class='Value'>k</span></code> splits its argument into <code><span class='Value'>k</span></code>-cells, applies <code><span class='Function'>F</span></code> to each of these (in index order, of course), then merges the results into a single array.</p>
<a class="replLink" title="Open in the REPL" target="_blank" href="https://mlochbaum.github.io/BQN/try.html#code=K8ud4o6JMSA04oC/MuKliuKGlTgKCivLncKoPOKOiTEgNOKAvzLipYrihpU4ICAjICvLnSBvZiBhIGxpc3QgaXMgYSB1bml0Cgo+K8udwqg84o6JMSA04oC/MuKliuKGlTg=">â†—ï¸</a><pre>    <span class='Function'>+</span><span class='Modifier'>Ë</span><span class='Modifier2'>â‰</span><span class='Number'>1</span> <span class='Number'>4</span><span class='Ligature'>â€¿</span><span class='Number'>2</span><span class='Function'>â¥Šâ†•</span><span class='Number'>8</span>
âŸ¨ 1 5 9 13 âŸ©

    <span class='Function'>+</span><span class='Modifier'>ËÂ¨</span><span class='Function'>&lt;</span><span class='Modifier2'>â‰</span><span class='Number'>1</span> <span class='Number'>4</span><span class='Ligature'>â€¿</span><span class='Number'>2</span><span class='Function'>â¥Šâ†•</span><span class='Number'>8</span>  <span class='Comment'># +Ë of a list is a unit
</span>â”Œâ”€                          
Â· â”ŒÂ·    â”ŒÂ·    â”ŒÂ·    â”ŒÂ·      
  Â· 1   Â· 5   Â· 9   Â· 13    
      â”˜     â”˜     â”˜      â”˜  
                           â”˜

    <span class='Function'>&gt;+</span><span class='Modifier'>ËÂ¨</span><span class='Function'>&lt;</span><span class='Modifier2'>â‰</span><span class='Number'>1</span> <span class='Number'>4</span><span class='Ligature'>â€¿</span><span class='Number'>2</span><span class='Function'>â¥Šâ†•</span><span class='Number'>8</span>
âŸ¨ 1 5 9 13 âŸ©
</pre>
<p>Each can be implemented by acting on 0-cells with Rank too: <code><span class='Function'>F</span><span class='Modifier2'>âŒ¾</span><span class='Function'>âŠ‘</span><span class='Modifier2'>â‰</span><span class='Number'>0</span> <span class='Value'>x</span> <span class='Gets'>â†â†’</span> <span class='Function'>F</span><span class='Modifier'>Â¨</span><span class='Value'>x</span></code>, meaning that <code><span class='Function'>F</span><span class='Modifier'>Â¨</span></code> applies <code><span class='Function'>F</span></code> to the interior of each 0-cell, that is, each element. Some half-way identities are <code><span class='Function'>&lt;</span><span class='Modifier2'>âˆ˜</span><span class='Function'>F</span><span class='Modifier2'>â‰</span><span class='Value'>k</span>  <span class='Gets'>â†â†’</span> <span class='Function'>F</span><span class='Modifier'>Â¨</span><span class='Function'>&lt;</span><span class='Modifier2'>â‰</span><span class='Value'>k</span></code> and <code><span class='Function'>F</span><span class='Modifier2'>âˆ˜</span><span class='Function'>âŠ‘</span><span class='Modifier2'>â‰</span><span class='Number'>0</span> <span class='Gets'>â†â†’</span> <span class='Function'>&gt;F</span><span class='Modifier'>Â¨</span></code>.</p>
<h3 id="multiple-and-computed-ranks"><a class="header" href="#multiple-and-computed-ranks">Multiple and computed ranks</a></h3>
<p>The Rank modifier also accepts a list of one to three numbers for <code><span class='Value'>ğ•˜</span></code>, as well as a function <code><span class='Function'>ğ”¾</span></code> returning such a list. Practically speaking, here's what you need to know:</p>
<ul>
<li>A single number or one-element list indicates the ranks for all arguments.</li>
<li>Two numbers indicate the ranks for <code><span class='Value'>ğ•¨</span></code> and <code><span class='Value'>ğ•©</span></code>.</li>
</ul>
<p>As an example, we'll define the matrix-vector product. A matrix is a rank-2 array and a vector is a list, and their product is a list. It's made up of the elements <code><span class='Function'>+</span><span class='Modifier'>Â´</span> <span class='Value'>row</span> <span class='Function'>Ã—</span> <span class='Value'>vec</span></code> for each row <code><span class='Value'>row</span></code> of the matrix. To define this using Rank, we'll change <code><span class='Function'>+</span><span class='Modifier'>Â´</span></code> to <code><span class='Function'>+</span><span class='Modifier'>Ë</span></code> to get a unit out, and we need to map over the rows of the left argument but not of the right one. Following the rules above, there are several ways to do this, including <code><span class='Function'>+</span><span class='Modifier'>Ë</span><span class='Modifier2'>âˆ˜</span><span class='Function'>Ã—</span><span class='Modifier2'>â‰</span><span class='Number'>1</span></code>, <code><span class='Function'>+</span><span class='Modifier'>Ë</span><span class='Modifier2'>âˆ˜</span><span class='Function'>Ã—</span><span class='Modifier2'>â‰</span><span class='Number'>Â¯1</span><span class='Ligature'>â€¿</span><span class='Number'>1</span></code>, and <code><span class='Function'>+</span><span class='Modifier'>Ë</span><span class='Modifier2'>âˆ˜</span><span class='Function'>Ã—</span><span class='Modifier2'>â‰</span><span class='Number'>Â¯1</span><span class='Ligature'>â€¿</span><span class='Number'>âˆ</span></code>. Note that <code><span class='Modifier2'>â‰</span><span class='Number'>Â¯1</span></code> wouldn't work, because the Â¯1 is interpreted separately for both argumentsâ€”it's equivalent to 1 for the matrix but 0 for the vector, or <code><span class='Modifier2'>â‰</span><span class='Number'>1</span><span class='Ligature'>â€¿</span><span class='Number'>0</span></code> overall. When correctly defined we can see that multiplication by the matrix <code><span class='Value'>m</span></code> below negates the first element of a list, and also swaps it with the second.</p>
<a class="replLink" title="Open in the REPL" target="_blank" href="https://mlochbaum.github.io/BQN/try.html#code=4oqiIG0g4oaQIFsw4oC/MeKAvzAsIMKvMeKAvzDigL8wLCAw4oC/MOKAvzFdCgory50gMOKAvzHigL8wIMOXIDHigL8y4oC/MwoKbSAry53iiJjDl+KOiTHigL/iiJ4gMeKAvzLigL8z">â†—ï¸</a><pre>    <span class='Function'>âŠ¢</span> <span class='Value'>m</span> <span class='Gets'>â†</span> <span class='Bracket'>[</span><span class='Number'>0</span><span class='Ligature'>â€¿</span><span class='Number'>1</span><span class='Ligature'>â€¿</span><span class='Number'>0</span><span class='Separator'>,</span> <span class='Number'>Â¯1</span><span class='Ligature'>â€¿</span><span class='Number'>0</span><span class='Ligature'>â€¿</span><span class='Number'>0</span><span class='Separator'>,</span> <span class='Number'>0</span><span class='Ligature'>â€¿</span><span class='Number'>0</span><span class='Ligature'>â€¿</span><span class='Number'>1</span><span class='Bracket'>]</span>
â”Œâ”€        
â•µ  0 1 0  
  Â¯1 0 0  
   0 0 1  
         â”˜

    <span class='Function'>+</span><span class='Modifier'>Ë</span> <span class='Number'>0</span><span class='Ligature'>â€¿</span><span class='Number'>1</span><span class='Ligature'>â€¿</span><span class='Number'>0</span> <span class='Function'>Ã—</span> <span class='Number'>1</span><span class='Ligature'>â€¿</span><span class='Number'>2</span><span class='Ligature'>â€¿</span><span class='Number'>3</span>
â”ŒÂ·   
Â· 2  
    â”˜

    <span class='Value'>m</span> <span class='Function'>+</span><span class='Modifier'>Ë</span><span class='Modifier2'>âˆ˜</span><span class='Function'>Ã—</span><span class='Modifier2'>â‰</span><span class='Number'>1</span><span class='Ligature'>â€¿</span><span class='Number'>âˆ</span> <span class='Number'>1</span><span class='Ligature'>â€¿</span><span class='Number'>2</span><span class='Ligature'>â€¿</span><span class='Number'>3</span>
âŸ¨ 2 Â¯1 3 âŸ©
</pre>
<p>But a rank of <code><span class='Number'>1</span><span class='Ligature'>â€¿</span><span class='Number'>âˆ</span></code> works the best because it also defines a matrix-<em>matrix</em> product. Which as shown below does the same transformation to the <em>cells</em> of the right-hand-side matrix, instead of the elements of a vector. This works because <code><span class='Function'>Ã—</span></code> and <code><span class='Function'>+</span><span class='Modifier'>Ë</span></code> work on the leading axes of their arguments. When <code><span class='Modifier2'>â‰</span><span class='Number'>1</span><span class='Ligature'>â€¿</span><span class='Number'>âˆ</span></code> is applied, these axes are the last axis of <code><span class='Value'>ğ•¨</span></code> and the first axis of <code><span class='Value'>ğ•©</span></code>. Whichâ€¦ is kind of weird, but it's what a matrix product is.</p>
<a class="replLink" title="Open in the REPL" target="_blank" href="https://mlochbaum.github.io/BQN/try.html#code=4oqiIG0g4oaQIFsw4oC/MeKAvzAsIMKvMeKAvzDigL8wLCAw4oC/MOKAvzFdCivLnSAw4oC/MeKAvzAgw5cgMeKAvzLigL8zw5fijJwx4oC/MTAKCm0gK8ud4oiYw5fijokx4oC/4oieIDHigL8y4oC/M8OX4oycMeKAvzEw">â†—ï¸</a><pre>    <span class='Function'>+</span><span class='Modifier'>Ë</span> <span class='Number'>0</span><span class='Ligature'>â€¿</span><span class='Number'>1</span><span class='Ligature'>â€¿</span><span class='Number'>0</span> <span class='Function'>Ã—</span> <span class='Number'>1</span><span class='Ligature'>â€¿</span><span class='Number'>2</span><span class='Ligature'>â€¿</span><span class='Number'>3</span><span class='Function'>Ã—</span><span class='Modifier'>âŒœ</span><span class='Number'>1</span><span class='Ligature'>â€¿</span><span class='Number'>10</span>
âŸ¨ 2 20 âŸ©

    <span class='Value'>m</span> <span class='Function'>+</span><span class='Modifier'>Ë</span><span class='Modifier2'>âˆ˜</span><span class='Function'>Ã—</span><span class='Modifier2'>â‰</span><span class='Number'>1</span><span class='Ligature'>â€¿</span><span class='Number'>âˆ</span> <span class='Number'>1</span><span class='Ligature'>â€¿</span><span class='Number'>2</span><span class='Ligature'>â€¿</span><span class='Number'>3</span><span class='Function'>Ã—</span><span class='Modifier'>âŒœ</span><span class='Number'>1</span><span class='Ligature'>â€¿</span><span class='Number'>10</span>
â”Œâ”€        
â•µ  2  20  
  Â¯1 Â¯10  
   3  30  
         â”˜
</pre>
<p>For completeness, here's the whole, boring description of how <code><span class='Function'>ğ”¾</span></code> is handled. The operand <code><span class='Function'>ğ”¾</span></code> is called on the arguments <code><span class='Value'>ğ•¨</span><span class='Function'>ğ”¾</span><span class='Value'>ğ•©</span></code> before doing anything else (if it's not a function, this just returns <code><span class='Value'>ğ•˜</span></code>). Then it's converted to a list. It's required to have rank 0 or 1, but numbers and enclosed numbers are fine. This list can have one to three elements; three elements is the general case, as the elements give the ranks for monadic <code><span class='Value'>ğ•©</span></code>, dyadic <code><span class='Value'>ğ•¨</span></code>, and dyadic <code><span class='Value'>ğ•©</span></code> in order. If there are less than three elements, the list <code><span class='Value'>r</span></code> is expanded backwards-cyclically to <code><span class='Number'>3</span><span class='Modifier2'>âŠ¸</span><span class='Function'>â¥Š</span><span class='Modifier2'>âŒ¾</span><span class='Function'>âŒ½</span><span class='Value'>r</span></code>, turning <code><span class='Bracket'>âŸ¨</span><span class='Value'>a</span><span class='Bracket'>âŸ©</span></code> into <code><span class='Value'>a</span><span class='Ligature'>â€¿</span><span class='Value'>a</span><span class='Ligature'>â€¿</span><span class='Value'>a</span></code> and <code><span class='Value'>a</span><span class='Ligature'>â€¿</span><span class='Value'>b</span></code> into <code><span class='Value'>b</span><span class='Ligature'>â€¿</span><span class='Value'>a</span><span class='Ligature'>â€¿</span><span class='Value'>b</span></code>. So <code><span class='Number'>3</span><span class='Modifier2'>âŠ¸</span><span class='Function'>â¥Š</span><span class='Modifier2'>âŒ¾</span><span class='Function'>âŒ½â¥Š</span><span class='Value'>ğ•¨</span><span class='Function'>ğ”¾</span><span class='Value'>ğ•©</span></code> is the final formula.</p>
<h3 id="leading-axis-agreement"><a class="header" href="#leading-axis-agreement">Leading axis agreement</a></h3>
<p>In the preceding sections we've been somewhat loose with the way two arguments are paired up. The simple answer is <a href="leading.html#leading-axis-agreement">leading axis agreement</a> on the frames.</p>
<p>This is why the rank of <code><span class='Modifier2'>â‰</span><span class='Number'>1</span><span class='Ligature'>â€¿</span><span class='Number'>âˆ</span></code> that leads to a frame <code><span class='Bracket'>âŸ¨</span><span class='Number'>3</span><span class='Bracket'>âŸ©</span></code> on the left and <code><span class='Bracket'>âŸ¨âŸ©</span></code> on the right is fine: more generally, either argument can have a longer frame as long as the elements in the shorter one agree with it. So frames of <code><span class='Bracket'>âŸ¨</span><span class='Number'>3</span><span class='Separator'>,</span><span class='Number'>2</span><span class='Bracket'>âŸ©</span></code> and <code><span class='Bracket'>âŸ¨</span><span class='Number'>3</span><span class='Bracket'>âŸ©</span></code> would also be fine, but <code><span class='Bracket'>âŸ¨</span><span class='Number'>2</span><span class='Separator'>,</span><span class='Number'>3</span><span class='Bracket'>âŸ©</span></code> and <code><span class='Bracket'>âŸ¨</span><span class='Number'>3</span><span class='Bracket'>âŸ©</span></code> wouldn't: the first axes of these frames need to have the same length.</p>
<a class="replLink" title="Open in the REPL" target="_blank" href="https://mlochbaum.github.io/BQN/try.html#code=4omiICjihpUz4oC/MuKAvzUpIOKIvuKOiTEgKOKGlTPigL80KQoK4omiICjihpUy4oC/M+KAvzUpIOKIvuKOiTEgKOKGlTPigL80KQ==">â†—ï¸</a><pre>    <span class='Function'>â‰¢</span> <span class='Paren'>(</span><span class='Function'>â†•</span><span class='Number'>3</span><span class='Ligature'>â€¿</span><span class='Number'>2</span><span class='Ligature'>â€¿</span><span class='Number'>5</span><span class='Paren'>)</span> <span class='Function'>âˆ¾</span><span class='Modifier2'>â‰</span><span class='Number'>1</span> <span class='Paren'>(</span><span class='Function'>â†•</span><span class='Number'>3</span><span class='Ligature'>â€¿</span><span class='Number'>4</span><span class='Paren'>)</span>
âŸ¨ 3 2 9 âŸ©

    <span class='Function'>â‰¢</span> <span class='Paren'>(</span><span class='Function'>â†•</span><span class='Number'>2</span><span class='Ligature'>â€¿</span><span class='Number'>3</span><span class='Ligature'>â€¿</span><span class='Number'>5</span><span class='Paren'>)</span> <span class='Function'>âˆ¾</span><span class='Modifier2'>â‰</span><span class='Number'>1</span> <span class='Paren'>(</span><span class='Function'>â†•</span><span class='Number'>3</span><span class='Ligature'>â€¿</span><span class='Number'>4</span><span class='Paren'>)</span>
<span class='Error'>Error: ğ•¨â‰ğ•©: Argument frames don't agree (2â€¿3â€¿5 â‰¡ â‰¢ğ•¨, 3â€¿4 â‰¡ â‰¢ğ•©, common frame of 1 axes)</span>
</pre>
<p>On the other hand, Rank doesn't care about the argument cell shapesâ€”it leaves that up to the function <code><span class='Function'>ğ”½</span></code>. If <code><span class='Function'>ğ”½</span></code> is an arithmetic function, you'll get <em>two</em> layers of prefix agreement: one outer matching with <code><span class='Modifier2'>â‰</span></code>, and an inner one with <code><span class='Function'>ğ”½</span></code>.</p>
<p>It's also possible to apply multiple copies of Rank, which in general is powerful enough to match and not-match axes in any combination as long as the axes for each argument stay in order (of course, BQN also provides the tools to <a href="transpose.html#reorder-axes">reorder axes</a>).</p>
<p>One of the relatively more common instance of this pattern is a variation on the <a href="map.html#table">Table</a> modifier, to work with cells instead of elements. Here we'll make a table of all combinations of one row (1-cell) from <code><span class='Value'>ğ•¨</span></code> and one from <code><span class='Value'>ğ•©</span></code>. To do this, we want to first line up each row of <code><span class='Value'>ğ•¨</span></code> with the whole of <code><span class='Value'>ğ•©</span></code>. As in a matrix product, that's <code><span class='Modifier2'>â‰</span><span class='Number'>1</span><span class='Ligature'>â€¿</span><span class='Number'>âˆ</span></code>. But then we'd like to pair that row with the rows of <code><span class='Value'>ğ•©</span></code> individually, which could be written <code><span class='Modifier2'>â‰</span><span class='Number'>âˆ</span><span class='Ligature'>â€¿</span><span class='Number'>1</span></code>. But since we know the left argument has been reduced to lists, <code><span class='Modifier2'>â‰</span><span class='Number'>1</span></code> also works. We then arrange the two layers of mapping with <code><span class='Modifier2'>â‰</span><span class='Number'>1</span></code> on the inside, giving <code><span class='Paren'>(</span><span class='Function'>âˆ¾</span><span class='Modifier2'>â‰</span><span class='Number'>1</span><span class='Paren'>)</span><span class='Modifier2'>â‰</span><span class='Number'>1</span><span class='Ligature'>â€¿</span><span class='Number'>âˆ</span></code>.</p>
<a class="replLink" title="Open in the REPL" target="_blank" href="https://mlochbaum.github.io/BQN/try.html#code=KCJhYmMi4omNImRlZiIpIOKIvuKOiTHijokx4oC/4oieID4iUVIi4oC/IlNUIuKAvyJVViIKCuKJoiAoImFiYyLiiY0iZGVmIikg4oi+4o6JMeKOiTHigL/iiJ4gPiJRUiLigL8iU1Qi4oC/IlVWIgoK4omiICjihpUz4oC/NOKAvzUpIOKIvuKOiTHijokx4oC/4oieIOKGlTDigL8x4oC/MuKAvzg=">â†—ï¸</a><pre>    <span class='Paren'>(</span><span class='String'>&quot;abc&quot;</span><span class='Function'>â‰</span><span class='String'>&quot;def&quot;</span><span class='Paren'>)</span> <span class='Function'>âˆ¾</span><span class='Modifier2'>â‰</span><span class='Number'>1</span><span class='Modifier2'>â‰</span><span class='Number'>1</span><span class='Ligature'>â€¿</span><span class='Number'>âˆ</span> <span class='Function'>&gt;</span><span class='String'>&quot;QR&quot;</span><span class='Ligature'>â€¿</span><span class='String'>&quot;ST&quot;</span><span class='Ligature'>â€¿</span><span class='String'>&quot;UV&quot;</span>
â”Œâ”€       
â•"abcQR  
  abcST  
  abcUV  
         
 Â·defQR  
  defST  
  defUV" 
        â”˜

    <span class='Function'>â‰¢</span> <span class='Paren'>(</span><span class='String'>&quot;abc&quot;</span><span class='Function'>â‰</span><span class='String'>&quot;def&quot;</span><span class='Paren'>)</span> <span class='Function'>âˆ¾</span><span class='Modifier2'>â‰</span><span class='Number'>1</span><span class='Modifier2'>â‰</span><span class='Number'>1</span><span class='Ligature'>â€¿</span><span class='Number'>âˆ</span> <span class='Function'>&gt;</span><span class='String'>&quot;QR&quot;</span><span class='Ligature'>â€¿</span><span class='String'>&quot;ST&quot;</span><span class='Ligature'>â€¿</span><span class='String'>&quot;UV&quot;</span>
âŸ¨ 2 3 5 âŸ©

    <span class='Function'>â‰¢</span> <span class='Paren'>(</span><span class='Function'>â†•</span><span class='Number'>3</span><span class='Ligature'>â€¿</span><span class='Number'>4</span><span class='Ligature'>â€¿</span><span class='Number'>5</span><span class='Paren'>)</span> <span class='Function'>âˆ¾</span><span class='Modifier2'>â‰</span><span class='Number'>1</span><span class='Modifier2'>â‰</span><span class='Number'>1</span><span class='Ligature'>â€¿</span><span class='Number'>âˆ</span> <span class='Function'>â†•</span><span class='Number'>0</span><span class='Ligature'>â€¿</span><span class='Number'>1</span><span class='Ligature'>â€¿</span><span class='Number'>2</span><span class='Ligature'>â€¿</span><span class='Number'>8</span>
âŸ¨ 3 4 0 1 2 13 âŸ©
</pre>
<p>The flexibility of Rank also means we're able to apply this pattern with ranks other than 1. In particular, <code><span class='Function'>ğ”½</span><span class='Modifier2'>â‰</span><span class='Number'>âˆ</span><span class='Ligature'>â€¿</span><span class='Number'>Â¯1</span><span class='Modifier2'>â‰</span><span class='Number'>Â¯1</span><span class='Ligature'>â€¿</span><span class='Number'>âˆ</span></code> applies <code><span class='Function'>ğ”½</span></code> to all combinations of one major cell from either argumentâ€”an equivalent to <code><span class='Function'>&gt;ğ”½</span><span class='Modifier'>âŒœ</span><span class='Modifier2'>â—‹</span><span class='Paren'>(</span><span class='Function'>&lt;</span><span class='Modifier'>Ë˜</span><span class='Paren'>)</span></code>. In this case the left rank of <code><span class='Function'>ğ”½</span><span class='Modifier2'>â‰</span><span class='Number'>âˆ</span><span class='Ligature'>â€¿</span><span class='Number'>Â¯1</span></code> is unknown, so the only way to apply <code><span class='Function'>ğ”½</span></code> to the entire cell from <code><span class='Value'>ğ•¨</span></code> is to use rank âˆ.</p>
