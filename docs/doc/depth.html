<head><link href="../style.css" rel="stylesheet"/></head>
<div class="nav"><a href="https://github.com/mlochbaum/BQN">BQN</a></div>
<h1 id="depth">Depth</h1>
<p>The depth of an array is the greatest level of array nesting it attains, or, put another way, the greatest number of times you can pick an element starting from the original array before reaching a non-array. The monadic function Depth (<code><span class='Function'>‚â°</span></code>) returns the depth of its argument, while the 2-modifier Depth (<code><span class='Modifier2'>‚öá</span></code>) can control the way its left operand is applied based on the depth of its arguments. Several primitive functions also use the depth of the left argument to decide whether it applies to a single axis of the right argument or to several axes.</p>
<h2 id="the-depth-function">The Depth function</h2>
<p>To find the depth of an array, use Depth (<code><span class='Function'>‚â°</span></code>). For example, the depth of a list of numbers or characters is 1:</p>
<pre>    <span class='Function'>‚â°</span> <span class='Number'>2</span><span class='Ligature'>‚Äø</span><span class='Number'>3</span><span class='Ligature'>‚Äø</span><span class='Number'>4</span>
1
    <span class='Function'>‚â°</span> <span class='String'>&quot;a string is a list of characters&quot;</span>
1
</pre>
<p>Depth is somewhat analogous to an array's rank <code><span class='Function'>=</span><span class='Value'>ùï©</span></code>, and in fact rank can be &quot;converted&quot; to depth by splitting rows with <code><span class='Function'>&lt;</span><span class='Modifier2'>‚éâ</span><span class='Number'>1</span></code>, reducing the rank by 1 and increasing the depth. Unlike rank, Depth doesn't care at all about its argument's shape:</p>
<pre>    <span class='Function'>‚â°</span> <span class='Number'>3</span><span class='Ligature'>‚Äø</span><span class='Number'>4</span><span class='Function'>‚•ä</span><span class='String'>&quot;characters&quot;</span>
1
    <span class='Function'>‚â°</span> <span class='Paren'>(</span><span class='Number'>1</span><span class='Function'>+‚Üï</span><span class='Number'>10</span><span class='Paren'>)</span><span class='Function'>‚•ä</span><span class='String'>&quot;characters&quot;</span>
1
</pre>
<p>Also unlike rank, Depth <em>does</em> care about the elements of its argument: in fact, to find the depth of an array, every element must be inspected.</p>
<pre>    <span class='Function'>‚â°</span> <span class='Bracket'>‚ü®</span><span class='Number'>2</span><span class='Separator'>,</span><span class='Number'>3</span><span class='Separator'>,</span><span class='Number'>4</span><span class='Separator'>,</span><span class='Number'>5</span><span class='Bracket'>‚ü©</span>
1
    <span class='Function'>‚â°</span> <span class='Bracket'>‚ü®</span><span class='Number'>2</span><span class='Separator'>,</span><span class='Function'>&lt;</span><span class='Number'>3</span><span class='Separator'>,</span><span class='Number'>4</span><span class='Separator'>,</span><span class='Number'>5</span><span class='Bracket'>‚ü©</span>
2
    <span class='Function'>‚â°</span> <span class='Bracket'>‚ü®</span><span class='Number'>2</span><span class='Separator'>,</span><span class='Function'>&lt;</span><span class='Number'>3</span><span class='Separator'>,</span><span class='Number'>4</span><span class='Separator'>,</span><span class='Function'>&lt;&lt;&lt;</span><span class='Number'>5</span><span class='Bracket'>‚ü©</span>
4
</pre>
<p>As the above expressions suggest, the depth of an array is the maximum of its elements' depths, plus one. The base case, a non-array (including a function or modifier), has depth 0.</p>
<pre>    <span class='Function'>‚â°</span><span class='String'>'c'</span>
0
    <span class='Function'>F</span><span class='Gets'>‚Üê</span><span class='Function'>+</span><span class='Separator'>‚ãÑ</span><span class='Function'>‚â°</span><span class='Value'>f</span>
0
    <span class='Function'>‚â°</span><span class='Bracket'>‚ü®</span><span class='String'>'c'</span><span class='Separator'>,</span><span class='Value'>f</span><span class='Separator'>,</span><span class='Number'>2</span><span class='Bracket'>‚ü©</span>
1
    <span class='Function'>‚â°</span><span class='Bracket'>‚ü®</span><span class='Number'>5</span><span class='Separator'>,</span><span class='Bracket'>‚ü®</span><span class='String'>'c'</span><span class='Separator'>,</span><span class='Value'>f</span><span class='Separator'>,</span><span class='Number'>2</span><span class='Bracket'>‚ü©‚ü©</span>
2
</pre>
<p>If the function <code><span class='Function'>IsArray</span></code> indicates whether its argument is an array, then we can write a recursive definition of Depth using the Choose modifier.</p>
<pre><span class='Function'>Depth</span><span class='Gets'>‚Üê</span><span class='Function'>IsArray</span><span class='Modifier2'>‚ó∂</span><span class='Number'>0</span><span class='Ligature'>‚Äø</span><span class='Brace'>{</span><span class='Number'>1</span><span class='Function'>+</span><span class='Number'>0</span><span class='Function'>‚åà</span><span class='Modifier'>¬¥</span><span class='Function'>Depth</span><span class='Modifier'>¬®</span><span class='Function'>‚•ä</span><span class='Value'>ùï©</span><span class='Brace'>}</span>
</pre>
<p>The minimum element depth of 0 implies that an empty array's depth is 1.</p>
<pre>    <span class='Function'>‚â°</span><span class='Bracket'>‚ü®‚ü©</span>
1
    <span class='Function'>‚â°</span><span class='Number'>2</span><span class='Ligature'>‚Äø</span><span class='Number'>0</span><span class='Ligature'>‚Äø</span><span class='Number'>3</span><span class='Function'>‚•ä</span><span class='Number'>0</span>
1
</pre>
<h2 id="testing-depth-for-multiple-axis-primitives">Testing depth for multiple-axis primitives</h2>
<p>Several primitive functions use the left argument to manipulate the right argument along one or more axes, using <a href="leading.html#multiple-axes">the leading axis convention</a>.</p>
<table>
<thead>
<tr>
<th>Single-axis depth</th>
<th>Functions</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td><code><span class='Function'>‚Üë‚Üì‚Üï‚åΩ‚çâ</span></code></td>
</tr>
<tr>
<td>1</td>
<td><code><span class='Function'>/‚äè‚äî</span></code></td>
</tr>
</tbody>
</table>
<p>Functions such as Take and Drop use a single number per axis. When the left argument is a list of numbers, they apply to initial axes. But for convenience, a single number is also accepted, and applied to the first axis only. This is equivalent to ravelling the left argument before applying the function.</p>
<pre>    <span class='Function'>‚â¢</span><span class='Number'>2</span><span class='Function'>‚Üë</span><span class='Number'>7</span><span class='Ligature'>‚Äø</span><span class='Number'>7</span><span class='Ligature'>‚Äø</span><span class='Number'>7</span><span class='Ligature'>‚Äø</span><span class='Number'>7</span><span class='Function'>‚•ä</span><span class='String'>&quot;abc&quot;</span>
‚ü® 2 7 7 7 ‚ü©
    <span class='Function'>‚â¢</span><span class='Number'>2</span><span class='Ligature'>‚Äø</span><span class='Number'>1</span><span class='Ligature'>‚Äø</span><span class='Number'>1</span><span class='Function'>‚Üë</span><span class='Number'>7</span><span class='Ligature'>‚Äø</span><span class='Number'>7</span><span class='Ligature'>‚Äø</span><span class='Number'>7</span><span class='Ligature'>‚Äø</span><span class='Number'>7</span><span class='Function'>‚•ä</span><span class='String'>&quot;abc&quot;</span>
‚ü® 2 1 1 7 ‚ü©
</pre>
<p>In these cases the flexibility seems trivial because the left argument has depth 1 or 0: it is an array or isn't, and it's obvious what a plain number should do. But for the second row in the table, the left argument is always an array. The general case is that the left argument is a vector and its elements correspond to right argument axes:</p>
<pre>    <span class='Bracket'>‚ü®</span><span class='Number'>3</span><span class='Ligature'>‚Äø</span><span class='Number'>2</span><span class='Separator'>,</span><span class='Number'>1</span><span class='Ligature'>‚Äø</span><span class='Number'>4</span><span class='Ligature'>‚Äø</span><span class='Number'>1</span><span class='Bracket'>‚ü©</span> <span class='Function'>‚äè</span> <span class='Function'>‚Üï</span><span class='Number'>6</span><span class='Ligature'>‚Äø</span><span class='Number'>7</span>
‚îå‚îÄ                         
‚ïµ ‚ü® 3 1 ‚ü© ‚ü® 3 4 ‚ü© ‚ü® 3 1 ‚ü©  
  ‚ü® 2 1 ‚ü© ‚ü® 2 4 ‚ü© ‚ü® 2 1 ‚ü©  
                          ‚îò
</pre>
<p>This means the left argument is homogeneous of depth 2. What should an argument of depth 1, or an argument that contains non-arrays, do? One option is to continue to require the left argument to be a list, and convert any non-array argument into an array by enclosing it:</p>
<pre>    <span class='Bracket'>‚ü®</span><span class='Number'>3</span><span class='Ligature'>‚Äø</span><span class='Number'>2</span><span class='Separator'>,</span><span class='Number'>1</span><span class='Bracket'>‚ü©</span> <span class='Function'>&lt;</span><span class='Modifier2'>‚çü</span><span class='Paren'>(</span><span class='Number'>0</span><span class='Function'>=‚â°</span><span class='Paren'>)</span><span class='Modifier'>¬®</span><span class='Modifier2'>‚ä∏</span><span class='Function'>‚äè</span> <span class='Function'>‚Üï</span><span class='Number'>6</span><span class='Ligature'>‚Äø</span><span class='Number'>7</span>
‚ü® ‚ü® 3 1 ‚ü© ‚ü® 2 1 ‚ü© ‚ü©
</pre>
<p>While very consistent, this extension represents a small convenience and makes it difficult to act on a single axis, which for Replicate and <a href="group.html">Group</a> is probably the most common way the primitive is used:</p>
<pre>    <span class='Number'>3</span><span class='Ligature'>‚Äø</span><span class='Number'>2</span><span class='Ligature'>‚Äø</span><span class='Number'>1</span><span class='Ligature'>‚Äø</span><span class='Number'>2</span><span class='Ligature'>‚Äø</span><span class='Number'>3</span> <span class='Function'>/</span> <span class='String'>&quot;abcde&quot;</span>
"aaabbcddeee"
</pre>
<p>With the extension above, every case like this would have to use <code><span class='Function'>&lt;</span><span class='Modifier2'>‚ä∏</span><span class='Function'>/</span></code> instead of just <code><span class='Function'>/</span></code>. BQN avoids this difficulty by testing the left argument's depth. A depth-1 argument applies to the first axis only, giving the behavior above.</p>
<p>For Select, the depth-1 case is still quite useful, but it may also be desirable to choose a single cell using a list of numbers. In this case the left argument depth can be increased from the bottom using <code><span class='Function'>&lt;</span><span class='Modifier'>¬®</span></code>.</p>
<pre>    <span class='Number'>2</span><span class='Ligature'>‚Äø</span><span class='Number'>1</span><span class='Ligature'>‚Äø</span><span class='Number'>4</span> <span class='Function'>&lt;</span><span class='Modifier'>¬®</span><span class='Modifier2'>‚ä∏</span><span class='Function'>‚äè</span> <span class='Function'>‚Üï</span><span class='Number'>3</span><span class='Ligature'>‚Äø</span><span class='Number'>4</span><span class='Ligature'>‚Äø</span><span class='Number'>5</span><span class='Ligature'>‚Äø</span><span class='Number'>2</span>
‚ü® ‚ü® 2 1 4 0 ‚ü© ‚ü® 2 1 4 1 ‚ü© ‚ü©
</pre>
<h2 id="the-depth-modifier">The Depth modifier</h2>
<p>The Depth 2-modifier (<code><span class='Modifier2'>‚öá</span></code>) is a generalization of Each that allows diving deeper into an array. To illustrate it we'll use a shape <code><span class='Number'>4</span><span class='Ligature'>‚Äø</span><span class='Number'>3</span></code> array of lists of lists.</p>
<pre>    <span class='Function'>‚ä¢</span> <span class='Value'>n</span> <span class='Gets'>‚Üê</span> <span class='Function'>&lt;</span><span class='Modifier2'>‚éâ</span><span class='Number'>1</span><span class='Modifier2'>‚çü</span><span class='Number'>2</span> <span class='Number'>4</span><span class='Ligature'>‚Äø</span><span class='Number'>3</span><span class='Ligature'>‚Äø</span><span class='Number'>2</span><span class='Ligature'>‚Äø</span><span class='Number'>2</span><span class='Function'>‚•ä‚Üï</span><span class='Number'>48</span>
‚îå‚îÄ                                                                         
‚ïµ ‚ü® ‚ü® 0 1 ‚ü© ‚ü® 2 3 ‚ü© ‚ü©     ‚ü® ‚ü® 4 5 ‚ü© ‚ü® 6 7 ‚ü© ‚ü©     ‚ü® ‚ü® 8 9 ‚ü© ‚ü® 10 11 ‚ü© ‚ü©    
  ‚ü® ‚ü® 12 13 ‚ü© ‚ü® 14 15 ‚ü© ‚ü© ‚ü® ‚ü® 16 17 ‚ü© ‚ü® 18 19 ‚ü© ‚ü© ‚ü® ‚ü® 20 21 ‚ü© ‚ü® 22 23 ‚ü© ‚ü©  
  ‚ü® ‚ü® 24 25 ‚ü© ‚ü® 26 27 ‚ü© ‚ü© ‚ü® ‚ü® 28 29 ‚ü© ‚ü® 30 31 ‚ü© ‚ü© ‚ü® ‚ü® 32 33 ‚ü© ‚ü® 34 35 ‚ü© ‚ü©  
  ‚ü® ‚ü® 36 37 ‚ü© ‚ü® 38 39 ‚ü© ‚ü© ‚ü® ‚ü® 40 41 ‚ü© ‚ü® 42 43 ‚ü© ‚ü© ‚ü® ‚ü® 44 45 ‚ü© ‚ü® 46 47 ‚ü© ‚ü©  
                                                                          ‚îò
    <span class='Function'>‚â°</span> <span class='Value'>n</span>
3
</pre>
<p>Reversing n swaps all the rows:</p>
<pre>    <span class='Function'>‚åΩ</span> <span class='Value'>n</span>
‚îå‚îÄ                                                                         
‚ïµ ‚ü® ‚ü® 36 37 ‚ü© ‚ü® 38 39 ‚ü© ‚ü© ‚ü® ‚ü® 40 41 ‚ü© ‚ü® 42 43 ‚ü© ‚ü© ‚ü® ‚ü® 44 45 ‚ü© ‚ü® 46 47 ‚ü© ‚ü©  
  ‚ü® ‚ü® 24 25 ‚ü© ‚ü® 26 27 ‚ü© ‚ü© ‚ü® ‚ü® 28 29 ‚ü© ‚ü® 30 31 ‚ü© ‚ü© ‚ü® ‚ü® 32 33 ‚ü© ‚ü® 34 35 ‚ü© ‚ü©  
  ‚ü® ‚ü® 12 13 ‚ü© ‚ü® 14 15 ‚ü© ‚ü© ‚ü® ‚ü® 16 17 ‚ü© ‚ü® 18 19 ‚ü© ‚ü© ‚ü® ‚ü® 20 21 ‚ü© ‚ü® 22 23 ‚ü© ‚ü©  
  ‚ü® ‚ü® 0 1 ‚ü© ‚ü® 2 3 ‚ü© ‚ü©     ‚ü® ‚ü® 4 5 ‚ü© ‚ü® 6 7 ‚ü© ‚ü©     ‚ü® ‚ü® 8 9 ‚ü© ‚ü® 10 11 ‚ü© ‚ü©    
                                                                          ‚îò
</pre>
<p>Depth <code><span class='Number'>¬Ø1</span></code> is equivalent to Each, and reverses the larger vectors, while depth <code><span class='Number'>¬Ø2</span></code> applies Each twice to reverse the smaller vectors:</p>
<pre>    <span class='Function'>‚åΩ</span><span class='Modifier2'>‚öá</span><span class='Number'>¬Ø1</span> <span class='Value'>n</span>
‚îå‚îÄ                                                                         
‚ïµ ‚ü® ‚ü® 2 3 ‚ü© ‚ü® 0 1 ‚ü© ‚ü©     ‚ü® ‚ü® 6 7 ‚ü© ‚ü® 4 5 ‚ü© ‚ü©     ‚ü® ‚ü® 10 11 ‚ü© ‚ü® 8 9 ‚ü© ‚ü©    
  ‚ü® ‚ü® 14 15 ‚ü© ‚ü® 12 13 ‚ü© ‚ü© ‚ü® ‚ü® 18 19 ‚ü© ‚ü® 16 17 ‚ü© ‚ü© ‚ü® ‚ü® 22 23 ‚ü© ‚ü® 20 21 ‚ü© ‚ü©  
  ‚ü® ‚ü® 26 27 ‚ü© ‚ü® 24 25 ‚ü© ‚ü© ‚ü® ‚ü® 30 31 ‚ü© ‚ü® 28 29 ‚ü© ‚ü© ‚ü® ‚ü® 34 35 ‚ü© ‚ü® 32 33 ‚ü© ‚ü©  
  ‚ü® ‚ü® 38 39 ‚ü© ‚ü® 36 37 ‚ü© ‚ü© ‚ü® ‚ü® 42 43 ‚ü© ‚ü® 40 41 ‚ü© ‚ü© ‚ü® ‚ü® 46 47 ‚ü© ‚ü® 44 45 ‚ü© ‚ü©  
                                                                          ‚îò
    <span class='Function'>‚åΩ</span><span class='Modifier2'>‚öá</span><span class='Number'>¬Ø2</span> <span class='Value'>n</span>
‚îå‚îÄ                                                                         
‚ïµ ‚ü® ‚ü® 1 0 ‚ü© ‚ü® 3 2 ‚ü© ‚ü©     ‚ü® ‚ü® 5 4 ‚ü© ‚ü® 7 6 ‚ü© ‚ü©     ‚ü® ‚ü® 9 8 ‚ü© ‚ü® 11 10 ‚ü© ‚ü©    
  ‚ü® ‚ü® 13 12 ‚ü© ‚ü® 15 14 ‚ü© ‚ü© ‚ü® ‚ü® 17 16 ‚ü© ‚ü® 19 18 ‚ü© ‚ü© ‚ü® ‚ü® 21 20 ‚ü© ‚ü® 23 22 ‚ü© ‚ü©  
  ‚ü® ‚ü® 25 24 ‚ü© ‚ü® 27 26 ‚ü© ‚ü© ‚ü® ‚ü® 29 28 ‚ü© ‚ü® 31 30 ‚ü© ‚ü© ‚ü® ‚ü® 33 32 ‚ü© ‚ü® 35 34 ‚ü© ‚ü©  
  ‚ü® ‚ü® 37 36 ‚ü© ‚ü® 39 38 ‚ü© ‚ü© ‚ü® ‚ü® 41 40 ‚ü© ‚ü® 43 42 ‚ü© ‚ü© ‚ü® ‚ü® 45 44 ‚ü© ‚ü® 47 46 ‚ü© ‚ü©  
                                                                          ‚îò
</pre>
<p>While a negative depth tells how many levels to go down, a non-negative depth gives the maximum depth of the argument before applying the left operand. On a depth-3 array like above, depth <code><span class='Number'>2</span></code> is equivalent to <code><span class='Number'>¬Ø1</span></code> and depth <code><span class='Number'>1</span></code> is equivalent to <code><span class='Number'>¬Ø2</span></code>. A depth of <code><span class='Number'>0</span></code> means to loop until non-arrays are reached, that is, apply <a href="https://aplwiki.com/wiki/Pervasion">pervasively</a>, like a scalar function.</p>
<pre>    <span class='Bracket'>‚ü®</span><span class='String'>'a'</span><span class='Separator'>,</span><span class='String'>&quot;bc&quot;</span><span class='Bracket'>‚ü©</span> <span class='Function'>‚âç</span><span class='Modifier2'>‚öá</span><span class='Number'>0</span> <span class='Bracket'>‚ü®</span><span class='Number'>2</span><span class='Ligature'>‚Äø</span><span class='Number'>3</span><span class='Separator'>,</span><span class='Number'>4</span><span class='Bracket'>‚ü©</span>
‚îå‚îÄ                                                 
¬∑ ‚ü® ‚ü® 'a' 2 ‚ü© ‚ü® 'a' 3 ‚ü© ‚ü© ‚ü® ‚ü® 'b' 4 ‚ü© ‚ü® 'c' 4 ‚ü© ‚ü©  
                                                  ‚îò
</pre>
<p>With a positive operand, Depth doesn't have to use the same depth everywhere. Here, Length is applied as soon as the depth for a particular element is 1 or less, including if the argument has depth 0. For example, it maps over <code><span class='Bracket'>‚ü®</span><span class='Number'>2</span><span class='Separator'>,</span><span class='Bracket'>‚ü®</span><span class='Number'>3</span><span class='Separator'>,</span><span class='Number'>4</span><span class='Bracket'>‚ü©‚ü©</span></code>, but not over <code><span class='Bracket'>‚ü®</span><span class='Number'>11</span><span class='Separator'>,</span><span class='Number'>12</span><span class='Bracket'>‚ü©</span></code>, even though these are elements of the same array.</p>
<pre>    <span class='Function'>‚â†</span><span class='Modifier2'>‚öá</span><span class='Number'>1</span> <span class='Bracket'>‚ü®</span><span class='Number'>1</span><span class='Separator'>,</span><span class='Bracket'>‚ü®</span><span class='Number'>2</span><span class='Separator'>,</span><span class='Bracket'>‚ü®</span><span class='Number'>3</span><span class='Separator'>,</span><span class='Number'>4</span><span class='Bracket'>‚ü©‚ü©</span><span class='Separator'>,</span><span class='Bracket'>‚ü®</span><span class='Number'>5</span><span class='Separator'>,</span><span class='Bracket'>‚ü®</span><span class='Number'>6</span><span class='Separator'>,</span><span class='Number'>7</span><span class='Bracket'>‚ü©</span><span class='Separator'>,</span><span class='Bracket'>‚ü®</span><span class='Number'>8</span><span class='Separator'>,</span><span class='Number'>9</span><span class='Separator'>,</span><span class='Number'>10</span><span class='Bracket'>‚ü©‚ü©</span><span class='Separator'>,</span><span class='Bracket'>‚ü®</span><span class='Number'>11</span><span class='Separator'>,</span><span class='Number'>12</span><span class='Bracket'>‚ü©‚ü©</span>
‚ü® 1 ‚ü® 1 2 ‚ü© ‚ü® 1 2 3 ‚ü© 2 ‚ü©
</pre>

