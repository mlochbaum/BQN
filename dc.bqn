#! /usr/bin/env dbqn

# dzaima/BQN block headers have a different format to account for
# multiple bodies, and use variable names instead of counts.
# Rearrange and make up some names so the bytecode can be run.

glyphs â† â€¢Import "src/glyphs.bqn"
compile â† glyphs â€¢Import "src/c.bqn"
prims â† â€¢BQNâˆ˜â¥ŠÂ¨ âˆ¾glyphs

specialâ†<Ë˜âˆ˜â€¿2â¥Š"ğ•¤ğ•©ğ•¨ğ•£ğ•—ğ•˜"
DCompileâ‡{
  âŸ¨bc,o,fblk,indâŸ© â† 4 â†‘ (ğ•¨âŠ£prims) Compile ğ•©
  blkâ€¿bdy â† <Ë˜â‰>(â†•â‰ fblk){
    âŸ¨t,i,l,nâŸ©â†ğ•©
    sâ†(3Ã—i)â†“(tâŠ‘3â€¿5â€¿6)â†‘special
    âŸ¨âŸ¨t,i,ğ•¨,ğ•¨âŸ© â‹„ âŸ¨l, sâˆ¾â¥ŠÂ¨'a'+â†•n-â‰ sâŸ©âŸ©
  }Â¨fblk
  âŸ¨bc,o,blk,âŠ‘blk,bdy,âŠ‘ind,1âŠ‘ind,ğ•©âŸ©
}
DRunâ‡â€¢COMPâˆ˜DCompile
