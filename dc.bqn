#! /usr/bin/env dbqn

# dzaima/BQN block headers have a different format to account for
# multiple bodies, and use variable names instead of counts.
# Rearrange and make up some names so the bytecode can be run.

glyphs â† â€¢Importâˆ˜"src/glyphs.bqn"âŸ(0=â‰ ) â€¢args
compile â† glyphs â€¢Import "src/c.bqn"

specialâ†<Ë˜âˆ˜â€¿2â¥Š"ğ•¤ğ•©ğ•¨ğ•£ğ•—ğ•˜"
DCompileâ‡{
  âŸ¨bc,o,fblk,ind,tokâŸ© â† 5 â†‘ (ğ•¨ â€¢BQNâˆ˜â¥ŠÂ¨âˆ˜âˆ¾âŠ˜âŠ£ glyphs) Compile ğ•©
  name â† âŠ‘2âŠ‘tok
  blkâ€¿bdy â† <Ë˜â‰>(â†•â‰ fblk){
    âŸ¨t,i,l,n,d,eâŸ©â†ğ•©
    sâ†(3Ã—i)â†“(tâŠ‘3â€¿5â€¿6)â†‘special
    âŸ¨âŸ¨t,i,ğ•¨,ğ•¨âŸ© â‹„ âŸ¨l, sâˆ¾dâŠname, (0Â¨s)âˆ¾eâŸ©âŸ©
  }Â¨fblk
  âŸ¨bc,o,blk,âŠ‘blk,bdy,âŠ‘ind,1âŠ‘ind,ğ•©âŸ©
}
DRunâ‡â€¢COMPâˆ˜DCompile
