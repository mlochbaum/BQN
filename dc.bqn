â Run with spec/dzref

nlâ€¿tabâ†â€¢UCS 10â€¿9
charSetâ†âˆ¾charGroupsâ†âŸ¨
  chFâ†"+-Ã—Ã·â‹†âˆšâŒŠâŒˆ|Â¬âˆ§âˆ¨<>â‰ =â‰¤â‰¥â‰¡â‰¢âŠ£âŠ¢â¥Šâˆ¾â‰â†‘â†“â†•âŒ½â‰/â‹â’âŠâŠ‘âŠâŠ’âˆŠâ·âŠ”" â Function
  "ËœË˜Â¨âŒœâ¼Â´`"             â Modifier
  "âˆ˜â—‹âŠ¸âŸœâŒ¾âŠ˜â—¶â‰âš‡âŸ"          â Composition
  "ğ•¨ğ•ğ•©ğ•ğ•—ğ”½ğ•˜ğ”¾"            â Input
  nlâˆ¾"â‹„,"               â Separator
  "â†â†©â†’"                 â Gets
  "(){}âŸ¨âŸ©"              â Bracket
  "â€¿"                   â Ligature
  â€¢d â +âŸœ(â†•10)âŒ¾â€¢UCS'0'  â Digit
  "Â¯.Ï€âˆ"                â Numeric
  "_"âˆ¾' '(âŠ¢âˆ¾+)âŒ¾â€¢UCSâ€¢a   â Alphabetic
  " "âˆ¾tab               â Whitespace
â â'" eliminated during tokenization
âŸ©
bFâ€¿bMâ€¿bCâ€¿bIâ€¿bSâ€¿bGâ€¿bBâ€¿bLâ€¿bDâ€¿bNâ€¿bAâ€¿bWâ†âŠ”/â‰ Â¨charGroups
viâ†+Â´â‰ Â¨8â†‘charGroups

Tokenizeâ†{
  râ†ğ•©='â'â‹„sâ†/(â‰ â†‘2âŠ¸â†“)âŠ¸âˆ§ğ•©=âŠ‘"'"â‹„dâ†/ğ•©='"'
  gâ†â‹qâ†âˆ¾âŸ¨  sâ‹„Â¯1â†“dâ‹„/râŸ© â‹„qâ†©gâŠq
  eâ† gâŠâˆ¾âŸ¨2+sâ‹„ 1â†“dâ‹„(âŠ¢-Â¯1â†“0âˆ¾âŠ¢)âˆ˜âŠâŸœ(0âˆ¾+`r)âŠ¸//(ğ•©=nl)âˆ¾1âŸ©
  Seâ†{(âŠËœğ•¨)Se 1Â¨âŒ¾((ğ•©/ğ•¨)âŠ¸âŠ)ğ•©}âŸ{0=âŠ‘âŒ½ğ•©}
  stâ†Â¯1â†“SeâŸœ(1â†‘Ëœâ‰ )âˆ¾âŸœâ‰ qâŠ¸â‹Â¨eâ‹„bâ†st/qâˆ¾Ë˜e
  ToIâ†Â¯1â†“Â·/â¼(â‰ ğ•©)âˆ¾Ëœâ¥Šâ‹„fâ†Â¬â‰ `ToI b
  cbâ†(Â¬(st/q)âŠr)/b
  nlâ†â‰ luâ†â·litâ†ğ•©âŠ”Ëœ1-Ëœ(+`ToIâŠ‘Ë˜cb)Ã—â‰ `ToI cb
  clâ†f/ToIâŠ‘âˆ˜âŒ½Ë˜cb
  argsâ†charSetâŠ¸âŠÂ¨ğ•¨â‹„câ†charSetâŠf/ğ•©
  wâ†(â‰ â†‘0âˆ¾âŠ¢)âŠ¸<lâ†câˆŠâˆ¾bDâ€¿bNâ€¿bA
  idâ†â·argsâˆ¾(bAâˆŠËœw/c)â’âŠ¸âŠiâ†(1-ËœlÃ—+`w)âŠ”c
  nvâ†+Â´bAâˆŠËœâŠ‘Â¨id
  câ†©(wâˆ¨Â¬lâˆ¨câˆŠbW)/(vi+idâŠi)âŒ¾(wâŠ¸/)(vi+(â‰ id)+luâŠlit)âŒ¾(clâŠ¸/)c
  c/Ëœâ†©Â¬(1âŒ¾âŠ‘1âŒ½1âŒ¾âŠ‘)âŠ¸âˆ§câˆŠbS
  âŸ¨c,nv,nv-â‰ args,(nvâ†“id)âˆ¾luâŸ©
}

Parseâ†{
  aâ†ğ•©âˆŠ(2â†‘bG)â‹„atâ†1âŒ½aâ‹„ğ•©/Ëœâ†©Â¬aâ‹„a/Ëœâ†©Â¬at
  lâ†â‰ ğ•©â‹„sepâ†ğ•©âˆŠbSâ‹„ğ•©â†©(bFâŠ‘Ëœâ¥ŠchFâŠ<'âŠ£')Â¨âŒ¾(sepâŠ¸/)ğ•©â‹„sepâˆ¨â†©ğ•©=2âŠ‘bB
  oâ†ğ•©=0âŠ‘bBâ‹„câ†ğ•©=1âŠ‘bBâ‹„vâ†a-Ëœğ•©â‰¥viâ‹„fâ†Â¬oâˆ¨câˆ¨vâˆ¨sep
  naâ†(2Ã—sep)+fÃ—1+lâ†‘0âˆ¾câˆ¨v
  dâ†+`o-câ‹„feâ†(dâ‹âŠ¸(â‹âˆ˜âŠ£âŠ+`âˆ˜âŠ)o)âŠlâˆ¾(â‹âŠâŸœd)âŠ¸âŠ/c
  feâŒŠâ†©l-lâ†‘âŒ½âŒˆ`â†•âˆ˜â‰ âŠ¸Ã—âŒ½1âˆ¾Ëœsep
  selâ†Â¬âˆ˜âŠâŸœ(oâˆ¨c)âŠ¸/â‹((fÃ—fe)âŒˆâ†•l)-+`f-lâ†‘/â¼âˆ§f/fe
  selâŠ¸âŠÂ¨ğ•©â€¿na
}

Baseâ†{+âŸœ(ğ•¨âŠ¸Ã—)Â´ğ•©}
Enc2â†{2|âŒŠâˆ˜Ã·âŸœ2âŸ(â†•ğ•¨)ğ•©}

Hexâ†16 BaseâŸœâŒ½ (â€¢dâˆ¾"ABCDEF")âŠ¸âŠ

ReadNumâ†10 BaseâŸœâŒ½ bDâŠ¸âŠ
GenF64â†{
  0:8â¥Š0;
  lâ†2(âŒŠâ‹†â¼)ğ•©
  (Hex"44")âˆ¾2 BaseË˜8â€¿8â¥Šâˆ¾âŸ¨Â¯52â†‘(0âŒˆl)Enc2ğ•©,11 Enc2 1023+l,â¥Š0âŸ©
}
MakeTabâ†{{âŠ‘âˆ˜(âˆ¾âŸœ0)Â¨Â¯1â†“(chFâŠğ•¨)âŠ”â—‹(âˆ¾âŸœ(â‰ chF))ğ•©}â—‹âˆ¾âŸœ(â¥ŠÂ¨âˆ˜â¥ŠÂ¨)Â´<Ë˜â‰(2(Ã·Ëœâˆ¾âŠ£)â‰¢)âŠ¸â¥Šğ•©}
tab1â†MakeTabâŸ¨
  "âŠ£âŠ¢"     , 2â¥Š<âŸ¨âŸ©
  "|-âŒˆâŒŠâˆš"  , (Hex"99")+(â†•4)âˆ¾6
  "Ã·"      , <(Hex"10")âˆ¾0
  "Â¬"      , <âˆ¾â¥ŠÂ¨âŸ¨Hex"9A",GenF64 1,Hex"A0"âŸ©
âŸ©
tab2â†MakeTabâŸ¨
  "âŠ£"      , Hex"1A"
  "+-Ã—Ã·âŒŠâŒˆâˆ§", (Hex"A0")+(â†•6)âˆ¾2
  "Â¬"      , <âˆ¾â¥ŠÂ¨âŸ¨Hex"A1",GenF64 1,Hex"A0"âŸ©
  "âˆ¨"      , <(Hex"10")âˆ¾1
âŸ©
fntabâ†â‰(0Â¨tab1)âˆ¾tab1â‰tab2
f64â†127-3

GenFnâ†{
  âŸ¨âŸ©GenFnğ•©;
  âŸ¨t,nVar,nLoc,litsâŸ©â†ğ•¨Tokenizeğ•©
  tâŠËœâ†©â‹+`-Â´<Ë˜(2â€¿3âŠbB)=âŒœt
  ndâ†+Â´câ†t=3âŠ‘bB
  tâ†©((vi+nVar+â‰ lits)+â†•âˆ˜â‰ )âŒ¾(câŠ¸/)t
  âŸ¨a,naâŸ©â†Parse t
  opsâ†â¥Šâˆ¾âŸ¨
    âˆ¾âŸœ(0â¥ŠËœ3âˆ¾Ëœvi-â‰ )fntab
    â‰(HexÂ¨"20"â€¿"22"â€¿"21")âˆ¾âŒœâ†•nVar
    âŠ£âŒœâŸœ(â†•3)(GenF64âˆ˜ReadNumÂ¨lits)âˆ¾(Hex"10")âˆ¾Â¨3+â†•nd
  âŸ©
  (((â‰ âˆ¾âˆ¾)âŸ¨nLocâˆ¾f64âŸ©)âˆ¾(Hex"0B")âˆ¾Ëœâˆ¾)Â¨((âŠ¢-ËœÂ¬Ã—+`)a=2âŠ‘bB)âŠ”(na+3Ã—a)âŠops
}

Genâ†{
  LEBâ†{0:â¥Š0;128âŠ¸+âŒ¾(Â¯1âŠ¸â†“) 2 BaseË˜ (âŒ½Â·âˆ¨`Â·âŒ½âˆ¨Â´Ë˜)âŠ¸/ 10â€¿7(âŠ£â¥ŠÃ—Â´âŠ¸â†‘) 64 Enc2 ğ•©}
  Câ†LEBâˆ˜â‰ âŠ¸âˆ¾
  Sâ†âˆ¾âŸœC
  Vâ†â‰ âˆ¾âˆ¾
  Iâ†Câˆ˜â€¢UCS
  tâ€¿nâ€¿bâ†ğ•©
  âˆ¾âŸ¨
   0âˆ¾(â€¢UCS"asm")âˆ¾4â†‘1
   1 S V (96âˆ¾âŸœâˆ¾CÂ¨)Â¨t
   3 S V â¥ŠÂ¨â†•â‰ b
   7 S V â¥Š<"fn"IâŠ¸(âŠ£âˆ¾0âˆ¾âŠ¢)n
  10 S V CÂ¨ b
  âŸ©
}

Compileâ†{
  bodyâ†GenFn ğ•©
  rcpâ†âŸ¨"x"âŸ© GenFn "1Ã·x"
  orâ†âŸ¨"w","x"âŸ© GenFn "(w+x)-wâˆ§x"
  fâ†âŸ¨rcp,or,bodyâŸ©
  Gen âŸ¨(â‰ Â¨f)/âŸ¨1â€¿1,2â€¿1,0â€¿1âŸ©â¥ŠÂ¨Â¨f64 â‹„ 2 â‹„ âˆ¾fâŸ©
}
